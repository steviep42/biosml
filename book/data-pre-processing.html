<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 9 Data Pre Processing | Predictive Learning in R</title>
  <meta name="description" content="Chapter 9 Data Pre Processing | Predictive Learning in R" />
  <meta name="generator" content="bookdown 0.14 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 9 Data Pre Processing | Predictive Learning in R" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 9 Data Pre Processing | Predictive Learning in R" />
  
  
  

<meta name="author" content="Steve Pittard" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="picking-the-best-model.html"/>
<link rel="next" href="classification-problems.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a></li>
<li class="chapter" data-level="2" data-path="predictive-supervised-learning.html"><a href="predictive-supervised-learning.html"><i class="fa fa-check"></i><b>2</b> Predictive / Supervised Learning</a><ul>
<li class="chapter" data-level="2.1" data-path="predictive-supervised-learning.html"><a href="predictive-supervised-learning.html#explanation-vs-prediction"><i class="fa fa-check"></i><b>2.1</b> Explanation vs Prediction</a><ul>
<li class="chapter" data-level="2.1.1" data-path="predictive-supervised-learning.html"><a href="predictive-supervised-learning.html#differences"><i class="fa fa-check"></i><b>2.1.1</b> Differences</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="predictive-supervised-learning.html"><a href="predictive-supervised-learning.html#two-types-of-predictive-models"><i class="fa fa-check"></i><b>2.2</b> Two Types of Predictive Models:</a></li>
<li class="chapter" data-level="2.3" data-path="predictive-supervised-learning.html"><a href="predictive-supervised-learning.html#bias-vs-variance"><i class="fa fa-check"></i><b>2.3</b> Bias vs Variance</a><ul>
<li class="chapter" data-level="2.3.1" data-path="predictive-supervised-learning.html"><a href="predictive-supervised-learning.html#bias"><i class="fa fa-check"></i><b>2.3.1</b> Bias</a></li>
<li class="chapter" data-level="2.3.2" data-path="predictive-supervised-learning.html"><a href="predictive-supervised-learning.html#variance"><i class="fa fa-check"></i><b>2.3.2</b> Variance</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="predictive-supervised-learning.html"><a href="predictive-supervised-learning.html#overfitting-and-underfitting"><i class="fa fa-check"></i><b>2.4</b> Overfitting and Underfitting</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="a-motivating-example.html"><a href="a-motivating-example.html"><i class="fa fa-check"></i><b>3</b> A Motivating Example</a><ul>
<li class="chapter" data-level="3.1" data-path="a-motivating-example.html"><a href="a-motivating-example.html#suggested-workflow"><i class="fa fa-check"></i><b>3.1</b> Suggested Workflow</a></li>
<li class="chapter" data-level="3.2" data-path="a-motivating-example.html"><a href="a-motivating-example.html#scatterplot"><i class="fa fa-check"></i><b>3.2</b> Scatterplot</a></li>
<li class="chapter" data-level="3.3" data-path="a-motivating-example.html"><a href="a-motivating-example.html#correlations"><i class="fa fa-check"></i><b>3.3</b> Correlations</a></li>
<li class="chapter" data-level="3.4" data-path="a-motivating-example.html"><a href="a-motivating-example.html#building-a-model---in-sample-error"><i class="fa fa-check"></i><b>3.4</b> Building A Model - In Sample Error</a></li>
<li class="chapter" data-level="3.5" data-path="a-motivating-example.html"><a href="a-motivating-example.html#out-of-sample-data"><i class="fa fa-check"></i><b>3.5</b> Out Of Sample Data</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="decision-trees.html"><a href="decision-trees.html"><i class="fa fa-check"></i><b>4</b> Decision Trees</a><ul>
<li class="chapter" data-level="4.1" data-path="decision-trees.html"><a href="decision-trees.html#advantages"><i class="fa fa-check"></i><b>4.1</b> Advantages</a></li>
<li class="chapter" data-level="4.2" data-path="decision-trees.html"><a href="decision-trees.html#a-classification-example"><i class="fa fa-check"></i><b>4.2</b> A Classification Example</a><ul>
<li class="chapter" data-level="4.2.1" data-path="decision-trees.html"><a href="decision-trees.html#evaluating-performance"><i class="fa fa-check"></i><b>4.2.1</b> Evaluating performance</a></li>
<li class="chapter" data-level="4.2.2" data-path="decision-trees.html"><a href="decision-trees.html#tree-splitting"><i class="fa fa-check"></i><b>4.2.2</b> Tree Splitting</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="decision-trees.html"><a href="decision-trees.html#gini-index"><i class="fa fa-check"></i><b>4.3</b> Gini Index</a></li>
<li class="chapter" data-level="4.4" data-path="decision-trees.html"><a href="decision-trees.html#regression-trees"><i class="fa fa-check"></i><b>4.4</b> Regression Trees</a><ul>
<li class="chapter" data-level="4.4.1" data-path="decision-trees.html"><a href="decision-trees.html#performance-measure"><i class="fa fa-check"></i><b>4.4.1</b> Performance Measure</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="decision-trees.html"><a href="decision-trees.html#parameters-vs-hyperparameters"><i class="fa fa-check"></i><b>4.5</b> Parameters vs Hyperparameters</a></li>
<li class="chapter" data-level="4.6" data-path="decision-trees.html"><a href="decision-trees.html#grid-searching"><i class="fa fa-check"></i><b>4.6</b> Grid Searching</a></li>
<li class="chapter" data-level="4.7" data-path="decision-trees.html"><a href="decision-trees.html#bagged-trees"><i class="fa fa-check"></i><b>4.7</b> Bagged Trees</a></li>
<li class="chapter" data-level="4.8" data-path="decision-trees.html"><a href="decision-trees.html#random-forests"><i class="fa fa-check"></i><b>4.8</b> Random Forests</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="training-test-data.html"><a href="training-test-data.html"><i class="fa fa-check"></i><b>5</b> Training / Test Data</a><ul>
<li class="chapter" data-level="5.1" data-path="training-test-data.html"><a href="training-test-data.html#cross-fold-validation-continued"><i class="fa fa-check"></i><b>5.1</b> Cross Fold Validation Continued</a></li>
<li class="chapter" data-level="5.2" data-path="training-test-data.html"><a href="training-test-data.html#create-a-function-to-automate-things"><i class="fa fa-check"></i><b>5.2</b> Create A Function To Automate Things</a></li>
<li class="chapter" data-level="5.3" data-path="training-test-data.html"><a href="training-test-data.html#repeated-cross-validation"><i class="fa fa-check"></i><b>5.3</b> Repeated Cross Validation</a></li>
<li class="chapter" data-level="5.4" data-path="training-test-data.html"><a href="training-test-data.html#bootstrap"><i class="fa fa-check"></i><b>5.4</b> Bootstrap</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="using-methods-other-than-lm.html"><a href="using-methods-other-than-lm.html"><i class="fa fa-check"></i><b>6</b> Using Methods Other Than lm</a><ul>
<li class="chapter" data-level="6.1" data-path="using-methods-other-than-lm.html"><a href="using-methods-other-than-lm.html#parameters-vs-hyperparameters-1"><i class="fa fa-check"></i><b>6.1</b> Parameters vs Hyperparameters</a></li>
<li class="chapter" data-level="6.2" data-path="using-methods-other-than-lm.html"><a href="using-methods-other-than-lm.html#hyperparameter-tuning"><i class="fa fa-check"></i><b>6.2</b> Hyperparameter Tuning</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="caret-package.html"><a href="caret-package.html"><i class="fa fa-check"></i><b>7</b> Caret Package</a><ul>
<li class="chapter" data-level="7.1" data-path="caret-package.html"><a href="caret-package.html#putting-caret-to-work"><i class="fa fa-check"></i><b>7.1</b> Putting caret To Work</a></li>
<li class="chapter" data-level="7.2" data-path="caret-package.html"><a href="caret-package.html#back-to-the-beginning"><i class="fa fa-check"></i><b>7.2</b> Back To The Beginning</a></li>
<li class="chapter" data-level="7.3" data-path="caret-package.html"><a href="caret-package.html#splitting"><i class="fa fa-check"></i><b>7.3</b> Splitting</a></li>
<li class="chapter" data-level="7.4" data-path="caret-package.html"><a href="caret-package.html#one-size-fits-all"><i class="fa fa-check"></i><b>7.4</b> One Size Fits All</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="picking-the-best-model.html"><a href="picking-the-best-model.html"><i class="fa fa-check"></i><b>8</b> Picking The Best Model</a><ul>
<li class="chapter" data-level="8.1" data-path="picking-the-best-model.html"><a href="picking-the-best-model.html#using-the-resamples-function"><i class="fa fa-check"></i><b>8.1</b> Using the resamples() function</a></li>
<li class="chapter" data-level="8.2" data-path="picking-the-best-model.html"><a href="picking-the-best-model.html#model-performance"><i class="fa fa-check"></i><b>8.2</b> Model Performance</a></li>
<li class="chapter" data-level="8.3" data-path="picking-the-best-model.html"><a href="picking-the-best-model.html#feature-selection"><i class="fa fa-check"></i><b>8.3</b> Feature Selection</a><ul>
<li class="chapter" data-level="8.3.1" data-path="picking-the-best-model.html"><a href="picking-the-best-model.html#recursive-feature-elimination"><i class="fa fa-check"></i><b>8.3.1</b> Recursive Feature Elimination</a></li>
<li class="chapter" data-level="8.3.2" data-path="picking-the-best-model.html"><a href="picking-the-best-model.html#redundant-feature-removal"><i class="fa fa-check"></i><b>8.3.2</b> Redundant Feature Removal</a></li>
<li class="chapter" data-level="8.3.3" data-path="picking-the-best-model.html"><a href="picking-the-best-model.html#feature-importance"><i class="fa fa-check"></i><b>8.3.3</b> Feature Importance</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="data-pre-processing.html"><a href="data-pre-processing.html"><i class="fa fa-check"></i><b>9</b> Data Pre Processing</a><ul>
<li class="chapter" data-level="9.1" data-path="data-pre-processing.html"><a href="data-pre-processing.html#types-of-pre-processing"><i class="fa fa-check"></i><b>9.1</b> Types of Pre Processing</a></li>
<li class="chapter" data-level="9.2" data-path="data-pre-processing.html"><a href="data-pre-processing.html#missing-values"><i class="fa fa-check"></i><b>9.2</b> Missing Values</a><ul>
<li class="chapter" data-level="9.2.1" data-path="data-pre-processing.html"><a href="data-pre-processing.html#finding-rows-with-missing-data"><i class="fa fa-check"></i><b>9.2.1</b> Finding Rows with Missing Data</a></li>
<li class="chapter" data-level="9.2.2" data-path="data-pre-processing.html"><a href="data-pre-processing.html#finding-columns-with-missing-data"><i class="fa fa-check"></i><b>9.2.2</b> Finding Columns With Missing Data</a></li>
<li class="chapter" data-level="9.2.3" data-path="data-pre-processing.html"><a href="data-pre-processing.html#use-the-median-approach"><i class="fa fa-check"></i><b>9.2.3</b> Use the Median Approach</a></li>
<li class="chapter" data-level="9.2.4" data-path="data-pre-processing.html"><a href="data-pre-processing.html#package-based-approach"><i class="fa fa-check"></i><b>9.2.4</b> Package-based Approach</a></li>
<li class="chapter" data-level="9.2.5" data-path="data-pre-processing.html"><a href="data-pre-processing.html#using-caret"><i class="fa fa-check"></i><b>9.2.5</b> Using caret</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="data-pre-processing.html"><a href="data-pre-processing.html#scaling"><i class="fa fa-check"></i><b>9.3</b> Scaling</a><ul>
<li class="chapter" data-level="9.3.1" data-path="data-pre-processing.html"><a href="data-pre-processing.html#methods-that-benefit-from-scaling"><i class="fa fa-check"></i><b>9.3.1</b> Methods That Benefit From Scaling</a></li>
<li class="chapter" data-level="9.3.2" data-path="data-pre-processing.html"><a href="data-pre-processing.html#methods-that-do-not-require-scaling"><i class="fa fa-check"></i><b>9.3.2</b> Methods That Do Not Require Scaling</a></li>
<li class="chapter" data-level="9.3.3" data-path="data-pre-processing.html"><a href="data-pre-processing.html#how-to-scale"><i class="fa fa-check"></i><b>9.3.3</b> How To Scale</a></li>
<li class="chapter" data-level="9.3.4" data-path="data-pre-processing.html"><a href="data-pre-processing.html#order-of-processing"><i class="fa fa-check"></i><b>9.3.4</b> Order of Processing</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="data-pre-processing.html"><a href="data-pre-processing.html#low-variance-variables"><i class="fa fa-check"></i><b>9.4</b> Low Variance Variables</a></li>
<li class="chapter" data-level="9.5" data-path="data-pre-processing.html"><a href="data-pre-processing.html#order-of-pre-processing"><i class="fa fa-check"></i><b>9.5</b> Order of Pre-Processing</a></li>
<li class="chapter" data-level="9.6" data-path="data-pre-processing.html"><a href="data-pre-processing.html#identifying-redundant-features"><i class="fa fa-check"></i><b>9.6</b> Identifying Redundant Features</a><ul>
<li class="chapter" data-level="9.6.1" data-path="data-pre-processing.html"><a href="data-pre-processing.html#highly-correlated-variables"><i class="fa fa-check"></i><b>9.6.1</b> Highly Correlated Variables</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="data-pre-processing.html"><a href="data-pre-processing.html#ranking-features"><i class="fa fa-check"></i><b>9.7</b> Ranking Features</a></li>
<li class="chapter" data-level="9.8" data-path="data-pre-processing.html"><a href="data-pre-processing.html#feature-selection-1"><i class="fa fa-check"></i><b>9.8</b> Feature Selection</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="classification-problems.html"><a href="classification-problems.html"><i class="fa fa-check"></i><b>10</b> Classification Problems</a><ul>
<li class="chapter" data-level="10.1" data-path="classification-problems.html"><a href="classification-problems.html#hypothesis-testing"><i class="fa fa-check"></i><b>10.1</b> Hypothesis Testing</a><ul>
<li class="chapter" data-level="10.1.1" data-path="classification-problems.html"><a href="classification-problems.html#type-i-and-ii-errors"><i class="fa fa-check"></i><b>10.1.1</b> Type I and II Errors</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="classification-problems.html"><a href="classification-problems.html#performance-measures"><i class="fa fa-check"></i><b>10.2</b> Performance Measures</a></li>
<li class="chapter" data-level="10.3" data-path="classification-problems.html"><a href="classification-problems.html#table-of-outcomes"><i class="fa fa-check"></i><b>10.3</b> Table of Outcomes</a><ul>
<li class="chapter" data-level="10.3.1" data-path="classification-problems.html"><a href="classification-problems.html#computing-performance-metrics"><i class="fa fa-check"></i><b>10.3.1</b> Computing Performance Metrics</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="classification-problems.html"><a href="classification-problems.html#picking-the-right-metric"><i class="fa fa-check"></i><b>10.4</b> Picking the Right Metric</a><ul>
<li class="chapter" data-level="10.4.1" data-path="classification-problems.html"><a href="classification-problems.html#working-with-prediction-probabilities"><i class="fa fa-check"></i><b>10.4.1</b> Working With Prediction Probabilities</a></li>
<li class="chapter" data-level="10.4.2" data-path="classification-problems.html"><a href="classification-problems.html#creating-a-roc-curve"><i class="fa fa-check"></i><b>10.4.2</b> Creating a ROC Curve</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="classification-example.html"><a href="classification-example.html"><i class="fa fa-check"></i><b>11</b> Classification Example</a><ul>
<li class="chapter" data-level="11.1" data-path="classification-example.html"><a href="classification-example.html#boxplots-and-densities"><i class="fa fa-check"></i><b>11.1</b> Boxplots And Densities</a></li>
<li class="chapter" data-level="11.2" data-path="classification-example.html"><a href="classification-example.html#generalized-linear-models"><i class="fa fa-check"></i><b>11.2</b> Generalized Linear Models</a></li>
<li class="chapter" data-level="11.3" data-path="classification-example.html"><a href="classification-example.html#random-forests-1"><i class="fa fa-check"></i><b>11.3</b> Random Forests</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="using-external-ml-frameworks.html"><a href="using-external-ml-frameworks.html"><i class="fa fa-check"></i><b>12</b> Using External ML Frameworks</a><ul>
<li class="chapter" data-level="12.1" data-path="using-external-ml-frameworks.html"><a href="using-external-ml-frameworks.html#using-h2o"><i class="fa fa-check"></i><b>12.1</b> Using h2o</a></li>
<li class="chapter" data-level="12.2" data-path="using-external-ml-frameworks.html"><a href="using-external-ml-frameworks.html#create-some-h20-models"><i class="fa fa-check"></i><b>12.2</b> Create Some h20 Models</a></li>
<li class="chapter" data-level="12.3" data-path="using-external-ml-frameworks.html"><a href="using-external-ml-frameworks.html#saving-a-model"><i class="fa fa-check"></i><b>12.3</b> Saving A Model</a></li>
<li class="chapter" data-level="12.4" data-path="using-external-ml-frameworks.html"><a href="using-external-ml-frameworks.html#using-the-h2o-auto-ml-feature"><i class="fa fa-check"></i><b>12.4</b> Using The h2o Auto ML Feature</a></li>
<li class="chapter" data-level="12.5" data-path="using-external-ml-frameworks.html"><a href="using-external-ml-frameworks.html#launching-a-job"><i class="fa fa-check"></i><b>12.5</b> Launching a Job</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Predictive Learning in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-pre-processing" class="section level1">
<h1><span class="header-section-number">Chapter 9</span> Data Pre Processing</h1>
<div id="types-of-pre-processing" class="section level2">
<h2><span class="header-section-number">9.1</span> Types of Pre Processing</h2>
<p>Data rarely arrives in a form that is directly suitable for use with a modeling method. There are a number of considerations to make such as how to handle missing data, highly correlated variables, and class imbalances - some categories are over or under represented. Additionally, some variables, also known as “features”, will require transformation or will need to be used to create new variables. Consider the case where the measured data (the numeric data) might be on different scales (e.g. height vs weight). This might result in the need to scale and center the data. Some methods take this into consideration whereas others do not. Suffice it to say that data prep can be an ongoing process that requires a number of experiments before arriving at the best form of data.</p>
</div>
<div id="missing-values" class="section level2">
<h2><span class="header-section-number">9.2</span> Missing Values</h2>
<p>This is a frequent situation in real life. Think of patients checking in for clinic visits over time. Sometimes they come for their appointments, sometimes they don’t. Sometimes when they do come, their information has changed or some diagnostic test is repeated with a new result which is entered or not. Or, whomever maintains the patient database, decides to add in some new variables to measure for all patients moving forward. This means that all existing patients will have missing values for those new variables. To see how this manifests practically in predictive learning consider the following version of the mtcars data frame which has some missing values:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(readr)
url &lt;-<span class="st"> &quot;https://raw.githubusercontent.com/steviep42/utilities/master/data/mtcars_na.csv&quot;</span>
mtcars_na &lt;-<span class="st"> </span><span class="kw">read.csv</span>(url, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</code></pre></div>
<div id="finding-rows-with-missing-data" class="section level3">
<h3><span class="header-section-number">9.2.1</span> Finding Rows with Missing Data</h3>
<p>Ar first glance it looks like all fearures have valid variable values but we can look for missing values which, in R, are indicated by <strong>NA</strong> Base R provides a number of commands to do this. First let’s see how many rows there are in the data frame.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">nrow</span>(mtcars_na)</code></pre></div>
<pre><code>## [1] 32</code></pre>
<p>Now let’s see how many rows have at least one column with a missing value. So we have eight rows in the data frame that contain one or more missing values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sum</span>(<span class="kw">complete.cases</span>(mtcars_na))</code></pre></div>
<pre><code>## [1] 24</code></pre>
</div>
<div id="finding-columns-with-missing-data" class="section level3">
<h3><span class="header-section-number">9.2.2</span> Finding Columns With Missing Data</h3>
<p>What columns have missing values ? Here we leverage the use of the apply family of functions along with the ability to create <strong>anonymous</strong> functions on the fly. Both R and Python provide this capability. We see that the <strong>wt</strong> column has three missing values and the <strong>carb</strong> feature has six missing values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sapply</span>(mtcars_na,<span class="cf">function</span>(x) <span class="kw">sum</span>(<span class="kw">is.na</span>(x)))</code></pre></div>
<pre><code>##  mpg  cyl disp   hp drat   wt qsec   vs   am gear carb 
##    0    0    0    0    0    3    0    0    0    0    6</code></pre>
<p>If we actually wanted to see all rows with missing values:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mtcars_na[<span class="op">!</span><span class="kw">complete.cases</span>(mtcars_na),]</code></pre></div>
<pre><code>##     mpg cyl  disp  hp drat    wt  qsec vs am gear carb
## 2  21.0   6 160.0 110 3.90    NA 17.02  0  1    4    4
## 9  22.8   4 140.8  95 3.92    NA 22.90  1  0    4    2
## 10 19.2   6 167.6 123 3.92 3.440 18.30  1  0    4   NA
## 12 16.4   8 275.8 180 3.07 4.070 17.40  0  0    3   NA
## 19 30.4   4  75.7  52 4.93 1.615 18.52  1  1    4   NA
## 20 33.9   4  71.1  65 4.22 1.835 19.90  1  1    4   NA
## 23 15.2   8 304.0 150 3.15    NA 17.30  0  0    3   NA
## 28 30.4   4  95.1 113 3.77 1.513 16.90  1  1    5   NA</code></pre>
<p>What do we do with these ? It depends on a number of things. How hard is it to get this type of data ? If it’s rare information then we probably want to keep all of it because there isn’t that much of it and not all columns are missing for any row. In fact most of the data in a given row is present so maybe one strategy is to tell whatever modeling method we use to ignore the missing values - they might do this by default without you even asking.</p>
<p>We could just filter out any row from the data frame that contains any missing values but in doing so we would lose eight rows of data. This is low stakes data but if this were rare or hard to obtain information then we wouldn’t want to do this.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mtcars_no_na &lt;-<span class="st"> </span>mtcars_na[<span class="kw">complete.cases</span>(mtcars_na),]
<span class="kw">nrow</span>(mtcars_no_na)</code></pre></div>
<pre><code>## [1] 24</code></pre>
</div>
<div id="use-the-median-approach" class="section level3">
<h3><span class="header-section-number">9.2.3</span> Use the Median Approach</h3>
<p>What could we do ? Well we could keep all rows even if they contains NAs and then use <strong>imputation</strong> methods to supply values for the missing information. There are R packages that do this but one quick way to do this without going that route is to replace the missing value in the <strong>wt</strong> column with the <strong>median</strong> value for the entire column. Using median is appropriate when the missing values are of the “missing at random” variety. There might some bias in the data that introduces a “not at random” situation. We’ll look at that case momentarily.</p>
<p>Let’s look at a boxplot of the <strong>wt</strong> feature.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">boxplot</span>(mtcars_na<span class="op">$</span>wt,<span class="dt">na.rm=</span><span class="ot">TRUE</span>,<span class="dt">main=</span><span class="st">&quot;Distribution of the wt feature&quot;</span>)
<span class="kw">grid</span>()</code></pre></div>
<p><img src="biosml_files/figure-html/unnamed-chunk-73-1.png" width="672" /></p>
<p>To make the substitution would involve the following. First we need to find out which row numbers have missing values for the <strong>wt</strong> feature.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(missing_wt_indices &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">is.na</span>(mtcars_na<span class="op">$</span>wt)))</code></pre></div>
<pre><code>## [1]  2  9 23</code></pre>
<p>Use this information with the data frame bracket notation see the rows where the NAs occur for the <strong>wt</strong> feature</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mtcars_na[missing_wt_indices,]</code></pre></div>
<pre><code>##     mpg cyl  disp  hp drat wt  qsec vs am gear carb
## 2  21.0   6 160.0 110 3.90 NA 17.02  0  1    4    4
## 9  22.8   4 140.8  95 3.92 NA 22.90  1  0    4    2
## 23 15.2   8 304.0 150 3.15 NA 17.30  0  0    3   NA</code></pre>
<p>Now do the replacement</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mtcars_na[missing_wt_indices,]<span class="op">$</span>wt &lt;-<span class="st"> </span><span class="kw">median</span>(mtcars_na<span class="op">$</span>wt,<span class="dt">na.rm=</span><span class="ot">TRUE</span>)</code></pre></div>
<p>Verify that the replacement was done successfully. If so, then we should see the value of 3.44 in palce of the previous NA values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mtcars_na[missing_wt_indices,]</code></pre></div>
<pre><code>##     mpg cyl  disp  hp drat   wt  qsec vs am gear carb
## 2  21.0   6 160.0 110 3.90 3.44 17.02  0  1    4    4
## 9  22.8   4 140.8  95 3.92 3.44 22.90  1  0    4    2
## 23 15.2   8 304.0 150 3.15 3.44 17.30  0  0    3   NA</code></pre>
</div>
<div id="package-based-approach" class="section level3">
<h3><span class="header-section-number">9.2.4</span> Package-based Approach</h3>
<p>This seems like a lot of work and maybe it is if you aren’t up to date with your R skills although, conceptually, this is straightforward and simple. The <strong>Hmisc</strong> package provides an easy way to do this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">suppressMessages</span>(<span class="kw">library</span>(Hmisc))
<span class="co"># Reload the versio of mtcars with missing values</span>
url &lt;-<span class="st"> &quot;https://raw.githubusercontent.com/steviep42/utilities/master/data/mtcars_na.csv&quot;</span>
mtcars_na &lt;-<span class="st"> </span><span class="kw">read.csv</span>(url, <span class="dt">strip.white =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p>The <strong>Hmisc</strong> package provides and <strong>impute</strong> function to do the work for us. Check it out. Notice how it finds the rows for which the <strong>wt</strong> feature is missing.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">impute</span>(mtcars_na<span class="op">$</span>wt, median)</code></pre></div>
<pre><code>##      1      2      3      4      5      6      7      8      9     10 
##  2.620 3.440*  2.320  3.215  3.440  3.460  3.570  3.190 3.440*  3.440 
##     11     12     13     14     15     16     17     18     19     20 
##  3.440  4.070  3.730  3.780  5.250  5.424  5.345  2.200  1.615  1.835 
##     21     22     23     24     25     26     27     28     29     30 
##  2.465  3.520 3.440*  3.840  3.845  1.935  2.140  1.513  3.170  2.770 
##     31     32 
##  3.570  2.780</code></pre>
<p>To do the replacement is straightforward.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mtcars_na<span class="op">$</span>wt &lt;-<span class="st"> </span><span class="kw">impute</span>(mtcars_na<span class="op">$</span>wt,median)</code></pre></div>
</div>
<div id="using-caret" class="section level3">
<h3><span class="header-section-number">9.2.5</span> Using caret</h3>
<p>Another imputation approach is to use the K-Nearest Neighbors method to find observations that are similar to the ones that contain missing data. The missing values can then be filled using information from the most similar observations. We won’t go into that choosing rather to use the convenience offered by the <strong>caret</strong> package to help us.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Make sure caret is loaded</span>
<span class="co"># library(caret)</span></code></pre></div>
<p>So if we choose to use caret we can use the <strong>preProcess</strong> function to signal our intent to use imputation - in this case the K-Nearest Neighbors technique. KNN imputation is particularly useful for dealing with the “not at random” situation where there could be bias in the way missing values occur. This approach looks at similar observations to those containing missing values which means that it will attempt to fill in missing values as a function of a number of variables as opposed to just one.</p>
<p>One subtlety here is that <strong>caret</strong> requires us to use an alternative to the forumla interface (e.g. mpg ~ .) approach when using the <strong>train</strong> function - at least the version of <strong>caret</strong> that I am currently using.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Get a fresh copy of the mtcars_na data frame</span>
mtcars_na &lt;-<span class="st"> </span><span class="kw">read.csv</span>(url,<span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)

<span class="co"># Set the seed for reproducibility</span>
<span class="kw">set.seed</span>(<span class="dv">123</span>)

<span class="co"># Get the indices for a 70/30 split</span>
train_idx &lt;-<span class="st"> </span><span class="kw">createDataPartition</span>(mtcars_na<span class="op">$</span>mpg, <span class="dt">p=</span>.<span class="dv">70</span>, <span class="dt">list =</span> <span class="ot">FALSE</span>)

<span class="co"># Split into a test / train pair</span>
train &lt;-<span class="st"> </span>mtcars[ train_idx,]
test  &lt;-<span class="st"> </span>mtcars[<span class="op">-</span>train_idx,]

<span class="co"># Note how we specify knnImpute. Another other option includes</span>
<span class="co"># medianImpute </span>

X &lt;-<span class="st"> </span>train[,<span class="op">-</span><span class="dv">1</span>]  <span class="co"># Use Every column EXCEPT mpg</span>
Y &lt;-<span class="st"> </span>train<span class="op">$</span>mpg   <span class="co"># This is what we want to predict</span>

lmFit &lt;-<span class="st"> </span><span class="kw">train</span>(X,Y,
              <span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>,
              <span class="dt">metric =</span> <span class="st">&quot;RMSE&quot;</span>,
              <span class="dt">preProcess =</span> <span class="st">&quot;knnImpute&quot;</span>)

lmFit</code></pre></div>
<pre><code>## Linear Regression 
## 
## 24 samples
## 10 predictors
## 
## Pre-processing: nearest neighbor imputation (10), centered (10),
##  scaled (10) 
## Resampling: Bootstrapped (25 reps) 
## Summary of sample sizes: 24, 24, 24, 24, 24, 24, ... 
## Resampling results:
## 
##   RMSE      Rsquared   MAE     
##   6.519758  0.4850762  4.923514
## 
## Tuning parameter &#39;intercept&#39; was held constant at a value of TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># See the RMSE for the test data</span>
preds &lt;-<span class="st"> </span><span class="kw">predict</span>(lmFit, test)
Metrics<span class="op">::</span><span class="kw">rmse</span>(test<span class="op">$</span>mpg,preds)</code></pre></div>
<pre><code>## [1] 3.286484</code></pre>
</div>
</div>
<div id="scaling" class="section level2">
<h2><span class="header-section-number">9.3</span> Scaling</h2>
<p>In terms of what methods benefit (or require) you to scale data prior to use, consider that any method that uses the idea of “distance” will require this. This helps address the situation wherein one the size and range of one feature might overshadow another. For example, look at the range of features in the <strong>mtcars</strong> dataframe. Not only are the variables on different scales (e.g. MPG vs Weight vs Horse Power), a feature such as displacement might over influence a distance calculation when compared to qsec.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sapply</span>(mtcars,range)</code></pre></div>
<pre><code>##       mpg cyl  disp  hp drat    wt qsec vs am gear carb
## [1,] 10.4   4  71.1  52 2.76 1.513 14.5  0  0    3    1
## [2,] 33.9   8 472.0 335 4.93 5.424 22.9  1  1    5    8</code></pre>
<div id="methods-that-benefit-from-scaling" class="section level3">
<h3><span class="header-section-number">9.3.1</span> Methods That Benefit From Scaling</h3>
<p>The following approaches benefit from scaling:</p>
<p>Linear/non-linear regression, logistic regression, KNN, SVM, Neural Networks, clustering algorithms like k-means clustering. Methods that employ PCA and dimensionality reduction should use scaled data.</p>
<p>In R and Python, some of the individual functions might have arguements to activate the scaling as part of the process.</p>
</div>
<div id="methods-that-do-not-require-scaling" class="section level3">
<h3><span class="header-section-number">9.3.2</span> Methods That Do Not Require Scaling</h3>
<p>Methods that don’t require scaling (or whose results don’t rely upon it) include rule-based algorithms such as Decision trees and more generally CART - Random Forests, Gradient Boosted Decision Even if you scale the data the relative relationships will be preserved post scaling so the decision to split a tree won’t be impacted.</p>
</div>
<div id="how-to-scale" class="section level3">
<h3><span class="header-section-number">9.3.3</span> How To Scale</h3>
<p>You could do your own scaling and centering which might be helpful to understand what is going on. First, when we say “scaling” we typically mean “centering” and “scaling”.</p>
<div id="centering" class="section level4">
<h4><span class="header-section-number">9.3.3.1</span> Centering</h4>
<p>Take a vector (or column) of numeric data and find the mean. Then subtract the computed mean value from each element of the vector / column. We will use the <strong>wt</strong> column from mtcars as an example.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(centered &lt;-<span class="st"> </span>mtcars<span class="op">$</span>wt <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(mtcars<span class="op">$</span>wt))</code></pre></div>
<pre><code>##  [1] -0.59725 -0.34225 -0.89725 -0.00225  0.22275  0.24275  0.35275
##  [8] -0.02725 -0.06725  0.22275  0.22275  0.85275  0.51275  0.56275
## [15]  2.03275  2.20675  2.12775 -1.01725 -1.60225 -1.38225 -0.75225
## [22]  0.30275  0.21775  0.62275  0.62775 -1.28225 -1.07725 -1.70425
## [29] -0.04725 -0.44725  0.35275 -0.43725</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#center &lt;- apply(mtcars,2,function(x) (x - mean(x)))</span></code></pre></div>
</div>
<div id="scaling-1" class="section level4">
<h4><span class="header-section-number">9.3.3.2</span> Scaling</h4>
<p>This step involves taking the standard deviation of the vector / column. Then divide each valuein the vector / column by this computed standard deviation. We’ll process the <strong>centered</strong> data from the previous computation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(scaled &lt;-<span class="st"> </span>centered<span class="op">/</span><span class="kw">sd</span>(centered))</code></pre></div>
<pre><code>##  [1] -0.610399567 -0.349785269 -0.917004624 -0.002299538  0.227654255
##  [6]  0.248094592  0.360516446 -0.027849959 -0.068730634  0.227654255
## [11]  0.227654255  0.871524874  0.524039143  0.575139986  2.077504765
## [16]  2.255335698  2.174596366 -1.039646647 -1.637526508 -1.412682800
## [21] -0.768812180  0.309415603  0.222544170  0.636460997  0.641571082
## [26] -1.310481114 -1.100967659 -1.741772228 -0.048290296 -0.457097039
## [31]  0.360516446 -0.446876870</code></pre>
</div>
<div id="scaling-a-data-frame" class="section level4">
<h4><span class="header-section-number">9.3.3.3</span> Scaling a Data frame</h4>
<p>We could do this on a data frame by using the <strong>apply</strong> function. The problme with this “do it yourself approach” is that we don’t have an easy way to reverse the scaling and centering.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">centered &lt;-<span class="st"> </span><span class="kw">apply</span>(mtcars,<span class="dv">2</span>,<span class="cf">function</span>(x) (x <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(x)))
scaled &lt;-<span class="st"> </span><span class="kw">apply</span>(centered,<span class="dv">2</span>,<span class="cf">function</span>(x) x<span class="op">/</span><span class="kw">sd</span>(x))</code></pre></div>
<p>There is a function called <strong>scale</strong> which will do this for us and in a way that will allow us to reverse those operations.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(center_scaled &lt;-<span class="st"> </span><span class="kw">scale</span>(mtcars,<span class="dt">center=</span><span class="ot">TRUE</span>,<span class="dt">scale=</span><span class="ot">TRUE</span>))</code></pre></div>
<pre><code>##                             mpg        cyl        disp          hp
## Mazda RX4            0.15088482 -0.1049878 -0.57061982 -0.53509284
## Mazda RX4 Wag        0.15088482 -0.1049878 -0.57061982 -0.53509284
## Datsun 710           0.44954345 -1.2248578 -0.99018209 -0.78304046
## Hornet 4 Drive       0.21725341 -0.1049878  0.22009369 -0.53509284
## Hornet Sportabout   -0.23073453  1.0148821  1.04308123  0.41294217
## Valiant             -0.33028740 -0.1049878 -0.04616698 -0.60801861
## Duster 360          -0.96078893  1.0148821  1.04308123  1.43390296
## Merc 240D            0.71501778 -1.2248578 -0.67793094 -1.23518023
## Merc 230             0.44954345 -1.2248578 -0.72553512 -0.75387015
## Merc 280            -0.14777380 -0.1049878 -0.50929918 -0.34548584
## Merc 280C           -0.38006384 -0.1049878 -0.50929918 -0.34548584
## Merc 450SE          -0.61235388  1.0148821  0.36371309  0.48586794
## Merc 450SL          -0.46302456  1.0148821  0.36371309  0.48586794
## Merc 450SLC         -0.81145962  1.0148821  0.36371309  0.48586794
## Cadillac Fleetwood  -1.60788262  1.0148821  1.94675381  0.85049680
## Lincoln Continental -1.60788262  1.0148821  1.84993175  0.99634834
## Chrysler Imperial   -0.89442035  1.0148821  1.68856165  1.21512565
## Fiat 128             2.04238943 -1.2248578 -1.22658929 -1.17683962
## Honda Civic          1.71054652 -1.2248578 -1.25079481 -1.38103178
## Toyota Corolla       2.29127162 -1.2248578 -1.28790993 -1.19142477
## Toyota Corona        0.23384555 -1.2248578 -0.89255318 -0.72469984
## Dodge Challenger    -0.76168319  1.0148821  0.70420401  0.04831332
## AMC Javelin         -0.81145962  1.0148821  0.59124494  0.04831332
## Camaro Z28          -1.12671039  1.0148821  0.96239618  1.43390296
## Pontiac Firebird    -0.14777380  1.0148821  1.36582144  0.41294217
## Fiat X1-9            1.19619000 -1.2248578 -1.22416874 -1.17683962
## Porsche 914-2        0.98049211 -1.2248578 -0.89093948 -0.81221077
## Lotus Europa         1.71054652 -1.2248578 -1.09426581 -0.49133738
## Ford Pantera L      -0.71190675  1.0148821  0.97046468  1.71102089
## Ferrari Dino        -0.06481307 -0.1049878 -0.69164740  0.41294217
## Maserati Bora       -0.84464392  1.0148821  0.56703942  2.74656682
## Volvo 142E           0.21725341 -1.2248578 -0.88529152 -0.54967799
##                            drat           wt        qsec         vs
## Mazda RX4            0.56751369 -0.610399567 -0.77716515 -0.8680278
## Mazda RX4 Wag        0.56751369 -0.349785269 -0.46378082 -0.8680278
## Datsun 710           0.47399959 -0.917004624  0.42600682  1.1160357
## Hornet 4 Drive      -0.96611753 -0.002299538  0.89048716  1.1160357
## Hornet Sportabout   -0.83519779  0.227654255 -0.46378082 -0.8680278
## Valiant             -1.56460776  0.248094592  1.32698675  1.1160357
## Duster 360          -0.72298087  0.360516446 -1.12412636 -0.8680278
## Merc 240D            0.17475447 -0.027849959  1.20387148  1.1160357
## Merc 230             0.60491932 -0.068730634  2.82675459  1.1160357
## Merc 280             0.60491932  0.227654255  0.25252621  1.1160357
## Merc 280C            0.60491932  0.227654255  0.58829513  1.1160357
## Merc 450SE          -0.98482035  0.871524874 -0.25112717 -0.8680278
## Merc 450SL          -0.98482035  0.524039143 -0.13920420 -0.8680278
## Merc 450SLC         -0.98482035  0.575139986  0.08464175 -0.8680278
## Cadillac Fleetwood  -1.24665983  2.077504765  0.07344945 -0.8680278
## Lincoln Continental -1.11574009  2.255335698 -0.01608893 -0.8680278
## Chrysler Imperial   -0.68557523  2.174596366 -0.23993487 -0.8680278
## Fiat 128             0.90416444 -1.039646647  0.90727560  1.1160357
## Honda Civic          2.49390411 -1.637526508  0.37564148  1.1160357
## Toyota Corolla       1.16600392 -1.412682800  1.14790999  1.1160357
## Toyota Corona        0.19345729 -0.768812180  1.20946763  1.1160357
## Dodge Challenger    -1.56460776  0.309415603 -0.54772305 -0.8680278
## AMC Javelin         -0.83519779  0.222544170 -0.30708866 -0.8680278
## Camaro Z28           0.24956575  0.636460997 -1.36476075 -0.8680278
## Pontiac Firebird    -0.96611753  0.641571082 -0.44699237 -0.8680278
## Fiat X1-9            0.90416444 -1.310481114  0.58829513  1.1160357
## Porsche 914-2        1.55876313 -1.100967659 -0.64285758 -0.8680278
## Lotus Europa         0.32437703 -1.741772228 -0.53093460  1.1160357
## Ford Pantera L       1.16600392 -0.048290296 -1.87401028 -0.8680278
## Ferrari Dino         0.04383473 -0.457097039 -1.31439542 -0.8680278
## Maserati Bora       -0.10578782  0.360516446 -1.81804880 -0.8680278
## Volvo 142E           0.96027290 -0.446876870  0.42041067  1.1160357
##                             am       gear       carb
## Mazda RX4            1.1899014  0.4235542  0.7352031
## Mazda RX4 Wag        1.1899014  0.4235542  0.7352031
## Datsun 710           1.1899014  0.4235542 -1.1221521
## Hornet 4 Drive      -0.8141431 -0.9318192 -1.1221521
## Hornet Sportabout   -0.8141431 -0.9318192 -0.5030337
## Valiant             -0.8141431 -0.9318192 -1.1221521
## Duster 360          -0.8141431 -0.9318192  0.7352031
## Merc 240D           -0.8141431  0.4235542 -0.5030337
## Merc 230            -0.8141431  0.4235542 -0.5030337
## Merc 280            -0.8141431  0.4235542  0.7352031
## Merc 280C           -0.8141431  0.4235542  0.7352031
## Merc 450SE          -0.8141431 -0.9318192  0.1160847
## Merc 450SL          -0.8141431 -0.9318192  0.1160847
## Merc 450SLC         -0.8141431 -0.9318192  0.1160847
## Cadillac Fleetwood  -0.8141431 -0.9318192  0.7352031
## Lincoln Continental -0.8141431 -0.9318192  0.7352031
## Chrysler Imperial   -0.8141431 -0.9318192  0.7352031
## Fiat 128             1.1899014  0.4235542 -1.1221521
## Honda Civic          1.1899014  0.4235542 -0.5030337
## Toyota Corolla       1.1899014  0.4235542 -1.1221521
## Toyota Corona       -0.8141431 -0.9318192 -1.1221521
## Dodge Challenger    -0.8141431 -0.9318192 -0.5030337
## AMC Javelin         -0.8141431 -0.9318192 -0.5030337
## Camaro Z28          -0.8141431 -0.9318192  0.7352031
## Pontiac Firebird    -0.8141431 -0.9318192 -0.5030337
## Fiat X1-9            1.1899014  0.4235542 -1.1221521
## Porsche 914-2        1.1899014  1.7789276 -0.5030337
## Lotus Europa         1.1899014  1.7789276 -0.5030337
## Ford Pantera L       1.1899014  1.7789276  0.7352031
## Ferrari Dino         1.1899014  1.7789276  1.9734398
## Maserati Bora        1.1899014  1.7789276  3.2116766
## Volvo 142E           1.1899014  0.4235542 -0.5030337
## attr(,&quot;scaled:center&quot;)
##        mpg        cyl       disp         hp       drat         wt 
##  20.090625   6.187500 230.721875 146.687500   3.596563   3.217250 
##       qsec         vs         am       gear       carb 
##  17.848750   0.437500   0.406250   3.687500   2.812500 
## attr(,&quot;scaled:scale&quot;)
##         mpg         cyl        disp          hp        drat          wt 
##   6.0269481   1.7859216 123.9386938  68.5628685   0.5346787   0.9784574 
##        qsec          vs          am        gear        carb 
##   1.7869432   0.5040161   0.4989909   0.7378041   1.6152000</code></pre>
<p>If you look at the bottom of the above operation, there are two <strong>attributes</strong> that contain the information necessary to <strong>reverse scale</strong> the scaled data. Soif you do this yourself then you have to reverse scaled yourself.</p>
</div>
<div id="caret-and-preprocess" class="section level4">
<h4><span class="header-section-number">9.3.3.4</span> caret and preprocess</h4>
<p>but the <strong>caret</strong> package will help you do this using the <strong>preProcess</strong> function. Here we can actually request that the data is “centered” and “scaled” as part of the model assembly process. We could do this before the call to the <strong>Train</strong> function but then we would also have to convert the training and test data ourselves. In the following situation, the data will be centered and scaled thoug the returned RMSE will be in terms of the unscaled data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">training_idx &lt;-<span class="st"> </span><span class="kw">createDataPartition</span>(mtcars<span class="op">$</span>mpg, <span class="dt">p =</span>.<span class="dv">80</span>, <span class="dt">list=</span><span class="ot">FALSE</span>)
training &lt;-<span class="st"> </span>mtcars[training_idx,]
test &lt;-<span class="st"> </span>mtcars[<span class="op">-</span>training_idx,]

myLm &lt;-<span class="st">  </span><span class="kw">train</span>(mpg <span class="op">~</span><span class="st"> </span>.,
               <span class="dt">data =</span> training,
               <span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>,
               <span class="dt">preProcess =</span> <span class="kw">c</span>(<span class="st">&quot;center&quot;</span>,<span class="st">&quot;scale&quot;</span>)
          )</code></pre></div>
<p>To verify that the data is being centered and scaled, checkout the <strong>myLm</strong> object:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># This </span>
myLm<span class="op">$</span>finalModel<span class="op">$</span>model[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,]</code></pre></div>
<pre><code>##                .outcome         cyl        disp         hp       drat
## Mazda.RX4          21.0 -0.07938842 -0.54838086 -0.4758030  0.5953868
## Mazda.RX4.Wag      21.0 -0.07938842 -0.54838086 -0.4758030  0.5953868
## Datsun.710         22.8 -1.19082628 -0.96255377 -0.7198571  0.5031809
## Hornet.4.Drive     21.4 -0.07938842  0.23217577 -0.4758030 -0.9167903
## Valiant            18.1 -0.07938842 -0.03066472 -0.5475836 -1.5069083
##                         wt       qsec         vs         am       gear
## Mazda.RX4      -0.61178466 -0.9249695 -0.9819805  1.2207620  0.5263968
## Mazda.RX4.Wag  -0.36077084 -0.6072582 -0.9819805  1.2207620  0.5263968
## Datsun.710     -0.90709503  0.2948150  0.9819805  1.2207620  0.5263968
## Hornet.4.Drive -0.02608575  0.7657086  0.9819805 -0.7899048 -0.9475142
## Valiant         0.21508439  1.2082351  0.9819805 -0.7899048 -0.9475142
##                      carb
## Mazda.RX4       0.8118695
## Mazda.RX4.Wag   0.8118695
## Datsun.710     -1.0824926
## Hornet.4.Drive -1.0824926
## Valiant        -1.0824926</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># matches this</span>
<span class="kw">scale</span>(training)[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,]</code></pre></div>
<pre><code>##                       mpg         cyl        disp         hp       drat
## Mazda RX4       0.1310341 -0.07938842 -0.54838086 -0.4758030  0.5953868
## Mazda RX4 Wag   0.1310341 -0.07938842 -0.54838086 -0.4758030  0.5953868
## Datsun 710      0.4206885 -1.19082628 -0.96255377 -0.7198571  0.5031809
## Hornet 4 Drive  0.1954017 -0.07938842  0.23217577 -0.4758030 -0.9167903
## Valiant        -0.3356312 -0.07938842 -0.03066472 -0.5475836 -1.5069083
##                         wt       qsec         vs         am       gear
## Mazda RX4      -0.61178466 -0.9249695 -0.9819805  1.2207620  0.5263968
## Mazda RX4 Wag  -0.36077084 -0.6072582 -0.9819805  1.2207620  0.5263968
## Datsun 710     -0.90709503  0.2948150  0.9819805  1.2207620  0.5263968
## Hornet 4 Drive -0.02608575  0.7657086  0.9819805 -0.7899048 -0.9475142
## Valiant         0.21508439  1.2082351  0.9819805 -0.7899048 -0.9475142
##                      carb
## Mazda RX4       0.8118695
## Mazda RX4 Wag   0.8118695
## Datsun 710     -1.0824926
## Hornet 4 Drive -1.0824926
## Valiant        -1.0824926</code></pre>
<p>This is convenient because if we now wish to use the <strong>predict</strong> function, it will scale the <strong>test</strong> data that we provide on our behalf. What we get back will be in terms of the uncenter and unscaled predicted variable (mpg).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">preds &lt;-<span class="st"> </span><span class="kw">predict</span>(myLm,test)</code></pre></div>
</div>
</div>
<div id="order-of-processing" class="section level3">
<h3><span class="header-section-number">9.3.4</span> Order of Processing</h3>
<p>Note that the order of processing is important. You should center and then scale. Underneath the hood, the centering operation finds the mean of a feature (column) and then subtracts it from each value therein. So the following are equivalent:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(mt_center &lt;-<span class="st"> </span>mtcars<span class="op">$</span>wt <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(mtcars<span class="op">$</span>wt))</code></pre></div>
<pre><code>##  [1] -0.59725 -0.34225 -0.89725 -0.00225  0.22275  0.24275  0.35275
##  [8] -0.02725 -0.06725  0.22275  0.22275  0.85275  0.51275  0.56275
## [15]  2.03275  2.20675  2.12775 -1.01725 -1.60225 -1.38225 -0.75225
## [22]  0.30275  0.21775  0.62275  0.62775 -1.28225 -1.07725 -1.70425
## [29] -0.04725 -0.44725  0.35275 -0.43725</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#</span>

<span class="kw">as.vector</span>(<span class="kw">scale</span>(mtcars<span class="op">$</span>wt,<span class="dt">center=</span>T,<span class="dt">scale=</span>F))</code></pre></div>
<pre><code>##  [1] -0.59725 -0.34225 -0.89725 -0.00225  0.22275  0.24275  0.35275
##  [8] -0.02725 -0.06725  0.22275  0.22275  0.85275  0.51275  0.56275
## [15]  2.03275  2.20675  2.12775 -1.01725 -1.60225 -1.38225 -0.75225
## [22]  0.30275  0.21775  0.62275  0.62775 -1.28225 -1.07725 -1.70425
## [29] -0.04725 -0.44725  0.35275 -0.43725</code></pre>
<p>After centering, the scaling is done by dividing the (centered) columns of the data frame by their respective standard deviations. In terms of dealing with missing data and scaling, one should first do imputation followed by centering and scaling. In a call to the <strong>train</strong> function, this would look like the following. We’ll use our version of mtcars that has missing data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">url &lt;-<span class="st"> &quot;https://raw.githubusercontent.com/steviep42/utilities/master/data/mtcars_na.csv&quot;</span>

mtcars_na &lt;-<span class="st"> </span><span class="kw">read.csv</span>(url,<span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">training_idx &lt;-<span class="st"> </span><span class="kw">createDataPartition</span>(mtcars_na<span class="op">$</span>mpg, <span class="dt">p =</span>.<span class="dv">80</span>, <span class="dt">list=</span><span class="ot">FALSE</span>)
training &lt;-<span class="st"> </span>mtcars_na[training_idx,]
test &lt;-<span class="st"> </span>mtcars_na[<span class="op">-</span>training_idx,]

X &lt;-<span class="st"> </span>training[,<span class="op">-</span><span class="dv">1</span>]
Y &lt;-<span class="st"> </span>training<span class="op">$</span>mpg 

myLm &lt;-<span class="st">  </span><span class="kw">train</span>(X, Y,
                <span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>,
                <span class="dt">preProcess =</span> <span class="kw">c</span>(<span class="st">&quot;knnImpute&quot;</span>,<span class="st">&quot;center&quot;</span>,<span class="st">&quot;scale&quot;</span>)
          )</code></pre></div>
<pre><code>## Warning in predict.lm(modelFit, newdata): prediction from a rank-deficient
## fit may be misleading</code></pre>
</div>
</div>
<div id="low-variance-variables" class="section level2">
<h2><span class="header-section-number">9.4</span> Low Variance Variables</h2>
<p>Some variables exhibit low variance and might be nearly constant. Such variables can be detected by using some basic functions in R before you begin to build a model. As an example, we’ll use the mtcars data frame and introduce a low variance variable - actually, we’ll make it a constant.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(mtcars)
<span class="kw">set.seed</span>(<span class="dv">123</span>)

mtcars_nzv &lt;-<span class="st"> </span>mtcars

<span class="co"># Make drat low variance</span>
mtcars_nzv<span class="op">$</span>drat &lt;-<span class="st"> </span><span class="fl">3.0</span>

<span class="co"># Pretty low isn&#39;t it ?</span>
<span class="kw">var</span>(mtcars_nzv<span class="op">$</span>drat)</code></pre></div>
<pre><code>## [1] 0</code></pre>
<p>What if we use this variable when making a model. We’ll get a lot of problems. While this is a contrived exqmple, it is possible to get this situation when using cross fold validation where the data is segemented into smaller subsets where a variable can be zero variance.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span>mtcars_nzv[,<span class="op">-</span><span class="dv">1</span>]
y &lt;-<span class="st"> </span>mtcars_nzv[,<span class="dv">1</span>]

lowVarLm &lt;-<span class="st"> </span><span class="kw">train</span>(
  x,y,
  <span class="dt">method=</span><span class="st">&quot;lm&quot;</span>,
  <span class="dt">preProcess=</span><span class="kw">c</span>(<span class="st">&quot;center&quot;</span>,<span class="st">&quot;scale&quot;</span>)
  )</code></pre></div>
<p>The <strong>caret</strong> package has an option to the <strong>preProcess</strong> argument that allows us to remove such variables so it won’t impact the resulting model. Notice that we remove the near zero variance variables before we center which happens before scaling. This is the recommended order.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span>mtcars_nzv[,<span class="op">-</span><span class="dv">1</span>]
y &lt;-<span class="st"> </span>mtcars_nzv[,<span class="dv">1</span>]

lowVarLm &lt;-<span class="st"> </span><span class="kw">train</span>(
  x,y,
  <span class="dt">method=</span><span class="st">&quot;lm&quot;</span>,
  <span class="dt">preProcess=</span><span class="kw">c</span>(<span class="st">&quot;nzv&quot;</span>,<span class="st">&quot;center&quot;</span>,<span class="st">&quot;scale&quot;</span>)
  )</code></pre></div>
<p>The above now works. There is a subtle consideration at work here. We could pre process the data with <strong>nzv</strong> or <strong>zv</strong> where the former removes “near” zero variance features and the latter removes constant-valued features. With near zero variance features there is a way to specify tolerance for deciding whether a feature has near zero variance. Think of <strong>nzv</strong> as being slightly more premissive and flexible whereas <strong>zv</strong> eliminates zero variance variables. Sometimes you might want to keep near zero variance features around simply because there could be some interesting information therein.</p>
<p>In general we could remove the constant or near zero variance features <strong>before</strong> passing the data to the <strong>train</strong> function. Caret has a standalone function called <strong>nearZeroVariance</strong> to do this. We’ll it doesn’t actually remove the feature but it will tell us which column(s) exhibit very low variance or have a constant value. In this case it is column number 5 which corresponds to <strong>drat</strong>. We already knew that.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">nearZeroVar</span>(mtcars_nzv)</code></pre></div>
<pre><code>## [1] 5</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Find the nzv columns</span>

mtcars_nzv[<span class="kw">nearZeroVar</span>(mtcars_nzv)]</code></pre></div>
<pre><code>##                     drat
## Mazda RX4              3
## Mazda RX4 Wag          3
## Datsun 710             3
## Hornet 4 Drive         3
## Hornet Sportabout      3
## Valiant                3
## Duster 360             3
## Merc 240D              3
## Merc 230               3
## Merc 280               3
## Merc 280C              3
## Merc 450SE             3
## Merc 450SL             3
## Merc 450SLC            3
## Cadillac Fleetwood     3
## Lincoln Continental    3
## Chrysler Imperial      3
## Fiat 128               3
## Honda Civic            3
## Toyota Corolla         3
## Toyota Corona          3
## Dodge Challenger       3
## AMC Javelin            3
## Camaro Z28             3
## Pontiac Firebird       3
## Fiat X1-9              3
## Porsche 914-2          3
## Lotus Europa           3
## Ford Pantera L         3
## Ferrari Dino           3
## Maserati Bora          3
## Volvo 142E             3</code></pre>
<p>There is a data frame in the <strong>caret</strong> package which exhibits this behavior in a more organic fashion - that is the data measurements of a number of features are near zero variance.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(BloodBrain)
<span class="kw">str</span>(bbbDescr,<span class="dv">0</span>)</code></pre></div>
<pre><code>## &#39;data.frame&#39;:    208 obs. of  134 variables:</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Which columns are suspected of having near zero variance ? </span>

<span class="kw">nearZeroVar</span>(bbbDescr)</code></pre></div>
<pre><code>## [1]  3 16 17 22 25 50 60</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># What are their names ?</span>
<span class="kw">names</span>(bbbDescr[,<span class="kw">nearZeroVar</span>(bbbDescr)])</code></pre></div>
<pre><code>## [1] &quot;negative&quot;     &quot;peoe_vsa.2.1&quot; &quot;peoe_vsa.3.1&quot; &quot;a_acid&quot;      
## [5] &quot;vsa_acid&quot;     &quot;frac.anion7.&quot; &quot;alert&quot;</code></pre>
</div>
<div id="order-of-pre-processing" class="section level2">
<h2><span class="header-section-number">9.5</span> Order of Pre-Processing</h2>
<p>In reality, if we wanted to line up the order in which to pre process data it would read something like the following:</p>
<ul>
<li>Remove Near Zero Variance Features</li>
<li>Do Imputation (knn or median)</li>
<li>Center</li>
<li>Scale</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lowVarLm &lt;-<span class="st"> </span><span class="kw">train</span>(
  mtcars[,<span class="op">-</span><span class="dv">1</span>],mtcars<span class="op">$</span>mpg,
  <span class="dt">method=</span><span class="st">&quot;lm&quot;</span>,
  <span class="dt">preProcess=</span><span class="kw">c</span>(<span class="st">&quot;nzv&quot;</span>,<span class="st">&quot;medianImpute&quot;</span>,<span class="st">&quot;center&quot;</span>,<span class="st">&quot;scale&quot;</span>)
  )</code></pre></div>
</div>
<div id="identifying-redundant-features" class="section level2">
<h2><span class="header-section-number">9.6</span> Identifying Redundant Features</h2>
<p>Lots of Data Scientists and model builders would like to know which features are important and which are redundant - BEFORE building the model. Many times, people just include all features and rely upon post model statistics to diagnose the model. This is fine though there are automated methods to help. Some statisticians do not like this approach (e.g. Step Wise Regression) because it emphasizes a scoring metric that is computed as a function of other measures though that process itself might be incomplete in some way. Ideally, you would have some up front idea about the data.</p>
<div id="highly-correlated-variables" class="section level3">
<h3><span class="header-section-number">9.6.1</span> Highly Correlated Variables</h3>
<p>In an earlier section we looked at the correlations between the variables in the mtcars data frame. When there are a number of strongly correlated variables the issue of multicollinerarity might exist. One variable might be sufficient to represent the information of one or more other variables which is useful when building models because it would allow us to leave out comparatively low information variables.</p>
<p>Techniques like PCA Principal Components Analysis can be used to recombine features in a way that explains most of the variation of data set. A simpler way might be to look for highly correlated sets of variables and remove those over a certain threshold of correlation from the data frame.</p>
<p>Let’s look at the mtcars data frame again to see what variables are correlated.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(mtcars)
correlations &lt;-<span class="st"> </span><span class="kw">cor</span>(mtcars)
correlations[<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>]</code></pre></div>
<pre><code>##             mpg        cyl       disp         hp       drat         wt
## mpg   1.0000000 -0.8521620 -0.8475514 -0.7761684  0.6811719 -0.8676594
## cyl  -0.8521620  1.0000000  0.9020329  0.8324475 -0.6999381  0.7824958
## disp -0.8475514  0.9020329  1.0000000  0.7909486 -0.7102139  0.8879799
## hp   -0.7761684  0.8324475  0.7909486  1.0000000 -0.4487591  0.6587479
## drat  0.6811719 -0.6999381 -0.7102139 -0.4487591  1.0000000 -0.7124406
## wt   -0.8676594  0.7824958  0.8879799  0.6587479 -0.7124406  1.0000000</code></pre>
<p>It turns out that there are lots of strong correlations going on here. The darker the circle the stronger the correlation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">suppressMessages</span>(<span class="kw">library</span>(corrplot))
<span class="kw">corrplot</span>(correlations, <span class="dt">order=</span><span class="st">&quot;hclust&quot;</span>)</code></pre></div>
<pre><code>## Warning in plot.window(...): &quot;order&quot; is not a graphical parameter</code></pre>
<pre><code>## Warning in plot.xy(xy, type, ...): &quot;order&quot; is not a graphical parameter</code></pre>
<pre><code>## Warning in axis(side = side, at = at, labels = labels, ...): &quot;order&quot; is not
## a graphical parameter

## Warning in axis(side = side, at = at, labels = labels, ...): &quot;order&quot; is not
## a graphical parameter</code></pre>
<pre><code>## Warning in box(...): &quot;order&quot; is not a graphical parameter</code></pre>
<pre><code>## Warning in title(...): &quot;order&quot; is not a graphical parameter</code></pre>
<p><img src="biosml_files/figure-html/unnamed-chunk-97-1.png" width="672" /></p>
<p>The <strong>caret</strong> package has some functions that can help us identify highly correlated variables that might be a candidates for removal prior to use in building a model. One of the variables that is highly correlated with others is <strong>mpg</strong> Since that is the one we are trying to predict, we’ll keep it around. The following columns from mtcars have a correlation of .75 (or higher) with some other variable(s)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(highcorr &lt;-<span class="st"> </span><span class="kw">findCorrelation</span>(correlations, <span class="dt">cutoff=</span>.<span class="dv">75</span>))</code></pre></div>
<pre><code>## [1]  2  3  1 10</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(mtcars[,highcorr])</code></pre></div>
<pre><code>## [1] &quot;cyl&quot;  &quot;disp&quot; &quot;mpg&quot;  &quot;gear&quot;</code></pre>
<p>So let’s remove those variables from consideration although we’ll keep the <strong>mpg</strong> variable since that is what we will be predicting.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(mtcars)
decorrel_mtcars &lt;-<span class="st"> </span>mtcars[,<span class="op">-</span>highcorr[highcorr <span class="op">!=</span><span class="st"> </span><span class="dv">1</span>]]</code></pre></div>
<p>This might yield a better model though it’s tough to tell.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">idx &lt;-<span class="st"> </span><span class="kw">createDataPartition</span>(decorrel_mtcars<span class="op">$</span>mpg, <span class="dt">p =</span> .<span class="dv">8</span>, 
                                  <span class="dt">list =</span> <span class="ot">FALSE</span>, 
                                  <span class="dt">times =</span> <span class="dv">1</span>)
train &lt;-<span class="st"> </span>decorrel_mtcars[ idx,]
test  &lt;-<span class="st"> </span>decorrel_mtcars[<span class="op">-</span>idx,]

decorrel_lm &lt;-<span class="st"> </span><span class="kw">train</span>(mpg<span class="op">~</span>.,
                     <span class="dt">data =</span> train,
                     <span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>,
                     <span class="dt">metric =</span> <span class="st">&quot;RMSE&quot;</span>
                     )</code></pre></div>
</div>
</div>
<div id="ranking-features" class="section level2">
<h2><span class="header-section-number">9.7</span> Ranking Features</h2>
<p>Another approach would be to identify the imporant variables as determined by a rigorous, reliable and statistically aware process. Some models will report this information as part of the computation. The <strong>caret</strong> package has a function called <strong>varImp</strong> which helps to calculate relative variable importance within an object produced by the <strong>train</strong> function. What this means for us is that we can take most models built with <strong>train</strong> and pass it to the <strong>varImp</strong> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">idx &lt;-<span class="st"> </span><span class="kw">createDataPartition</span>(mtcars<span class="op">$</span>mpg, <span class="dt">p =</span> .<span class="dv">8</span>, 
                                  <span class="dt">list =</span> <span class="ot">FALSE</span>, 
                                  <span class="dt">times =</span> <span class="dv">1</span>)
train &lt;-<span class="st"> </span>mtcars[ idx,]
test  &lt;-<span class="st"> </span>mtcars[<span class="op">-</span>idx,]

myLm &lt;-<span class="st"> </span><span class="kw">train</span>(mpg<span class="op">~</span>.,
                     <span class="dt">data =</span> train,
                     <span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>,
                     <span class="dt">metric =</span> <span class="st">&quot;RMSE&quot;</span>
                     )

<span class="kw">summary</span>(myLm)</code></pre></div>
<pre><code>## 
## Call:
## lm(formula = .outcome ~ ., data = dat)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -3.3535 -1.3186 -0.1256  1.1996  4.5252 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)  
## (Intercept) 10.42918   20.41066   0.511   0.6159  
## cyl          0.06323    1.17927   0.054   0.9579  
## disp         0.01922    0.02092   0.919   0.3711  
## hp          -0.02982    0.02616  -1.140   0.2701  
## drat         0.48349    1.80885   0.267   0.7925  
## wt          -4.10842    2.02290  -2.031   0.0582 .
## qsec         1.01755    0.80247   1.268   0.2219  
## vs           0.12678    2.26134   0.056   0.9559  
## am           3.84834    2.48430   1.549   0.1398  
## gear         0.20807    1.66454   0.125   0.9020  
## carb         0.09515    0.95574   0.100   0.9219  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.799 on 17 degrees of freedom
## Multiple R-squared:  0.8653, Adjusted R-squared:  0.786 
## F-statistic: 10.92 on 10 and 17 DF,  p-value: 1.427e-05</code></pre>
<p>If you look at the summary of the model it looks pretty bleak because mot of the coefficients aren’t significant. You wouldn’t want to take your career on this model.</p>
<p>Now let’s see what variables are considered to be important by using <strong>varImp</strong>. Remember that this might lead us to use a subset of the more prominent variables in the formation of a new model in case, for example, the coefficients in the exisitng model weren’t significant.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="kw">varImp</span>(myLm))</code></pre></div>
<p><img src="biosml_files/figure-html/unnamed-chunk-102-1.png" width="672" /></p>
<p>How do things look in the model if we limit the formula to some of the “important” (allegedly) features ? Well, it expliains more of the variance with fewer predictors (the R^2 value). Both <strong>wt</strong> and <strong>hp</strong> are significant. That’s a start.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">myLm &lt;-<span class="st"> </span><span class="kw">train</span>(mpg<span class="op">~</span>wt<span class="op">+</span>disp<span class="op">+</span>hp,
                     <span class="dt">data =</span> train,
                     <span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>,
                     <span class="dt">metric =</span> <span class="st">&quot;RMSE&quot;</span>
                     )

<span class="kw">summary</span>(myLm)</code></pre></div>
<pre><code>## 
## Call:
## lm(formula = .outcome ~ ., data = dat)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -4.2102 -1.6149 -0.2855  0.8671  5.7722 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 37.586172   2.233998  16.825  8.7e-15 ***
## wt          -4.086950   1.147622  -3.561  0.00158 ** 
## disp         0.002663   0.011268   0.236  0.81519    
## hp          -0.032979   0.012535  -2.631  0.01464 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.727 on 24 degrees of freedom
## Multiple R-squared:  0.8195, Adjusted R-squared:  0.797 
## F-statistic: 36.33 on 3 and 24 DF,  p-value: 4.39e-09</code></pre>
</div>
<div id="feature-selection-1" class="section level2">
<h2><span class="header-section-number">9.8</span> Feature Selection</h2>
<p>Being able to automatically include only the most important features is desireable (again an example might be Step Wise Regression). Caret provides its own function to do a simple backwards selection to recursively eliminate features based on how they contribute (or not) to the model. You could do all of this by hand yourself of course.</p>
<p>Automatic feature selection methods can be used to build many models with different subsets of a dataset and identify those attributes that are and are not required to build an accurate model. The <strong>caret</strong> package has a function called *rfe** to implement this. However, it involves some additional setup:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rfeControl &lt;-<span class="st"> </span><span class="kw">rfeControl</span>(<span class="dt">functions=</span>lmFuncs, <span class="dt">method=</span><span class="st">&quot;cv&quot;</span>, <span class="dt">number=</span><span class="dv">10</span>)

results &lt;-<span class="st"> </span><span class="kw">rfe</span>(mtcars[,<span class="dv">2</span><span class="op">:</span><span class="dv">11</span>], 
               mtcars[,<span class="dv">1</span>], 
               <span class="dt">sizes=</span><span class="kw">c</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">11</span>), 
               <span class="dt">rfeControl=</span>rfeControl)

<span class="kw">print</span>(results)</code></pre></div>
<pre><code>## 
## Recursive feature selection
## 
## Outer resampling method: Cross-Validated (10 fold) 
## 
## Resampling performance over subset size:
## 
##  Variables  RMSE Rsquared   MAE RMSESD RsquaredSD  MAESD Selected
##          2 2.957   0.7969 2.468  1.137     0.2097 0.9631         
##          3 2.866   0.8745 2.382  1.152     0.1188 0.9158        *
##          4 3.013   0.8685 2.564  1.164     0.1252 0.9699         
##          5 2.984   0.8719 2.569  1.260     0.1620 1.0733         
##          6 3.394   0.8400 2.896  1.459     0.1678 1.2158         
##          7 3.354   0.8515 2.809  1.693     0.1957 1.4458         
##          8 3.372   0.8529 2.868  1.657     0.1932 1.4344         
##          9 3.726   0.8459 3.252  1.706     0.1953 1.3802         
##         10 3.555   0.8564 3.131  1.683     0.1792 1.4051         
## 
## The top 3 variables (out of 3):
##    wt, am, drat</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(results,<span class="dt">type=</span><span class="kw">c</span>(<span class="st">&quot;g&quot;</span>,<span class="st">&quot;o&quot;</span>))</code></pre></div>
<p><img src="biosml_files/figure-html/unnamed-chunk-104-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">myLm &lt;-<span class="st"> </span><span class="kw">train</span>(mpg<span class="op">~</span>wt<span class="op">+</span>am<span class="op">+</span>qsec,
                     <span class="dt">data =</span> train,
                     <span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>,
                     <span class="dt">metric =</span> <span class="st">&quot;RMSE&quot;</span>
                     )

<span class="kw">summary</span>(myLm)</code></pre></div>
<pre><code>## 
## Call:
## lm(formula = .outcome ~ ., data = dat)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -3.5128 -1.9473 -0.5083  1.4113  4.6227 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)    9.748      7.828   1.245  0.22506    
## wt            -3.746      0.838  -4.471  0.00016 ***
## am             3.293      1.610   2.045  0.05192 .  
## qsec           1.180      0.316   3.734  0.00103 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.564 on 24 degrees of freedom
## Multiple R-squared:  0.8404, Adjusted R-squared:  0.8204 
## F-statistic: 42.12 on 3 and 24 DF,  p-value: 1.019e-09</code></pre>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="picking-the-best-model.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="classification-problems.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
