<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 11 Data Pre Processing | Predictive Learning in R</title>
  <meta name="description" content="Chapter 11 Data Pre Processing | Predictive Learning in R" />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 11 Data Pre Processing | Predictive Learning in R" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 11 Data Pre Processing | Predictive Learning in R" />
  
  
  

<meta name="author" content="Steve Pittard - wsp@emory.edu" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="selecting-the-best-model.html"/>
<link rel="next" href="using-external-ml-frameworks.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#machine-learning"><i class="fa fa-check"></i><b>1.1</b> Machine Learning</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#predictive-modeling"><i class="fa fa-check"></i><b>1.2</b> Predictive Modeling</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#in-sample-vs-out-of-sample-error"><i class="fa fa-check"></i><b>1.3</b> In-Sample vs Out-Of-Sample Error</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#performance-metrics"><i class="fa fa-check"></i><b>1.4</b> Performance Metrics</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#black-box"><i class="fa fa-check"></i><b>1.5</b> Black Box</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="predictive-supervised-learning.html"><a href="predictive-supervised-learning.html"><i class="fa fa-check"></i><b>2</b> Predictive / Supervised Learning</a><ul>
<li class="chapter" data-level="2.1" data-path="predictive-supervised-learning.html"><a href="predictive-supervised-learning.html#explanation-vs-prediction"><i class="fa fa-check"></i><b>2.1</b> Explanation vs Prediction</a><ul>
<li class="chapter" data-level="2.1.1" data-path="predictive-supervised-learning.html"><a href="predictive-supervised-learning.html#titanic-data"><i class="fa fa-check"></i><b>2.1.1</b> Titanic Data</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="predictive-supervised-learning.html"><a href="predictive-supervised-learning.html#bias-vs-variance"><i class="fa fa-check"></i><b>2.2</b> Bias vs Variance</a><ul>
<li class="chapter" data-level="2.2.1" data-path="predictive-supervised-learning.html"><a href="predictive-supervised-learning.html#bias"><i class="fa fa-check"></i><b>2.2.1</b> Bias</a></li>
<li class="chapter" data-level="2.2.2" data-path="predictive-supervised-learning.html"><a href="predictive-supervised-learning.html#variance"><i class="fa fa-check"></i><b>2.2.2</b> Variance</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="predictive-supervised-learning.html"><a href="predictive-supervised-learning.html#overfitting-and-underfitting"><i class="fa fa-check"></i><b>2.3</b> Overfitting and Underfitting</a></li>
<li class="chapter" data-level="2.4" data-path="predictive-supervised-learning.html"><a href="predictive-supervised-learning.html#some-important-terminology"><i class="fa fa-check"></i><b>2.4</b> Some Important Terminology</a></li>
<li class="chapter" data-level="2.5" data-path="predictive-supervised-learning.html"><a href="predictive-supervised-learning.html#levels-of-measurement"><i class="fa fa-check"></i><b>2.5</b> Levels of Measurement</a><ul>
<li class="chapter" data-level="2.5.1" data-path="predictive-supervised-learning.html"><a href="predictive-supervised-learning.html#nominal"><i class="fa fa-check"></i><b>2.5.1</b> Nominal</a></li>
<li class="chapter" data-level="2.5.2" data-path="predictive-supervised-learning.html"><a href="predictive-supervised-learning.html#ordinal"><i class="fa fa-check"></i><b>2.5.2</b> Ordinal</a></li>
<li class="chapter" data-level="2.5.3" data-path="predictive-supervised-learning.html"><a href="predictive-supervised-learning.html#interval"><i class="fa fa-check"></i><b>2.5.3</b> Interval</a></li>
<li class="chapter" data-level="2.5.4" data-path="predictive-supervised-learning.html"><a href="predictive-supervised-learning.html#ratio"><i class="fa fa-check"></i><b>2.5.4</b> Ratio</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="a-motivating-example.html"><a href="a-motivating-example.html"><i class="fa fa-check"></i><b>3</b> A Motivating Example</a><ul>
<li class="chapter" data-level="3.1" data-path="a-motivating-example.html"><a href="a-motivating-example.html#a-more-detailed-workflow"><i class="fa fa-check"></i><b>3.1</b> A More Detailed Workflow</a></li>
<li class="chapter" data-level="3.2" data-path="a-motivating-example.html"><a href="a-motivating-example.html#visualizations"><i class="fa fa-check"></i><b>3.2</b> Visualizations</a><ul>
<li class="chapter" data-level="3.2.1" data-path="a-motivating-example.html"><a href="a-motivating-example.html#scatterplots"><i class="fa fa-check"></i><b>3.2.1</b> Scatterplots</a></li>
<li class="chapter" data-level="3.2.2" data-path="a-motivating-example.html"><a href="a-motivating-example.html#boxplots"><i class="fa fa-check"></i><b>3.2.2</b> Boxplots</a></li>
<li class="chapter" data-level="3.2.3" data-path="a-motivating-example.html"><a href="a-motivating-example.html#histograms"><i class="fa fa-check"></i><b>3.2.3</b> Histograms</a></li>
<li class="chapter" data-level="3.2.4" data-path="a-motivating-example.html"><a href="a-motivating-example.html#tables"><i class="fa fa-check"></i><b>3.2.4</b> Tables</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="a-motivating-example.html"><a href="a-motivating-example.html#correlations"><i class="fa fa-check"></i><b>3.3</b> Correlations</a></li>
<li class="chapter" data-level="3.4" data-path="a-motivating-example.html"><a href="a-motivating-example.html#building-a-model---in-sample-error"><i class="fa fa-check"></i><b>3.4</b> Building A Model - In Sample Error</a></li>
<li class="chapter" data-level="3.5" data-path="a-motivating-example.html"><a href="a-motivating-example.html#out-of-sample-data"><i class="fa fa-check"></i><b>3.5</b> Out Of Sample Data</a></li>
<li class="chapter" data-level="3.6" data-path="a-motivating-example.html"><a href="a-motivating-example.html#some-additional-considerations"><i class="fa fa-check"></i><b>3.6</b> Some Additional Considerations</a></li>
<li class="chapter" data-level="3.7" data-path="a-motivating-example.html"><a href="a-motivating-example.html#other-methods"><i class="fa fa-check"></i><b>3.7</b> Other Methods ?</a></li>
<li class="chapter" data-level="3.8" data-path="a-motivating-example.html"><a href="a-motivating-example.html#summary"><i class="fa fa-check"></i><b>3.8</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="training-test-data.html"><a href="training-test-data.html"><i class="fa fa-check"></i><b>4</b> Training / Test Data</a><ul>
<li class="chapter" data-level="4.1" data-path="training-test-data.html"><a href="training-test-data.html#cross-fold-validation"><i class="fa fa-check"></i><b>4.1</b> Cross Fold Validation</a></li>
<li class="chapter" data-level="4.2" data-path="training-test-data.html"><a href="training-test-data.html#create-a-function-to-automate-things"><i class="fa fa-check"></i><b>4.2</b> Create A Function To Automate Things</a></li>
<li class="chapter" data-level="4.3" data-path="training-test-data.html"><a href="training-test-data.html#repeated-cross-validation"><i class="fa fa-check"></i><b>4.3</b> Repeated Cross Validation</a></li>
<li class="chapter" data-level="4.4" data-path="training-test-data.html"><a href="training-test-data.html#bootstrap"><i class="fa fa-check"></i><b>4.4</b> Bootstrap</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="caret-package.html"><a href="caret-package.html"><i class="fa fa-check"></i><b>5</b> Caret Package</a><ul>
<li class="chapter" data-level="5.1" data-path="caret-package.html"><a href="caret-package.html#putting-caret-to-work"><i class="fa fa-check"></i><b>5.1</b> Putting caret To Work</a></li>
<li class="chapter" data-level="5.2" data-path="caret-package.html"><a href="caret-package.html#back-to-the-beginning"><i class="fa fa-check"></i><b>5.2</b> Back To The Beginning</a></li>
<li class="chapter" data-level="5.3" data-path="caret-package.html"><a href="caret-package.html#splitting"><i class="fa fa-check"></i><b>5.3</b> Splitting</a></li>
<li class="chapter" data-level="5.4" data-path="caret-package.html"><a href="caret-package.html#calling-the-train-function"><i class="fa fa-check"></i><b>5.4</b> Calling The train() Function</a></li>
<li class="chapter" data-level="5.5" data-path="caret-package.html"><a href="caret-package.html#reproducible-results"><i class="fa fa-check"></i><b>5.5</b> Reproducible Results</a></li>
<li class="chapter" data-level="5.6" data-path="caret-package.html"><a href="caret-package.html#one-size-fits-all"><i class="fa fa-check"></i><b>5.6</b> One Size Fits All</a></li>
<li class="chapter" data-level="5.7" data-path="caret-package.html"><a href="caret-package.html#alternative-calling-sequence"><i class="fa fa-check"></i><b>5.7</b> Alternative Calling Sequence</a></li>
<li class="chapter" data-level="5.8" data-path="caret-package.html"><a href="caret-package.html#hyperparameters"><i class="fa fa-check"></i><b>5.8</b> Hyperparameters</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="classification-problems.html"><a href="classification-problems.html"><i class="fa fa-check"></i><b>6</b> Classification Problems</a><ul>
<li class="chapter" data-level="6.1" data-path="classification-problems.html"><a href="classification-problems.html#performance-measures"><i class="fa fa-check"></i><b>6.1</b> Performance Measures</a></li>
<li class="chapter" data-level="6.2" data-path="classification-problems.html"><a href="classification-problems.html#important-terminology"><i class="fa fa-check"></i><b>6.2</b> Important Terminology</a></li>
<li class="chapter" data-level="6.3" data-path="classification-problems.html"><a href="classification-problems.html#a-basic-model"><i class="fa fa-check"></i><b>6.3</b> A Basic Model</a></li>
<li class="chapter" data-level="6.4" data-path="classification-problems.html"><a href="classification-problems.html#selecting-the-correct-threshold-alpha"><i class="fa fa-check"></i><b>6.4</b> Selecting The Correct Threshold / Alpha</a><ul>
<li class="chapter" data-level="6.4.1" data-path="classification-problems.html"><a href="classification-problems.html#moving-the-threshold"><i class="fa fa-check"></i><b>6.4.1</b> Moving The Threshold</a></li>
<li class="chapter" data-level="6.4.2" data-path="classification-problems.html"><a href="classification-problems.html#distribution-of-predicted-probabilities"><i class="fa fa-check"></i><b>6.4.2</b> Distribution of Predicted Probabilities</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="classification-problems.html"><a href="classification-problems.html#hypothesis-testing"><i class="fa fa-check"></i><b>6.5</b> Hypothesis Testing</a></li>
<li class="chapter" data-level="6.6" data-path="classification-problems.html"><a href="classification-problems.html#confusion-matrix"><i class="fa fa-check"></i><b>6.6</b> Confusion Matrix</a><ul>
<li class="chapter" data-level="6.6.1" data-path="classification-problems.html"><a href="classification-problems.html#computing-performance-metrics"><i class="fa fa-check"></i><b>6.6.1</b> Computing Performance Metrics</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="classification-problems.html"><a href="classification-problems.html#picking-the-right-metric"><i class="fa fa-check"></i><b>6.7</b> Picking the Right Metric</a></li>
<li class="chapter" data-level="6.8" data-path="classification-problems.html"><a href="classification-problems.html#wait.-where-are-we"><i class="fa fa-check"></i><b>6.8</b> Wait. Where Are We ?</a></li>
<li class="chapter" data-level="6.9" data-path="classification-problems.html"><a href="classification-problems.html#other-ways-to-compute-the-roc-curve"><i class="fa fa-check"></i><b>6.9</b> Other Ways To Compute The ROC Curve</a></li>
<li class="chapter" data-level="6.10" data-path="classification-problems.html"><a href="classification-problems.html#roc-curve-summary"><i class="fa fa-check"></i><b>6.10</b> ROC Curve Summary</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="classification-example.html"><a href="classification-example.html"><i class="fa fa-check"></i><b>7</b> Classification Example</a><ul>
<li class="chapter" data-level="7.1" data-path="classification-example.html"><a href="classification-example.html#exploratory-plots"><i class="fa fa-check"></i><b>7.1</b> Exploratory Plots</a></li>
<li class="chapter" data-level="7.2" data-path="classification-example.html"><a href="classification-example.html#generalized-linear-models"><i class="fa fa-check"></i><b>7.2</b> Generalized Linear Models</a></li>
<li class="chapter" data-level="7.3" data-path="classification-example.html"><a href="classification-example.html#random-forests"><i class="fa fa-check"></i><b>7.3</b> Random Forests</a></li>
<li class="chapter" data-level="7.4" data-path="classification-example.html"><a href="classification-example.html#target-variable-format"><i class="fa fa-check"></i><b>7.4</b> Target Variable Format</a></li>
<li class="chapter" data-level="7.5" data-path="classification-example.html"><a href="classification-example.html#addressing-class-imbalance"><i class="fa fa-check"></i><b>7.5</b> Addressing Class Imbalance</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="decision-trees.html"><a href="decision-trees.html"><i class="fa fa-check"></i><b>8</b> Decision Trees</a><ul>
<li class="chapter" data-level="8.1" data-path="decision-trees.html"><a href="decision-trees.html#advantages"><i class="fa fa-check"></i><b>8.1</b> Advantages</a></li>
<li class="chapter" data-level="8.2" data-path="decision-trees.html"><a href="decision-trees.html#a-classification-example"><i class="fa fa-check"></i><b>8.2</b> A Classification Example</a></li>
<li class="chapter" data-level="8.3" data-path="decision-trees.html"><a href="decision-trees.html#digging-deeper"><i class="fa fa-check"></i><b>8.3</b> Digging Deeper</a><ul>
<li class="chapter" data-level="8.3.1" data-path="decision-trees.html"><a href="decision-trees.html#evaluating-performance"><i class="fa fa-check"></i><b>8.3.1</b> Evaluating performance</a></li>
<li class="chapter" data-level="8.3.2" data-path="decision-trees.html"><a href="decision-trees.html#tree-splitting"><i class="fa fa-check"></i><b>8.3.2</b> Tree Splitting</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="decision-trees.html"><a href="decision-trees.html#gini-index"><i class="fa fa-check"></i><b>8.4</b> Gini Index</a></li>
<li class="chapter" data-level="8.5" data-path="decision-trees.html"><a href="decision-trees.html#regression-trees"><i class="fa fa-check"></i><b>8.5</b> Regression Trees</a><ul>
<li class="chapter" data-level="8.5.1" data-path="decision-trees.html"><a href="decision-trees.html#performance-measure"><i class="fa fa-check"></i><b>8.5.1</b> Performance Measure</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="decision-trees.html"><a href="decision-trees.html#parameters-vs-hyperparameters"><i class="fa fa-check"></i><b>8.6</b> Parameters vs Hyperparameters</a></li>
<li class="chapter" data-level="8.7" data-path="decision-trees.html"><a href="decision-trees.html#grid-searching"><i class="fa fa-check"></i><b>8.7</b> Grid Searching</a></li>
<li class="chapter" data-level="8.8" data-path="decision-trees.html"><a href="decision-trees.html#bagged-trees"><i class="fa fa-check"></i><b>8.8</b> Bagged Trees</a></li>
<li class="chapter" data-level="8.9" data-path="decision-trees.html"><a href="decision-trees.html#random-forests-1"><i class="fa fa-check"></i><b>8.9</b> Random Forests</a></li>
<li class="chapter" data-level="8.10" data-path="decision-trees.html"><a href="decision-trees.html#boosted-trees"><i class="fa fa-check"></i><b>8.10</b> Boosted Trees</a></li>
<li class="chapter" data-level="8.11" data-path="decision-trees.html"><a href="decision-trees.html#using-caret"><i class="fa fa-check"></i><b>8.11</b> Using caret</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="using-methods-other-than-lm.html"><a href="using-methods-other-than-lm.html"><i class="fa fa-check"></i><b>9</b> Using Methods Other Than lm</a><ul>
<li class="chapter" data-level="9.1" data-path="using-methods-other-than-lm.html"><a href="using-methods-other-than-lm.html#parameters-vs-hyperparameters-1"><i class="fa fa-check"></i><b>9.1</b> Parameters vs Hyperparameters</a></li>
<li class="chapter" data-level="9.2" data-path="using-methods-other-than-lm.html"><a href="using-methods-other-than-lm.html#hyperparameter-tuning"><i class="fa fa-check"></i><b>9.2</b> Hyperparameter Tuning</a><ul>
<li class="chapter" data-level="9.2.1" data-path="using-methods-other-than-lm.html"><a href="using-methods-other-than-lm.html#multiple-hyperparameters"><i class="fa fa-check"></i><b>9.2.1</b> Multiple Hyperparameters ?</a></li>
<li class="chapter" data-level="9.2.2" data-path="using-methods-other-than-lm.html"><a href="using-methods-other-than-lm.html#custom-tuning-grid"><i class="fa fa-check"></i><b>9.2.2</b> Custom Tuning Grid</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="using-methods-other-than-lm.html"><a href="using-methods-other-than-lm.html#using-validation-data-sets"><i class="fa fa-check"></i><b>9.3</b> Using Validation Data Sets</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="selecting-the-best-model.html"><a href="selecting-the-best-model.html"><i class="fa fa-check"></i><b>10</b> Selecting The Best Model</a><ul>
<li class="chapter" data-level="10.1" data-path="selecting-the-best-model.html"><a href="selecting-the-best-model.html#an-example"><i class="fa fa-check"></i><b>10.1</b> An Example</a></li>
<li class="chapter" data-level="10.2" data-path="selecting-the-best-model.html"><a href="selecting-the-best-model.html#more-comparisons"><i class="fa fa-check"></i><b>10.2</b> More Comparisons</a></li>
<li class="chapter" data-level="10.3" data-path="selecting-the-best-model.html"><a href="selecting-the-best-model.html#using-the-resamples-function"><i class="fa fa-check"></i><b>10.3</b> Using the resamples() function</a></li>
<li class="chapter" data-level="10.4" data-path="selecting-the-best-model.html"><a href="selecting-the-best-model.html#model-performance"><i class="fa fa-check"></i><b>10.4</b> Model Performance</a></li>
<li class="chapter" data-level="10.5" data-path="selecting-the-best-model.html"><a href="selecting-the-best-model.html#feature-evaluation"><i class="fa fa-check"></i><b>10.5</b> Feature Evaluation</a><ul>
<li class="chapter" data-level="10.5.1" data-path="selecting-the-best-model.html"><a href="selecting-the-best-model.html#identifying-redundant-features"><i class="fa fa-check"></i><b>10.5.1</b> Identifying Redundant Features</a></li>
<li class="chapter" data-level="10.5.2" data-path="selecting-the-best-model.html"><a href="selecting-the-best-model.html#highly-correlated-variables"><i class="fa fa-check"></i><b>10.5.2</b> Highly Correlated Variables</a></li>
<li class="chapter" data-level="10.5.3" data-path="selecting-the-best-model.html"><a href="selecting-the-best-model.html#ranking-features"><i class="fa fa-check"></i><b>10.5.3</b> Ranking Features</a></li>
<li class="chapter" data-level="10.5.4" data-path="selecting-the-best-model.html"><a href="selecting-the-best-model.html#feature-selection"><i class="fa fa-check"></i><b>10.5.4</b> Feature Selection</a></li>
<li class="chapter" data-level="10.5.5" data-path="selecting-the-best-model.html"><a href="selecting-the-best-model.html#recursive-feature-elimination"><i class="fa fa-check"></i><b>10.5.5</b> Recursive Feature Elimination</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="data-pre-processing.html"><a href="data-pre-processing.html"><i class="fa fa-check"></i><b>11</b> Data Pre Processing</a><ul>
<li class="chapter" data-level="11.1" data-path="data-pre-processing.html"><a href="data-pre-processing.html#types-of-pre-processing"><i class="fa fa-check"></i><b>11.1</b> Types of Pre Processing</a></li>
<li class="chapter" data-level="11.2" data-path="data-pre-processing.html"><a href="data-pre-processing.html#missing-values"><i class="fa fa-check"></i><b>11.2</b> Missing Values</a><ul>
<li class="chapter" data-level="11.2.1" data-path="data-pre-processing.html"><a href="data-pre-processing.html#finding-rows-with-missing-data"><i class="fa fa-check"></i><b>11.2.1</b> Finding Rows with Missing Data</a></li>
<li class="chapter" data-level="11.2.2" data-path="data-pre-processing.html"><a href="data-pre-processing.html#finding-columns-with-missing-data"><i class="fa fa-check"></i><b>11.2.2</b> Finding Columns With Missing Data</a></li>
<li class="chapter" data-level="11.2.3" data-path="data-pre-processing.html"><a href="data-pre-processing.html#use-the-median-approach"><i class="fa fa-check"></i><b>11.2.3</b> Use the Median Approach</a></li>
<li class="chapter" data-level="11.2.4" data-path="data-pre-processing.html"><a href="data-pre-processing.html#package-based-approach"><i class="fa fa-check"></i><b>11.2.4</b> Package-based Approach</a></li>
<li class="chapter" data-level="11.2.5" data-path="data-pre-processing.html"><a href="data-pre-processing.html#using-caret-1"><i class="fa fa-check"></i><b>11.2.5</b> Using caret</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="data-pre-processing.html"><a href="data-pre-processing.html#scaling"><i class="fa fa-check"></i><b>11.3</b> Scaling</a><ul>
<li class="chapter" data-level="11.3.1" data-path="data-pre-processing.html"><a href="data-pre-processing.html#methods-that-benefit-from-scaling"><i class="fa fa-check"></i><b>11.3.1</b> Methods That Benefit From Scaling</a></li>
<li class="chapter" data-level="11.3.2" data-path="data-pre-processing.html"><a href="data-pre-processing.html#methods-that-do-not-require-scaling"><i class="fa fa-check"></i><b>11.3.2</b> Methods That Do Not Require Scaling</a></li>
<li class="chapter" data-level="11.3.3" data-path="data-pre-processing.html"><a href="data-pre-processing.html#how-to-scale"><i class="fa fa-check"></i><b>11.3.3</b> How To Scale</a></li>
<li class="chapter" data-level="11.3.4" data-path="data-pre-processing.html"><a href="data-pre-processing.html#order-of-processing"><i class="fa fa-check"></i><b>11.3.4</b> Order of Processing</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="data-pre-processing.html"><a href="data-pre-processing.html#low-variance-variables"><i class="fa fa-check"></i><b>11.4</b> Low Variance Variables</a></li>
<li class="chapter" data-level="11.5" data-path="data-pre-processing.html"><a href="data-pre-processing.html#pca---principal-components-analysis"><i class="fa fa-check"></i><b>11.5</b> PCA - Principal Components Analysis</a><ul>
<li class="chapter" data-level="11.5.1" data-path="data-pre-processing.html"><a href="data-pre-processing.html#identify-the-factors"><i class="fa fa-check"></i><b>11.5.1</b> Identify The Factors</a></li>
<li class="chapter" data-level="11.5.2" data-path="data-pre-processing.html"><a href="data-pre-processing.html#check-for-high-correlations"><i class="fa fa-check"></i><b>11.5.2</b> Check For High Correlations</a></li>
<li class="chapter" data-level="11.5.3" data-path="data-pre-processing.html"><a href="data-pre-processing.html#so-why-use-pca"><i class="fa fa-check"></i><b>11.5.3</b> So Why Use PCA ?</a></li>
<li class="chapter" data-level="11.5.4" data-path="data-pre-processing.html"><a href="data-pre-processing.html#check-the-biplot"><i class="fa fa-check"></i><b>11.5.4</b> Check The BiPlot</a></li>
<li class="chapter" data-level="11.5.5" data-path="data-pre-processing.html"><a href="data-pre-processing.html#check-the-screeplot"><i class="fa fa-check"></i><b>11.5.5</b> Check The ScreePlot</a></li>
<li class="chapter" data-level="11.5.6" data-path="data-pre-processing.html"><a href="data-pre-processing.html#use-the-transformed-data"><i class="fa fa-check"></i><b>11.5.6</b> Use The Transformed Data</a></li>
<li class="chapter" data-level="11.5.7" data-path="data-pre-processing.html"><a href="data-pre-processing.html#pls"><i class="fa fa-check"></i><b>11.5.7</b> PLS</a></li>
<li class="chapter" data-level="11.5.8" data-path="data-pre-processing.html"><a href="data-pre-processing.html#summary-1"><i class="fa fa-check"></i><b>11.5.8</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="11.6" data-path="data-pre-processing.html"><a href="data-pre-processing.html#order-of-pre-processing"><i class="fa fa-check"></i><b>11.6</b> Order of Pre-Processing</a></li>
<li class="chapter" data-level="11.7" data-path="data-pre-processing.html"><a href="data-pre-processing.html#handling-categories"><i class="fa fa-check"></i><b>11.7</b> Handling Categories</a><ul>
<li class="chapter" data-level="11.7.1" data-path="data-pre-processing.html"><a href="data-pre-processing.html#examples"><i class="fa fa-check"></i><b>11.7.1</b> Examples</a></li>
<li class="chapter" data-level="11.7.2" data-path="data-pre-processing.html"><a href="data-pre-processing.html#admissions-data"><i class="fa fa-check"></i><b>11.7.2</b> Admissions Data</a></li>
<li class="chapter" data-level="11.7.3" data-path="data-pre-processing.html"><a href="data-pre-processing.html#is-rank-a-category"><i class="fa fa-check"></i><b>11.7.3</b> Is Rank A Category ?</a></li>
<li class="chapter" data-level="11.7.4" data-path="data-pre-processing.html"><a href="data-pre-processing.html#relationship-to-one-hot-encoding"><i class="fa fa-check"></i><b>11.7.4</b> Relationship To One Hot Encoding</a></li>
</ul></li>
<li class="chapter" data-level="11.8" data-path="data-pre-processing.html"><a href="data-pre-processing.html#binning"><i class="fa fa-check"></i><b>11.8</b> Binning</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="using-external-ml-frameworks.html"><a href="using-external-ml-frameworks.html"><i class="fa fa-check"></i><b>12</b> Using External ML Frameworks</a><ul>
<li class="chapter" data-level="12.1" data-path="using-external-ml-frameworks.html"><a href="using-external-ml-frameworks.html#using-h2o"><i class="fa fa-check"></i><b>12.1</b> Using h2o</a></li>
<li class="chapter" data-level="12.2" data-path="using-external-ml-frameworks.html"><a href="using-external-ml-frameworks.html#create-some-h20-models"><i class="fa fa-check"></i><b>12.2</b> Create Some h20 Models</a></li>
<li class="chapter" data-level="12.3" data-path="using-external-ml-frameworks.html"><a href="using-external-ml-frameworks.html#saving-a-model"><i class="fa fa-check"></i><b>12.3</b> Saving A Model</a></li>
<li class="chapter" data-level="12.4" data-path="using-external-ml-frameworks.html"><a href="using-external-ml-frameworks.html#using-the-h2o-auto-ml-feature"><i class="fa fa-check"></i><b>12.4</b> Using The h2o Auto ML Feature</a></li>
<li class="chapter" data-level="12.5" data-path="using-external-ml-frameworks.html"><a href="using-external-ml-frameworks.html#launching-a-job"><i class="fa fa-check"></i><b>12.5</b> Launching a Job</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Predictive Learning in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-pre-processing" class="section level1">
<h1><span class="header-section-number">Chapter 11</span> Data Pre Processing</h1>
<p>Data rarely arrives in a form that is directly suitable for use with a modeling method. There are a number of considerations to make such as how to handle missing data, highly correlated variables, and class imbalances - some categories are over or under represented. Additionally, some variables, also known as “features”, will require transformation or will need to be used to create new variables.</p>
<div id="types-of-pre-processing" class="section level2">
<h2><span class="header-section-number">11.1</span> Types of Pre Processing</h2>
<p>Consider the case where the measured data (the numeric data) might be on different scales (e.g. height vs weight). This might result in the need to scale and center the data. Some methods take this into consideration whereas others do not. Suffice it to say that data prep can be an ongoing process that requires a number of experiments before arriving at the best form of data.</p>
</div>
<div id="missing-values" class="section level2">
<h2><span class="header-section-number">11.2</span> Missing Values</h2>
<p>This is a frequent situation in real life. Think of patients checking in for clinic visits over time. Sometimes they come for their appointments, sometimes they don’t. Sometimes when they do come, their information has changed or some diagnostic test is repeated with a new result which is entered or not. Or, whomever maintains the patient database, decides to add in some new variables to measure for all patients moving forward. This means that all existing patients will have missing values for those new variables. To see how this manifests practically in predictive learning consider the following version of the mtcars data frame which has some missing values:</p>
<div class="sourceCode" id="cb481"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb481-1" data-line-number="1"><span class="kw">library</span>(readr)</a>
<a class="sourceLine" id="cb481-2" data-line-number="2">url &lt;-<span class="st"> &quot;https://raw.githubusercontent.com/steviep42/utilities/master/data/mtcars_na.csv&quot;</span></a>
<a class="sourceLine" id="cb481-3" data-line-number="3">mtcars_na &lt;-<span class="st"> </span><span class="kw">read.csv</span>(url, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<div id="finding-rows-with-missing-data" class="section level3">
<h3><span class="header-section-number">11.2.1</span> Finding Rows with Missing Data</h3>
<p>Ar first glance it looks like all features have valid variable values but we can look for missing values which, in R, are indicated by <strong>NA</strong> Base R provides a number of commands to do this. First let’s see how many rows there are in the data frame.</p>
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb482-1" data-line-number="1"><span class="kw">nrow</span>(mtcars_na)</a></code></pre></div>
<pre><code>## [1] 32</code></pre>
<p>Now let’s see how many rows have at least one column with a missing value. So we have eight rows in the data frame that contain one or more missing values.</p>
<div class="sourceCode" id="cb484"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb484-1" data-line-number="1"><span class="kw">sum</span>(<span class="kw">complete.cases</span>(mtcars_na))</a></code></pre></div>
<pre><code>## [1] 24</code></pre>
</div>
<div id="finding-columns-with-missing-data" class="section level3">
<h3><span class="header-section-number">11.2.2</span> Finding Columns With Missing Data</h3>
<p>What columns have missing values ? Here we leverage the use of the apply family of functions along with the ability to create <strong>anonymous</strong> functions on the fly. Both R and Python provide this capability. We see that the <strong>wt</strong> column has three missing values and the <strong>carb</strong> feature has six missing values.</p>
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb486-1" data-line-number="1"><span class="kw">sapply</span>(mtcars_na,<span class="cf">function</span>(x) <span class="kw">sum</span>(<span class="kw">is.na</span>(x)))</a></code></pre></div>
<pre><code>##  mpg  cyl disp   hp drat   wt qsec   vs   am gear carb 
##    0    0    0    0    0    3    0    0    0    0    6</code></pre>
<p>If we actually wanted to see all rows with missing values:</p>
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb488-1" data-line-number="1">mtcars_na[<span class="op">!</span><span class="kw">complete.cases</span>(mtcars_na),]</a></code></pre></div>
<pre><code>##     mpg cyl  disp  hp drat   wt qsec vs am gear carb
## 2  21.0   6 160.0 110 3.90   NA 17.0  0  1    4    4
## 9  22.8   4 140.8  95 3.92   NA 22.9  1  0    4    2
## 10 19.2   6 167.6 123 3.92 3.44 18.3  1  0    4   NA
## 12 16.4   8 275.8 180 3.07 4.07 17.4  0  0    3   NA
## 19 30.4   4  75.7  52 4.93 1.61 18.5  1  1    4   NA
## 20 33.9   4  71.1  65 4.22 1.83 19.9  1  1    4   NA
## 23 15.2   8 304.0 150 3.15   NA 17.3  0  0    3   NA
## 28 30.4   4  95.1 113 3.77 1.51 16.9  1  1    5   NA</code></pre>
<p>We might also consider using the <strong>DataExplorer</strong> package to help us identify the “missingness” of the data:</p>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb490-1" data-line-number="1">DataExplorer<span class="op">::</span><span class="kw">plot_missing</span>(mtcars_na)</a></code></pre></div>
<p><img src="biosml_files/figure-html/dataexp2-1.png" width="672" /></p>
<p>What do we do with these ? It depends on a number of things. How hard is it to get this type of data ? If it’s rare information then we probably want to keep as much of the data as possible. In fact, if most of the data in a given row is present maybe one strategy is to tell whatever modeling method we use to ignore the missing values (na.rm = TRUE). Some methods might do this by default without you even asking.</p>
<p>However, if we have plenty of data we could just filter out any row from the data frame that contains any missing values. In this case we would lose eight rows of data. This is low stakes data but if this were rare or hard to obtain information then we wouldn’t want to do this.</p>
<div class="sourceCode" id="cb491"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb491-1" data-line-number="1">mtcars_no_na &lt;-<span class="st"> </span>mtcars_na[<span class="kw">complete.cases</span>(mtcars_na),]</a>
<a class="sourceLine" id="cb491-2" data-line-number="2"><span class="kw">nrow</span>(mtcars_no_na)</a></code></pre></div>
<pre><code>## [1] 24</code></pre>
</div>
<div id="use-the-median-approach" class="section level3">
<h3><span class="header-section-number">11.2.3</span> Use the Median Approach</h3>
<p>What could we do ? Well we could keep all rows even if they contains NAs and then use <strong>imputation</strong> methods to supply values for the missing information. There are R packages that do this but one quick way to do this without going that route is to replace the missing value in the <strong>wt</strong> column with the <strong>median</strong> value for the entire column.</p>
<p>Using median is appropriate when the missing values are of the “missing at random” variety. There might some bias in the data that introduces a “not at random” situation. We’ll look at that case momentarily. Let’s look at a boxplot of the <strong>wt</strong> feature.</p>
<div class="sourceCode" id="cb493"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb493-1" data-line-number="1"><span class="kw">boxplot</span>(mtcars_na<span class="op">$</span>wt,</a>
<a class="sourceLine" id="cb493-2" data-line-number="2">        <span class="dt">na.rm=</span><span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb493-3" data-line-number="3">        <span class="dt">main=</span><span class="st">&quot;Distribution of the wt feature&quot;</span>)</a>
<a class="sourceLine" id="cb493-4" data-line-number="4"><span class="kw">grid</span>()</a></code></pre></div>
<p><img src="biosml_files/figure-html/unnamed-chunk-83-1.png" width="672" /></p>
<p>To make the substitution would involve the following. First we need to find out which row numbers have missing values for the <strong>wt</strong> feature.</p>
<div class="sourceCode" id="cb494"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb494-1" data-line-number="1">(missing_wt_indices &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">is.na</span>(mtcars_na<span class="op">$</span>wt)))</a></code></pre></div>
<pre><code>## [1]  2  9 23</code></pre>
<p>Use this information with the data frame bracket notation see the rows where the NAs occur for the <strong>wt</strong> feature</p>
<div class="sourceCode" id="cb496"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb496-1" data-line-number="1">mtcars_na[missing_wt_indices,]</a></code></pre></div>
<pre><code>##     mpg cyl disp  hp drat wt qsec vs am gear carb
## 2  21.0   6  160 110 3.90 NA 17.0  0  1    4    4
## 9  22.8   4  141  95 3.92 NA 22.9  1  0    4    2
## 23 15.2   8  304 150 3.15 NA 17.3  0  0    3   NA</code></pre>
<p>Now do the replacement</p>
<div class="sourceCode" id="cb498"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb498-1" data-line-number="1">mtcars_na[missing_wt_indices,]<span class="op">$</span>wt &lt;-<span class="st"> </span><span class="kw">median</span>(mtcars_na<span class="op">$</span>wt,<span class="dt">na.rm=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<p>Verify that the replacement was done successfully. If so, then we should see the value of 3.44 in place of the previous NA values.</p>
<div class="sourceCode" id="cb499"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb499-1" data-line-number="1">mtcars_na[missing_wt_indices,]</a></code></pre></div>
<pre><code>##     mpg cyl disp  hp drat   wt qsec vs am gear carb
## 2  21.0   6  160 110 3.90 3.44 17.0  0  1    4    4
## 9  22.8   4  141  95 3.92 3.44 22.9  1  0    4    2
## 23 15.2   8  304 150 3.15 3.44 17.3  0  0    3   NA</code></pre>
</div>
<div id="package-based-approach" class="section level3">
<h3><span class="header-section-number">11.2.4</span> Package-based Approach</h3>
<p>This seems like a lot of work and maybe it is if you aren’t up to date with your R skills although, conceptually, this is straightforward and simple. The <strong>Hmisc</strong> package provides an easy way to do this:</p>
<div class="sourceCode" id="cb501"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb501-1" data-line-number="1"><span class="co">#library(Hmisc)</span></a>
<a class="sourceLine" id="cb501-2" data-line-number="2"><span class="co"># Reload the version of mtcars with missing values</span></a>
<a class="sourceLine" id="cb501-3" data-line-number="3">url &lt;-<span class="st"> &quot;https://raw.githubusercontent.com/steviep42/utilities/master/data/mtcars_na.csv&quot;</span></a>
<a class="sourceLine" id="cb501-4" data-line-number="4">mtcars_na &lt;-<span class="st"> </span><span class="kw">read.csv</span>(url, <span class="dt">strip.white =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p>The <strong>Hmisc</strong> package provides and <strong>impute</strong> function to do the work for us. Check it out. Notice how it finds the rows for which the <strong>wt</strong> feature is missing.</p>
<div class="sourceCode" id="cb502"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb502-1" data-line-number="1">Hmisc<span class="op">::</span><span class="kw">impute</span>(mtcars_na<span class="op">$</span>wt, median)</a></code></pre></div>
<pre><code>##     1     2     3     4     5     6     7     8     9    10    11    12    13 
##  2.62 3.44*  2.32  3.21  3.44  3.46  3.57  3.19 3.44*  3.44  3.44  4.07  3.73 
##    14    15    16    17    18    19    20    21    22    23    24    25    26 
##  3.78  5.25  5.42  5.34  2.20  1.61  1.83  2.46  3.52 3.44*  3.84  3.85  1.94 
##    27    28    29    30    31    32 
##  2.14  1.51  3.17  2.77  3.57  2.78</code></pre>
<p>To do the replacement is straightforward.</p>
<div class="sourceCode" id="cb504"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb504-1" data-line-number="1">mtcars_na<span class="op">$</span>wt &lt;-<span class="st"> </span>Hmisc<span class="op">::</span><span class="kw">impute</span>(mtcars_na<span class="op">$</span>wt,median)</a></code></pre></div>
</div>
<div id="using-caret-1" class="section level3">
<h3><span class="header-section-number">11.2.5</span> Using caret</h3>
<p>Another imputation approach is to use the K-Nearest Neighbors method to find observations that are similar to the ones that contain missing data. The missing values can then be filled using information from the most similar observations. We won’t go into that choosing rather to use the convenience offered by the <strong>caret</strong> package to help us.</p>
<div class="sourceCode" id="cb505"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb505-1" data-line-number="1"><span class="co"># Make sure caret is loaded</span></a>
<a class="sourceLine" id="cb505-2" data-line-number="2"><span class="co"># library(caret)</span></a></code></pre></div>
<p>So if we choose to use caret we can use the <strong>preProcess</strong> function to signal our intent to use imputation - in this case the K-Nearest Neighbors technique. KNN imputation is particularly useful for dealing with the “not at random” situation where there could be bias in the way missing values occur. This approach looks at similar observations to those containing missing values which means that it will attempt to fill in missing values as a function of a number of variables as opposed to just one.</p>
<p>One subtlety here is that <strong>caret</strong> requires us to use an alternative to the formula interface (e.g. mpg ~ .) approach when using the <strong>train</strong> function - at least the version of <strong>caret</strong> that I am currently using.</p>
<div class="sourceCode" id="cb506"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb506-1" data-line-number="1"><span class="co"># Get a fresh copy of the mtcars_na data frame</span></a>
<a class="sourceLine" id="cb506-2" data-line-number="2">mtcars_na &lt;-<span class="st"> </span><span class="kw">read.csv</span>(url,<span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb506-3" data-line-number="3"></a>
<a class="sourceLine" id="cb506-4" data-line-number="4"><span class="co"># Set the seed for reproducibility</span></a>
<a class="sourceLine" id="cb506-5" data-line-number="5"><span class="kw">set.seed</span>(<span class="dv">123</span>)</a>
<a class="sourceLine" id="cb506-6" data-line-number="6"></a>
<a class="sourceLine" id="cb506-7" data-line-number="7"><span class="co"># Get the indices for a 70/30 split</span></a>
<a class="sourceLine" id="cb506-8" data-line-number="8">train_idx &lt;-<span class="st"> </span><span class="kw">createDataPartition</span>(mtcars_na<span class="op">$</span>mpg, </a>
<a class="sourceLine" id="cb506-9" data-line-number="9">                                 <span class="dt">p=</span>.<span class="dv">70</span>, </a>
<a class="sourceLine" id="cb506-10" data-line-number="10">                                 <span class="dt">list =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb506-11" data-line-number="11"></a>
<a class="sourceLine" id="cb506-12" data-line-number="12"><span class="co"># Split into a test / train pair</span></a>
<a class="sourceLine" id="cb506-13" data-line-number="13">train &lt;-<span class="st"> </span>mtcars[ train_idx,]</a>
<a class="sourceLine" id="cb506-14" data-line-number="14">test  &lt;-<span class="st"> </span>mtcars[<span class="op">-</span>train_idx,]</a>
<a class="sourceLine" id="cb506-15" data-line-number="15"></a>
<a class="sourceLine" id="cb506-16" data-line-number="16"><span class="co"># Note how we specify knnImpute. Another other option </span></a>
<a class="sourceLine" id="cb506-17" data-line-number="17"><span class="co"># includes medianImpute </span></a>
<a class="sourceLine" id="cb506-18" data-line-number="18"></a>
<a class="sourceLine" id="cb506-19" data-line-number="19">X &lt;-<span class="st"> </span>train[,<span class="op">-</span><span class="dv">1</span>]  <span class="co"># Use Every column EXCEPT mpg</span></a>
<a class="sourceLine" id="cb506-20" data-line-number="20">Y &lt;-<span class="st"> </span>train<span class="op">$</span>mpg   <span class="co"># This is what we want to predict</span></a>
<a class="sourceLine" id="cb506-21" data-line-number="21"></a>
<a class="sourceLine" id="cb506-22" data-line-number="22">lmFit &lt;-<span class="st"> </span><span class="kw">train</span>(X,Y,</a>
<a class="sourceLine" id="cb506-23" data-line-number="23">              <span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>,</a>
<a class="sourceLine" id="cb506-24" data-line-number="24">              <span class="dt">metric =</span> <span class="st">&quot;RMSE&quot;</span>,</a>
<a class="sourceLine" id="cb506-25" data-line-number="25">              <span class="dt">preProcess =</span> <span class="st">&quot;knnImpute&quot;</span>)</a></code></pre></div>
<pre><code>## Warning in predict.lm(modelFit, newdata): prediction from a rank-deficient fit may
## be misleading

## Warning in predict.lm(modelFit, newdata): prediction from a rank-deficient fit may
## be misleading

## Warning in predict.lm(modelFit, newdata): prediction from a rank-deficient fit may
## be misleading

## Warning in predict.lm(modelFit, newdata): prediction from a rank-deficient fit may
## be misleading</code></pre>
<div class="sourceCode" id="cb508"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb508-1" data-line-number="1">lmFit</a></code></pre></div>
<pre><code>## Linear Regression 
## 
## 24 samples
## 10 predictors
## 
## Pre-processing: nearest neighbor imputation (10), centered (10), scaled (10) 
## Resampling: Bootstrapped (25 reps) 
## Summary of sample sizes: 24, 24, 24, 24, 24, 24, ... 
## Resampling results:
## 
##   RMSE  Rsquared  MAE 
##   8.72  0.368     6.47
## 
## Tuning parameter &#39;intercept&#39; was held constant at a value of TRUE</code></pre>
<div class="sourceCode" id="cb510"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb510-1" data-line-number="1"><span class="co"># See the RMSE for the test data</span></a>
<a class="sourceLine" id="cb510-2" data-line-number="2">preds &lt;-<span class="st"> </span><span class="kw">predict</span>(lmFit, test)</a>
<a class="sourceLine" id="cb510-3" data-line-number="3">Metrics<span class="op">::</span><span class="kw">rmse</span>(test<span class="op">$</span>mpg,preds)</a></code></pre></div>
<pre><code>## [1] 3.99</code></pre>
</div>
</div>
<div id="scaling" class="section level2">
<h2><span class="header-section-number">11.3</span> Scaling</h2>
<p>In terms of what methods benefit (or require) you to scale data prior to use, consider that any method that uses the idea of “distance” will require this. This helps address the situation wherein one the size and range of one feature might overshadow another. For example, look at the range of features in the <strong>mtcars</strong> dataframe. Not only are the variables on different scales (e.g. MPG vs Weight vs Horse Power), a feature such as displacement might over influence a distance calculation when compared to qsec.</p>
<div class="sourceCode" id="cb512"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb512-1" data-line-number="1"><span class="kw">summary</span>(mtcars)</a></code></pre></div>
<pre><code>##       mpg            cyl            disp           hp           drat     
##  Min.   :10.4   Min.   :4.00   Min.   : 71   Min.   : 52   Min.   :2.76  
##  1st Qu.:15.4   1st Qu.:4.00   1st Qu.:121   1st Qu.: 96   1st Qu.:3.08  
##  Median :19.2   Median :6.00   Median :196   Median :123   Median :3.69  
##  Mean   :20.1   Mean   :6.19   Mean   :231   Mean   :147   Mean   :3.60  
##  3rd Qu.:22.8   3rd Qu.:8.00   3rd Qu.:326   3rd Qu.:180   3rd Qu.:3.92  
##  Max.   :33.9   Max.   :8.00   Max.   :472   Max.   :335   Max.   :4.93  
##        wt            qsec            vs              am             gear     
##  Min.   :1.51   Min.   :14.5   Min.   :0.000   Min.   :0.000   Min.   :3.00  
##  1st Qu.:2.58   1st Qu.:16.9   1st Qu.:0.000   1st Qu.:0.000   1st Qu.:3.00  
##  Median :3.33   Median :17.7   Median :0.000   Median :0.000   Median :4.00  
##  Mean   :3.22   Mean   :17.9   Mean   :0.438   Mean   :0.406   Mean   :3.69  
##  3rd Qu.:3.61   3rd Qu.:18.9   3rd Qu.:1.000   3rd Qu.:1.000   3rd Qu.:4.00  
##  Max.   :5.42   Max.   :22.9   Max.   :1.000   Max.   :1.000   Max.   :5.00  
##       carb     
##  Min.   :1.00  
##  1st Qu.:2.00  
##  Median :2.00  
##  Mean   :2.81  
##  3rd Qu.:4.00  
##  Max.   :8.00</code></pre>
<div id="methods-that-benefit-from-scaling" class="section level3">
<h3><span class="header-section-number">11.3.1</span> Methods That Benefit From Scaling</h3>
<p>The following approaches benefit from scaling:</p>
<p>Linear/non-linear regression, logistic regression, KNN, SVM, Neural Networks, clustering algorithms like k-means clustering. Methods that employ PCA and dimensionality reduction should use scaled data.</p>
<p>In R and Python, some of the individual functions might have arguments to activate the scaling as part of the process.</p>
</div>
<div id="methods-that-do-not-require-scaling" class="section level3">
<h3><span class="header-section-number">11.3.2</span> Methods That Do Not Require Scaling</h3>
<p>Methods that don’t require scaling (or whose results don’t rely upon it) include rule-based algorithms such as Decision trees and more generally CART - Random Forests, Gradient Boosted Decision Even if you scale the data the relative relationships will be preserved post scaling so the decision to split a tree won’t be impacted.</p>
</div>
<div id="how-to-scale" class="section level3">
<h3><span class="header-section-number">11.3.3</span> How To Scale</h3>
<p>You could do your own scaling and centering which might be helpful to understand what is going on. First, when we say “scaling” we typically mean “centering” and “scaling”.</p>
<div id="centering" class="section level4">
<h4><span class="header-section-number">11.3.3.1</span> Centering</h4>
<p>Take a vector (or column) of numeric data and find the mean. Then subtract the computed mean value from each element of the vector / column. We will use the <strong>wt</strong> column from mtcars as an example.</p>
<div class="sourceCode" id="cb514"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb514-1" data-line-number="1">(centered &lt;-<span class="st"> </span>mtcars<span class="op">$</span>wt <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(mtcars<span class="op">$</span>wt))</a></code></pre></div>
<pre><code>##  [1] -0.59725 -0.34225 -0.89725 -0.00225  0.22275  0.24275  0.35275 -0.02725
##  [9] -0.06725  0.22275  0.22275  0.85275  0.51275  0.56275  2.03275  2.20675
## [17]  2.12775 -1.01725 -1.60225 -1.38225 -0.75225  0.30275  0.21775  0.62275
## [25]  0.62775 -1.28225 -1.07725 -1.70425 -0.04725 -0.44725  0.35275 -0.43725</code></pre>
<div class="sourceCode" id="cb516"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb516-1" data-line-number="1"><span class="co">#center &lt;- apply(mtcars,2,function(x) (x - mean(x)))</span></a></code></pre></div>
</div>
<div id="scaling-1" class="section level4">
<h4><span class="header-section-number">11.3.3.2</span> Scaling</h4>
<p>This step involves taking the standard deviation of the vector / column. Then divide each value in the vector / column by this computed standard deviation. We’ll process the <strong>centered</strong> data from the previous computation.</p>
<div class="sourceCode" id="cb517"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb517-1" data-line-number="1">(scaled &lt;-<span class="st"> </span>centered<span class="op">/</span><span class="kw">sd</span>(centered))</a></code></pre></div>
<pre><code>##  [1] -0.6104 -0.3498 -0.9170 -0.0023  0.2277  0.2481  0.3605 -0.0278 -0.0687
## [10]  0.2277  0.2277  0.8715  0.5240  0.5751  2.0775  2.2553  2.1746 -1.0396
## [19] -1.6375 -1.4127 -0.7688  0.3094  0.2225  0.6365  0.6416 -1.3105 -1.1010
## [28] -1.7418 -0.0483 -0.4571  0.3605 -0.4469</code></pre>
</div>
<div id="scaling-a-data-frame" class="section level4">
<h4><span class="header-section-number">11.3.3.3</span> Scaling a Data frame</h4>
<p>We could continue to do this by hand</p>
<div class="sourceCode" id="cb519"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb519-1" data-line-number="1">centered &lt;-<span class="st"> </span><span class="kw">apply</span>(mtcars,<span class="dv">2</span>,<span class="cf">function</span>(x) (x <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(x)))</a>
<a class="sourceLine" id="cb519-2" data-line-number="2">scaled &lt;-<span class="st"> </span><span class="kw">apply</span>(centered,<span class="dv">2</span>,<span class="cf">function</span>(x) x<span class="op">/</span><span class="kw">sd</span>(x))</a></code></pre></div>
<p>However, there is a function in R called <strong>scale</strong> which will do this for us. It has the added benefit of providing some attributes in the output that we could later use to <strong>de-scale</strong> the scaled data. This is useful if we build a model with scaled data because the predictions will be in terms of the scaled data which might not make sense to a third party. So you would then need to scale the predictions back into the units of the original data.</p>
<p>Here is how the scale function works:</p>
<div class="sourceCode" id="cb520"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb520-1" data-line-number="1">(smtcars &lt;-<span class="st"> </span><span class="kw">scale</span>(mtcars))</a></code></pre></div>
<pre><code>##                         mpg    cyl    disp      hp    drat      wt    qsec     vs
## Mazda RX4            0.1509 -0.105 -0.5706 -0.5351  0.5675 -0.6104 -0.7772 -0.868
## Mazda RX4 Wag        0.1509 -0.105 -0.5706 -0.5351  0.5675 -0.3498 -0.4638 -0.868
## Datsun 710           0.4495 -1.225 -0.9902 -0.7830  0.4740 -0.9170  0.4260  1.116
## Hornet 4 Drive       0.2173 -0.105  0.2201 -0.5351 -0.9661 -0.0023  0.8905  1.116
## Hornet Sportabout   -0.2307  1.015  1.0431  0.4129 -0.8352  0.2277 -0.4638 -0.868
## Valiant             -0.3303 -0.105 -0.0462 -0.6080 -1.5646  0.2481  1.3270  1.116
## Duster 360          -0.9608  1.015  1.0431  1.4339 -0.7230  0.3605 -1.1241 -0.868
## Merc 240D            0.7150 -1.225 -0.6779 -1.2352  0.1748 -0.0278  1.2039  1.116
## Merc 230             0.4495 -1.225 -0.7255 -0.7539  0.6049 -0.0687  2.8268  1.116
## Merc 280            -0.1478 -0.105 -0.5093 -0.3455  0.6049  0.2277  0.2525  1.116
## Merc 280C           -0.3801 -0.105 -0.5093 -0.3455  0.6049  0.2277  0.5883  1.116
## Merc 450SE          -0.6124  1.015  0.3637  0.4859 -0.9848  0.8715 -0.2511 -0.868
## Merc 450SL          -0.4630  1.015  0.3637  0.4859 -0.9848  0.5240 -0.1392 -0.868
## Merc 450SLC         -0.8115  1.015  0.3637  0.4859 -0.9848  0.5751  0.0846 -0.868
## Cadillac Fleetwood  -1.6079  1.015  1.9468  0.8505 -1.2467  2.0775  0.0734 -0.868
## Lincoln Continental -1.6079  1.015  1.8499  0.9963 -1.1157  2.2553 -0.0161 -0.868
## Chrysler Imperial   -0.8944  1.015  1.6886  1.2151 -0.6856  2.1746 -0.2399 -0.868
## Fiat 128             2.0424 -1.225 -1.2266 -1.1768  0.9042 -1.0396  0.9073  1.116
## Honda Civic          1.7105 -1.225 -1.2508 -1.3810  2.4939 -1.6375  0.3756  1.116
## Toyota Corolla       2.2913 -1.225 -1.2879 -1.1914  1.1660 -1.4127  1.1479  1.116
## Toyota Corona        0.2338 -1.225 -0.8926 -0.7247  0.1935 -0.7688  1.2095  1.116
## Dodge Challenger    -0.7617  1.015  0.7042  0.0483 -1.5646  0.3094 -0.5477 -0.868
## AMC Javelin         -0.8115  1.015  0.5912  0.0483 -0.8352  0.2225 -0.3071 -0.868
## Camaro Z28          -1.1267  1.015  0.9624  1.4339  0.2496  0.6365 -1.3648 -0.868
## Pontiac Firebird    -0.1478  1.015  1.3658  0.4129 -0.9661  0.6416 -0.4470 -0.868
## Fiat X1-9            1.1962 -1.225 -1.2242 -1.1768  0.9042 -1.3105  0.5883  1.116
## Porsche 914-2        0.9805 -1.225 -0.8909 -0.8122  1.5588 -1.1010 -0.6429 -0.868
## Lotus Europa         1.7105 -1.225 -1.0943 -0.4913  0.3244 -1.7418 -0.5309  1.116
## Ford Pantera L      -0.7119  1.015  0.9705  1.7110  1.1660 -0.0483 -1.8740 -0.868
## Ferrari Dino        -0.0648 -0.105 -0.6916  0.4129  0.0438 -0.4571 -1.3144 -0.868
## Maserati Bora       -0.8446  1.015  0.5670  2.7466 -0.1058  0.3605 -1.8180 -0.868
## Volvo 142E           0.2173 -1.225 -0.8853 -0.5497  0.9603 -0.4469  0.4204  1.116
##                         am   gear   carb
## Mazda RX4            1.190  0.424  0.735
## Mazda RX4 Wag        1.190  0.424  0.735
## Datsun 710           1.190  0.424 -1.122
## Hornet 4 Drive      -0.814 -0.932 -1.122
## Hornet Sportabout   -0.814 -0.932 -0.503
## Valiant             -0.814 -0.932 -1.122
## Duster 360          -0.814 -0.932  0.735
## Merc 240D           -0.814  0.424 -0.503
## Merc 230            -0.814  0.424 -0.503
## Merc 280            -0.814  0.424  0.735
## Merc 280C           -0.814  0.424  0.735
## Merc 450SE          -0.814 -0.932  0.116
## Merc 450SL          -0.814 -0.932  0.116
## Merc 450SLC         -0.814 -0.932  0.116
## Cadillac Fleetwood  -0.814 -0.932  0.735
## Lincoln Continental -0.814 -0.932  0.735
## Chrysler Imperial   -0.814 -0.932  0.735
## Fiat 128             1.190  0.424 -1.122
## Honda Civic          1.190  0.424 -0.503
## Toyota Corolla       1.190  0.424 -1.122
## Toyota Corona       -0.814 -0.932 -1.122
## Dodge Challenger    -0.814 -0.932 -0.503
## AMC Javelin         -0.814 -0.932 -0.503
## Camaro Z28          -0.814 -0.932  0.735
## Pontiac Firebird    -0.814 -0.932 -0.503
## Fiat X1-9            1.190  0.424 -1.122
## Porsche 914-2        1.190  1.779 -0.503
## Lotus Europa         1.190  1.779 -0.503
## Ford Pantera L       1.190  1.779  0.735
## Ferrari Dino         1.190  1.779  1.973
## Maserati Bora        1.190  1.779  3.212
## Volvo 142E           1.190  0.424 -0.503
## attr(,&quot;scaled:center&quot;)
##     mpg     cyl    disp      hp    drat      wt    qsec      vs      am    gear 
##  20.091   6.188 230.722 146.688   3.597   3.217  17.849   0.438   0.406   3.688 
##    carb 
##   2.812 
## attr(,&quot;scaled:scale&quot;)
##     mpg     cyl    disp      hp    drat      wt    qsec      vs      am    gear 
##   6.027   1.786 123.939  68.563   0.535   0.978   1.787   0.504   0.499   0.738 
##    carb 
##   1.615</code></pre>
<p>The last rows make reference to <strong>attributes</strong> which can be considered as “meta information”. The presence of this information does not prevent you from using the scaled data for other operations. But if you needed to de-scaled the data you would need the standard deviation for each column and the mean of each column to reverse the centering and scaling process. That info is stashed in the attributes:</p>
<div class="sourceCode" id="cb522"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb522-1" data-line-number="1"><span class="kw">attr</span>(smtcars,<span class="st">&quot;scaled:scale&quot;</span>)</a></code></pre></div>
<pre><code>##     mpg     cyl    disp      hp    drat      wt    qsec      vs      am    gear 
##   6.027   1.786 123.939  68.563   0.535   0.978   1.787   0.504   0.499   0.738 
##    carb 
##   1.615</code></pre>
<div class="sourceCode" id="cb524"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb524-1" data-line-number="1"><span class="kw">attr</span>(smtcars,<span class="st">&quot;scaled:center&quot;</span>)</a></code></pre></div>
<pre><code>##     mpg     cyl    disp      hp    drat      wt    qsec      vs      am    gear 
##  20.091   6.188 230.722 146.688   3.597   3.217  17.849   0.438   0.406   3.688 
##    carb 
##   2.812</code></pre>
<p>If we wanted to de-scaled the data frame that we just scaled we could something like this:</p>
<div class="sourceCode" id="cb526"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb526-1" data-line-number="1">unscaledmt &lt;-<span class="st"> </span><span class="kw">sweep</span>(smtcars,<span class="dv">2</span>,</a>
<a class="sourceLine" id="cb526-2" data-line-number="2">                    <span class="kw">attr</span>(smtcars,<span class="st">&quot;scaled:scale&quot;</span>),<span class="st">&quot;*&quot;</span>)</a>
<a class="sourceLine" id="cb526-3" data-line-number="3"></a>
<a class="sourceLine" id="cb526-4" data-line-number="4">uncentermt &lt;-<span class="st"> </span><span class="kw">sweep</span>(unscaledmt,<span class="dv">2</span>,</a>
<a class="sourceLine" id="cb526-5" data-line-number="5">                    <span class="kw">attr</span>(smtcars,<span class="st">&quot;scaled:center&quot;</span>),<span class="st">&quot;+&quot;</span>)</a>
<a class="sourceLine" id="cb526-6" data-line-number="6"></a>
<a class="sourceLine" id="cb526-7" data-line-number="7"><span class="co"># Compare them</span></a>
<a class="sourceLine" id="cb526-8" data-line-number="8"></a>
<a class="sourceLine" id="cb526-9" data-line-number="9">uncentermt[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,]</a></code></pre></div>
<pre><code>##                mpg cyl disp  hp drat   wt qsec vs am gear carb
## Mazda RX4     21.0   6  160 110 3.90 2.62 16.5  0  1    4    4
## Mazda RX4 Wag 21.0   6  160 110 3.90 2.88 17.0  0  1    4    4
## Datsun 710    22.8   4  108  93 3.85 2.32 18.6  1  1    4    1</code></pre>
<div class="sourceCode" id="cb528"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb528-1" data-line-number="1">mtcars[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,]</a></code></pre></div>
<pre><code>##                mpg cyl disp  hp drat   wt qsec vs am gear carb
## Mazda RX4     21.0   6  160 110 3.90 2.62 16.5  0  1    4    4
## Mazda RX4 Wag 21.0   6  160 110 3.90 2.88 17.0  0  1    4    4
## Datsun 710    22.8   4  108  93 3.85 2.32 18.6  1  1    4    1</code></pre>
<p>Ugh. What a pain ! But, if we wanted to use the scaled data to build a model, here is what we would do:</p>
<div class="sourceCode" id="cb530"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb530-1" data-line-number="1">smtcars &lt;-<span class="st"> </span><span class="kw">scale</span>(mtcars)</a>
<a class="sourceLine" id="cb530-2" data-line-number="2">mtcars_center_scaled &lt;-<span class="st"> </span><span class="kw">data.frame</span>(smtcars)</a>
<a class="sourceLine" id="cb530-3" data-line-number="3">myLm &lt;-<span class="st"> </span><span class="kw">lm</span>(mpg<span class="op">~</span>.,</a>
<a class="sourceLine" id="cb530-4" data-line-number="4">           <span class="dt">data =</span> mtcars_center_scaled)</a>
<a class="sourceLine" id="cb530-5" data-line-number="5"></a>
<a class="sourceLine" id="cb530-6" data-line-number="6"><span class="co"># Do some predicting. </span></a>
<a class="sourceLine" id="cb530-7" data-line-number="7">preds &lt;-<span class="st"> </span><span class="kw">predict</span>(myLm,mtcars_center_scaled)</a>
<a class="sourceLine" id="cb530-8" data-line-number="8"></a>
<a class="sourceLine" id="cb530-9" data-line-number="9"><span class="co"># The results are scaled. How to get them back to unscaled</span></a>
<a class="sourceLine" id="cb530-10" data-line-number="10">preds[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</a></code></pre></div>
<pre><code>##         Mazda RX4     Mazda RX4 Wag        Datsun 710    Hornet 4 Drive 
##             0.416             0.335             1.022             0.190 
## Hornet Sportabout 
##            -0.398</code></pre>
<p>So how would we re express this information in terms of the unscaled data ? It’s tedious but doable. We leverage the fact that the scaled version of the data has attributes we can use to convert the predictions back to their unscaled form.</p>
<div class="sourceCode" id="cb532"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb532-1" data-line-number="1">(unscaled_preds &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb532-2" data-line-number="2"><span class="st">   </span>preds <span class="op">*</span><span class="st"> </span><span class="kw">attr</span>(smtcars,<span class="st">&quot;scaled:scale&quot;</span>)[<span class="st">&#39;mpg&#39;</span>] <span class="op">+</span><span class="st"> </span><span class="kw">attr</span>(smtcars,<span class="st">&quot;scaled:center&quot;</span>)[<span class="st">&#39;mpg&#39;</span>])</a></code></pre></div>
<pre><code>##           Mazda RX4       Mazda RX4 Wag          Datsun 710      Hornet 4 Drive 
##                22.6                22.1                26.3                21.2 
##   Hornet Sportabout             Valiant          Duster 360           Merc 240D 
##                17.7                20.4                14.4                22.5 
##            Merc 230            Merc 280           Merc 280C          Merc 450SE 
##                24.4                18.7                19.2                14.2 
##          Merc 450SL         Merc 450SLC  Cadillac Fleetwood Lincoln Continental 
##                15.6                15.7                12.0                10.9 
##   Chrysler Imperial            Fiat 128         Honda Civic      Toyota Corolla 
##                10.5                27.8                29.9                29.5 
##       Toyota Corona    Dodge Challenger         AMC Javelin          Camaro Z28 
##                23.6                16.9                17.7                13.3 
##    Pontiac Firebird           Fiat X1-9       Porsche 914-2        Lotus Europa 
##                16.7                28.3                26.2                27.6 
##      Ford Pantera L        Ferrari Dino       Maserati Bora          Volvo 142E 
##                18.9                19.7                13.9                24.4</code></pre>
<p>Does this match what we would get had we not scaled the data in the first place ?</p>
<div class="sourceCode" id="cb534"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb534-1" data-line-number="1">myLm &lt;-<span class="st"> </span><span class="kw">lm</span>(mpg<span class="op">~</span>.,</a>
<a class="sourceLine" id="cb534-2" data-line-number="2">           <span class="dt">data =</span> mtcars)</a>
<a class="sourceLine" id="cb534-3" data-line-number="3"></a>
<a class="sourceLine" id="cb534-4" data-line-number="4"><span class="co"># Do some predicting. </span></a>
<a class="sourceLine" id="cb534-5" data-line-number="5">(preds &lt;-<span class="st"> </span><span class="kw">predict</span>(myLm,mtcars))</a></code></pre></div>
<pre><code>##           Mazda RX4       Mazda RX4 Wag          Datsun 710      Hornet 4 Drive 
##                22.6                22.1                26.3                21.2 
##   Hornet Sportabout             Valiant          Duster 360           Merc 240D 
##                17.7                20.4                14.4                22.5 
##            Merc 230            Merc 280           Merc 280C          Merc 450SE 
##                24.4                18.7                19.2                14.2 
##          Merc 450SL         Merc 450SLC  Cadillac Fleetwood Lincoln Continental 
##                15.6                15.7                12.0                10.9 
##   Chrysler Imperial            Fiat 128         Honda Civic      Toyota Corolla 
##                10.5                27.8                29.9                29.5 
##       Toyota Corona    Dodge Challenger         AMC Javelin          Camaro Z28 
##                23.6                16.9                17.7                13.3 
##    Pontiac Firebird           Fiat X1-9       Porsche 914-2        Lotus Europa 
##                16.7                28.3                26.2                27.6 
##      Ford Pantera L        Ferrari Dino       Maserati Bora          Volvo 142E 
##                18.9                19.7                13.9                24.4</code></pre>
<div class="sourceCode" id="cb536"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb536-1" data-line-number="1"><span class="kw">all.equal</span>(preds,unscaled_preds)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<div id="caret-and-preprocess" class="section level4">
<h4><span class="header-section-number">11.3.3.4</span> caret and preprocess</h4>
<p>But the <strong>caret</strong> package will help you do this using the <strong>preProcess</strong> function. Here we can actually request that the data is “centered” and “scaled” as part of the model assembly process. We could do this before the call to the <strong>Train</strong> function but then we would also have to convert the training and test data ourselves. In the following situation, the data will be centered and scaled though the returned RMSE will be in terms of the unscaled data.</p>
<div class="sourceCode" id="cb538"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb538-1" data-line-number="1">training_idx &lt;-<span class="st"> </span><span class="kw">createDataPartition</span>(mtcars<span class="op">$</span>mpg, </a>
<a class="sourceLine" id="cb538-2" data-line-number="2">                                    <span class="dt">p =</span>.<span class="dv">80</span>, <span class="dt">list=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb538-3" data-line-number="3">training &lt;-<span class="st"> </span>mtcars[training_idx,]</a>
<a class="sourceLine" id="cb538-4" data-line-number="4">test &lt;-<span class="st"> </span>mtcars[<span class="op">-</span>training_idx,]</a>
<a class="sourceLine" id="cb538-5" data-line-number="5"></a>
<a class="sourceLine" id="cb538-6" data-line-number="6">myLm &lt;-<span class="st">  </span><span class="kw">train</span>(mpg <span class="op">~</span><span class="st"> </span>.,</a>
<a class="sourceLine" id="cb538-7" data-line-number="7">               <span class="dt">data =</span> training,</a>
<a class="sourceLine" id="cb538-8" data-line-number="8">               <span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>,</a>
<a class="sourceLine" id="cb538-9" data-line-number="9">               <span class="dt">preProcess =</span> <span class="kw">c</span>(<span class="st">&quot;center&quot;</span>,<span class="st">&quot;scale&quot;</span>)</a>
<a class="sourceLine" id="cb538-10" data-line-number="10">          )</a></code></pre></div>
<pre><code>## Warning in predict.lm(modelFit, newdata): prediction from a rank-deficient fit may
## be misleading</code></pre>
<p>To verify that the data is being centered and scaled within the call the <strong>train</strong> function, checkout the <strong>myLm</strong> object:</p>
<div class="sourceCode" id="cb540"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb540-1" data-line-number="1"><span class="co"># This </span></a>
<a class="sourceLine" id="cb540-2" data-line-number="2">myLm<span class="op">$</span>finalModel<span class="op">$</span>model[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,]</a></code></pre></div>
<pre><code>##                   .outcome    cyl   disp     hp   drat      wt   qsec     vs
## Mazda.RX4             21.0 -0.117 -0.564 -0.550  0.581 -0.6002 -0.756 -0.914
## Datsun.710            22.8 -1.208 -0.983 -0.792  0.485 -0.9198  0.414  1.055
## Hornet.4.Drive        21.4 -0.117  0.226 -0.550 -1.002  0.0338  0.865  1.055
## Hornet.Sportabout     18.7  0.974  1.049  0.378 -0.867  0.2735 -0.452 -0.914
## Duster.360            14.3  0.974  1.049  1.377 -0.751  0.4120 -1.094 -0.914
##                      am   gear   carb
## Mazda.RX4          1.22  0.445  0.711
## Datsun.710         1.22  0.445 -1.099
## Hornet.4.Drive    -0.79 -0.939 -1.099
## Hornet.Sportabout -0.79 -0.939 -0.496
## Duster.360        -0.79 -0.939  0.711</code></pre>
<div class="sourceCode" id="cb542"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb542-1" data-line-number="1"><span class="co"># matches this</span></a>
<a class="sourceLine" id="cb542-2" data-line-number="2"><span class="kw">scale</span>(training)[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,]</a></code></pre></div>
<pre><code>##                      mpg    cyl   disp     hp   drat      wt   qsec     vs    am
## Mazda RX4          0.142 -0.117 -0.564 -0.550  0.581 -0.6002 -0.756 -0.914  1.22
## Datsun 710         0.430 -1.208 -0.983 -0.792  0.485 -0.9198  0.414  1.055  1.22
## Hornet 4 Drive     0.206 -0.117  0.226 -0.550 -1.002  0.0338  0.865  1.055 -0.79
## Hornet Sportabout -0.225  0.974  1.049  0.378 -0.867  0.2735 -0.452 -0.914 -0.79
## Duster 360        -0.929  0.974  1.049  1.377 -0.751  0.4120 -1.094 -0.914 -0.79
##                     gear   carb
## Mazda RX4          0.445  0.711
## Datsun 710         0.445 -1.099
## Hornet 4 Drive    -0.939 -1.099
## Hornet Sportabout -0.939 -0.496
## Duster 360        -0.939  0.711</code></pre>
<p>This is convenient because if we now wish to use the <strong>predict</strong> function, it will scale the <strong>test</strong> data that we provide for use with the <strong>predict</strong> function. What we get back will be in terms of the uncenter and unscaled predicted variable (mpg). We do not have to suffer through the conversion reverse scaling process ourselves.</p>
<div class="sourceCode" id="cb544"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb544-1" data-line-number="1">(preds &lt;-<span class="st"> </span><span class="kw">predict</span>(myLm,test))</a></code></pre></div>
<pre><code>##     Mazda RX4 Wag           Valiant Chrysler Imperial     Porsche 914-2 
##              22.1              21.7               8.5              24.2</code></pre>
</div>
</div>
<div id="order-of-processing" class="section level3">
<h3><span class="header-section-number">11.3.4</span> Order of Processing</h3>
<p>Note that the order of processing is important. You should center and then scale. Underneath the hood, the centering operation finds the mean of a feature (column) and then subtracts it from each value therein. So the following are equivalent:</p>
<div class="sourceCode" id="cb546"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb546-1" data-line-number="1">(mt_center &lt;-<span class="st"> </span>mtcars<span class="op">$</span>wt <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(mtcars<span class="op">$</span>wt))</a></code></pre></div>
<pre><code>##  [1] -0.59725 -0.34225 -0.89725 -0.00225  0.22275  0.24275  0.35275 -0.02725
##  [9] -0.06725  0.22275  0.22275  0.85275  0.51275  0.56275  2.03275  2.20675
## [17]  2.12775 -1.01725 -1.60225 -1.38225 -0.75225  0.30275  0.21775  0.62275
## [25]  0.62775 -1.28225 -1.07725 -1.70425 -0.04725 -0.44725  0.35275 -0.43725</code></pre>
<div class="sourceCode" id="cb548"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb548-1" data-line-number="1"><span class="co">#</span></a>
<a class="sourceLine" id="cb548-2" data-line-number="2"></a>
<a class="sourceLine" id="cb548-3" data-line-number="3"><span class="kw">as.vector</span>(<span class="kw">scale</span>(mtcars<span class="op">$</span>wt,<span class="dt">center=</span>T,<span class="dt">scale=</span>F))</a></code></pre></div>
<pre><code>##  [1] -0.59725 -0.34225 -0.89725 -0.00225  0.22275  0.24275  0.35275 -0.02725
##  [9] -0.06725  0.22275  0.22275  0.85275  0.51275  0.56275  2.03275  2.20675
## [17]  2.12775 -1.01725 -1.60225 -1.38225 -0.75225  0.30275  0.21775  0.62275
## [25]  0.62775 -1.28225 -1.07725 -1.70425 -0.04725 -0.44725  0.35275 -0.43725</code></pre>
<p>After centering, the scaling is done by dividing the (centered) columns of the data frame by their respective standard deviations. In terms of dealing with missing data and scaling, one should first do imputation followed by centering and scaling. In a call to the <strong>train</strong> function, this would look like the following. We’ll use our version of mtcars that has missing data.</p>
<div class="sourceCode" id="cb550"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb550-1" data-line-number="1">url &lt;-<span class="st"> &quot;https://raw.githubusercontent.com/steviep42/utilities/master/data/mtcars_na.csv&quot;</span></a>
<a class="sourceLine" id="cb550-2" data-line-number="2"></a>
<a class="sourceLine" id="cb550-3" data-line-number="3">mtcars_na &lt;-<span class="st"> </span><span class="kw">read.csv</span>(url,<span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<div class="sourceCode" id="cb551"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb551-1" data-line-number="1">training_idx &lt;-<span class="st"> </span><span class="kw">createDataPartition</span>(mtcars_na<span class="op">$</span>mpg, <span class="dt">p =</span>.<span class="dv">80</span>, <span class="dt">list=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb551-2" data-line-number="2">training &lt;-<span class="st"> </span>mtcars_na[training_idx,]</a>
<a class="sourceLine" id="cb551-3" data-line-number="3">test &lt;-<span class="st"> </span>mtcars_na[<span class="op">-</span>training_idx,]</a>
<a class="sourceLine" id="cb551-4" data-line-number="4"></a>
<a class="sourceLine" id="cb551-5" data-line-number="5">X &lt;-<span class="st"> </span>training[,<span class="op">-</span><span class="dv">1</span>]</a>
<a class="sourceLine" id="cb551-6" data-line-number="6">Y &lt;-<span class="st"> </span>training<span class="op">$</span>mpg </a>
<a class="sourceLine" id="cb551-7" data-line-number="7"></a>
<a class="sourceLine" id="cb551-8" data-line-number="8">myLm &lt;-<span class="st">  </span><span class="kw">train</span>(X, Y,</a>
<a class="sourceLine" id="cb551-9" data-line-number="9">                <span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>,</a>
<a class="sourceLine" id="cb551-10" data-line-number="10">                <span class="dt">preProcess =</span> <span class="kw">c</span>(<span class="st">&quot;knnImpute&quot;</span>,<span class="st">&quot;center&quot;</span>,<span class="st">&quot;scale&quot;</span>)</a>
<a class="sourceLine" id="cb551-11" data-line-number="11">          )</a></code></pre></div>
<pre><code>## Warning in predict.lm(modelFit, newdata): prediction from a rank-deficient fit may
## be misleading

## Warning in predict.lm(modelFit, newdata): prediction from a rank-deficient fit may
## be misleading</code></pre>
</div>
</div>
<div id="low-variance-variables" class="section level2">
<h2><span class="header-section-number">11.4</span> Low Variance Variables</h2>
<p>Some variables exhibit low variance and might be nearly constant. Such variables can be detected by using some basic functions in R before you begin to build a model. As an example, we’ll use the mtcars data frame and introduce a low variance variable - actually, we’ll make it a constant.</p>
<div class="sourceCode" id="cb553"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb553-1" data-line-number="1"><span class="kw">data</span>(mtcars)</a>
<a class="sourceLine" id="cb553-2" data-line-number="2"><span class="kw">set.seed</span>(<span class="dv">123</span>)</a>
<a class="sourceLine" id="cb553-3" data-line-number="3"></a>
<a class="sourceLine" id="cb553-4" data-line-number="4">mtcars_nzv &lt;-<span class="st"> </span>mtcars</a>
<a class="sourceLine" id="cb553-5" data-line-number="5"></a>
<a class="sourceLine" id="cb553-6" data-line-number="6"><span class="co"># Make drat low variance</span></a>
<a class="sourceLine" id="cb553-7" data-line-number="7">mtcars_nzv<span class="op">$</span>drat &lt;-<span class="st"> </span><span class="fl">3.0</span></a>
<a class="sourceLine" id="cb553-8" data-line-number="8"></a>
<a class="sourceLine" id="cb553-9" data-line-number="9"><span class="co"># Pretty low isn&#39;t it ?</span></a>
<a class="sourceLine" id="cb553-10" data-line-number="10"><span class="kw">var</span>(mtcars_nzv<span class="op">$</span>drat)</a></code></pre></div>
<pre><code>## [1] 0</code></pre>
<p>What if we use this variable when making a model. We’ll get a lot of problems. While this is a contrived example, it is possible to get this situation when using cross fold validation where the data is segmented into smaller subsets where a variable can be zero variance.</p>
<div class="sourceCode" id="cb555"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb555-1" data-line-number="1">x &lt;-<span class="st"> </span>mtcars_nzv[,<span class="op">-</span><span class="dv">1</span>]</a>
<a class="sourceLine" id="cb555-2" data-line-number="2">y &lt;-<span class="st"> </span>mtcars_nzv[,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb555-3" data-line-number="3"></a>
<a class="sourceLine" id="cb555-4" data-line-number="4">lowVarLm &lt;-<span class="st"> </span><span class="kw">train</span>(</a>
<a class="sourceLine" id="cb555-5" data-line-number="5">  x,y,</a>
<a class="sourceLine" id="cb555-6" data-line-number="6">  <span class="dt">method=</span><span class="st">&quot;lm&quot;</span>,</a>
<a class="sourceLine" id="cb555-7" data-line-number="7">  <span class="dt">preProcess=</span><span class="kw">c</span>(<span class="st">&quot;center&quot;</span>,<span class="st">&quot;scale&quot;</span>))</a></code></pre></div>
<p>The <strong>caret</strong> package has an option to the <strong>preProcess</strong> argument that allows us to remove such variables so it won’t impact the resulting model. Notice that we remove the near zero variance variables before we center which happens before scaling. This is the recommended order.</p>
<div class="sourceCode" id="cb556"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb556-1" data-line-number="1">x &lt;-<span class="st"> </span>mtcars_nzv[,<span class="op">-</span><span class="dv">1</span>]</a>
<a class="sourceLine" id="cb556-2" data-line-number="2">y &lt;-<span class="st"> </span>mtcars_nzv[,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb556-3" data-line-number="3"></a>
<a class="sourceLine" id="cb556-4" data-line-number="4">lowVarLm &lt;-<span class="st"> </span><span class="kw">train</span>(</a>
<a class="sourceLine" id="cb556-5" data-line-number="5">  x,y,</a>
<a class="sourceLine" id="cb556-6" data-line-number="6">  <span class="dt">method=</span><span class="st">&quot;lm&quot;</span>,</a>
<a class="sourceLine" id="cb556-7" data-line-number="7">  <span class="dt">preProcess=</span><span class="kw">c</span>(<span class="st">&quot;nzv&quot;</span>,<span class="st">&quot;center&quot;</span>,<span class="st">&quot;scale&quot;</span>))</a></code></pre></div>
<p>The above now works. There is a subtle consideration at work here. We could pre process the data with <strong>nzv</strong> or <strong>zv</strong> where the former removes “near” zero variance features and the latter removes constant-valued features. With near zero variance features there is a way to specify tolerance for deciding whether a feature has near zero variance.</p>
<p>Think of <strong>nzv</strong> as being slightly more permissive and flexible whereas <strong>zv</strong> eliminates zero variance variables. Sometimes you might want to keep near zero variance features around simply because there could be some interesting information therein.</p>
<p>In general we could remove the constant or near zero variance features <strong>before</strong> passing the data to the <strong>train</strong> function. Caret has a standalone function called <strong>nearZeroVariance</strong> to do this. We’ll it doesn’t actually remove the feature but it will tell us which column(s) exhibit very low variance or have a constant value. In this case it is column number 5 which corresponds to <strong>drat</strong>. We already knew that.</p>
<div class="sourceCode" id="cb557"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb557-1" data-line-number="1"><span class="kw">nearZeroVar</span>(mtcars_nzv)</a></code></pre></div>
<pre><code>## [1] 5</code></pre>
<div class="sourceCode" id="cb559"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb559-1" data-line-number="1"><span class="co"># Find the nzv columns</span></a>
<a class="sourceLine" id="cb559-2" data-line-number="2"></a>
<a class="sourceLine" id="cb559-3" data-line-number="3">mtcars_nzv[<span class="kw">nearZeroVar</span>(mtcars_nzv)]</a></code></pre></div>
<pre><code>##                     drat
## Mazda RX4              3
## Mazda RX4 Wag          3
## Datsun 710             3
## Hornet 4 Drive         3
## Hornet Sportabout      3
## Valiant                3
## Duster 360             3
## Merc 240D              3
## Merc 230               3
## Merc 280               3
## Merc 280C              3
## Merc 450SE             3
## Merc 450SL             3
## Merc 450SLC            3
## Cadillac Fleetwood     3
## Lincoln Continental    3
## Chrysler Imperial      3
## Fiat 128               3
## Honda Civic            3
## Toyota Corolla         3
## Toyota Corona          3
## Dodge Challenger       3
## AMC Javelin            3
## Camaro Z28             3
## Pontiac Firebird       3
## Fiat X1-9              3
## Porsche 914-2          3
## Lotus Europa           3
## Ford Pantera L         3
## Ferrari Dino           3
## Maserati Bora          3
## Volvo 142E             3</code></pre>
<p>There is a data frame in the <strong>caret</strong> package which exhibits this behavior in a more organic fashion - that is the data measurements of a number of features are near zero variance.</p>
<div class="sourceCode" id="cb561"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb561-1" data-line-number="1"><span class="kw">data</span>(BloodBrain)</a>
<a class="sourceLine" id="cb561-2" data-line-number="2"><span class="kw">str</span>(bbbDescr,<span class="dv">0</span>)</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    208 obs. of  134 variables:</code></pre>
<div class="sourceCode" id="cb563"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb563-1" data-line-number="1"><span class="co"># Which columns are suspected of having near zero variance ? </span></a>
<a class="sourceLine" id="cb563-2" data-line-number="2"></a>
<a class="sourceLine" id="cb563-3" data-line-number="3"><span class="kw">nearZeroVar</span>(bbbDescr)</a></code></pre></div>
<pre><code>## [1]  3 16 17 22 25 50 60</code></pre>
<div class="sourceCode" id="cb565"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb565-1" data-line-number="1"><span class="co"># What are their names ?</span></a>
<a class="sourceLine" id="cb565-2" data-line-number="2"><span class="kw">names</span>(bbbDescr[,<span class="kw">nearZeroVar</span>(bbbDescr)])</a></code></pre></div>
<pre><code>## [1] &quot;negative&quot;     &quot;peoe_vsa.2.1&quot; &quot;peoe_vsa.3.1&quot; &quot;a_acid&quot;       &quot;vsa_acid&quot;    
## [6] &quot;frac.anion7.&quot; &quot;alert&quot;</code></pre>
</div>
<div id="pca---principal-components-analysis" class="section level2">
<h2><span class="header-section-number">11.5</span> PCA - Principal Components Analysis</h2>
<p>So one of the problems with data can be what is called multicollinearity where high correlations exist between variables in a data set. Consider the mtcars data frame for example. Let’s assume that we want to predict whether a given car has an automatic transmission (0) or manual (1). We’ll remove other columns from the data frame that represent categorical data so we can focus on the continuous numeric variables.</p>
<div id="identify-the-factors" class="section level3">
<h3><span class="header-section-number">11.5.1</span> Identify The Factors</h3>
<div class="sourceCode" id="cb567"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb567-1" data-line-number="1"><span class="kw">sapply</span>(mtcars,<span class="cf">function</span>(x) <span class="kw">length</span>(<span class="kw">unique</span>(x)))</a></code></pre></div>
<pre><code>##  mpg  cyl disp   hp drat   wt qsec   vs   am gear carb 
##   25    3   27   22   22   29   30    2    2    3    6</code></pre>
<p>Let’s eliminate cyl,vs,gear, and carb. We’ll also remove the rownames since, if we don’t, then they will cause problems when we create the biplot of the principal components.</p>
<div class="sourceCode" id="cb569"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb569-1" data-line-number="1">mtcars_data &lt;-<span class="st"> </span>mtcars[,<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span><span class="op">:</span><span class="dv">7</span>,<span class="dv">9</span>)]</a>
<a class="sourceLine" id="cb569-2" data-line-number="2"><span class="kw">rownames</span>(mtcars_data) &lt;-<span class="st"> </span><span class="ot">NULL</span></a></code></pre></div>
<p>Now, let’s look at the correlation matrix to see if we have highly correlated variables. We do have several correlations that exceed .7 which is sufficiently high to consider that they might cause problems when building models. The caret package has a <strong>findCorrelation</strong> function that can remove predictors that exhibit a correlation above a certain threshold but we’ll see how PCA can help - so we’ll leave them in for now.</p>
</div>
<div id="check-for-high-correlations" class="section level3">
<h3><span class="header-section-number">11.5.2</span> Check For High Correlations</h3>
<div class="sourceCode" id="cb570"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb570-1" data-line-number="1"><span class="co"># Get correlations just for the predictor variables</span></a>
<a class="sourceLine" id="cb570-2" data-line-number="2">DataExplorer<span class="op">::</span><span class="kw">plot_correlation</span>(mtcars_data[,<span class="op">-</span><span class="dv">7</span>])</a></code></pre></div>
<p><img src="biosml_files/figure-html/pcacorr-1.png" width="672" /></p>
<p>This is a graphic equivalent of this command:</p>
<div class="sourceCode" id="cb571"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb571-1" data-line-number="1"><span class="kw">cor</span>(mtcars_data[,<span class="op">-</span><span class="dv">7</span>])</a></code></pre></div>
<pre><code>##         mpg   disp     hp    drat     wt    qsec
## mpg   1.000 -0.848 -0.776  0.6812 -0.868  0.4187
## disp -0.848  1.000  0.791 -0.7102  0.888 -0.4337
## hp   -0.776  0.791  1.000 -0.4488  0.659 -0.7082
## drat  0.681 -0.710 -0.449  1.0000 -0.712  0.0912
## wt   -0.868  0.888  0.659 -0.7124  1.000 -0.1747
## qsec  0.419 -0.434 -0.708  0.0912 -0.175  1.0000</code></pre>
</div>
<div id="so-why-use-pca" class="section level3">
<h3><span class="header-section-number">11.5.3</span> So Why Use PCA ?</h3>
<p>There are several functions for doing Principal Components Analysis on this data. But why are we even thinking about PCA ? Well, it helps us deal with highly correlated data by <strong>reducing</strong> the dimensionality of a data set. In the mtcars data frame we don’t have that many variables / columns but wouldn’t it be nice to transform the data in a way that reduced the number of columns that we had to consider while also dealing with the multicollinearity ?</p>
<p>This is what PCA can do for us. In reality we are using the eigenvectors of the covariance matrix of the original data. We use them to transform the original data into a reduced number of columns to consider. To get the ball rolling, we’ll use the <strong>prcomp</strong> function.</p>
<div class="sourceCode" id="cb573"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb573-1" data-line-number="1">scaled_mtcars_data &lt;-<span class="st"> </span><span class="kw">scale</span>(mtcars_data[,<span class="op">-</span><span class="dv">7</span>])</a>
<a class="sourceLine" id="cb573-2" data-line-number="2">prcs &lt;-<span class="st"> </span><span class="kw">princomp</span>(scaled_mtcars_data)</a>
<a class="sourceLine" id="cb573-3" data-line-number="3">prcs</a></code></pre></div>
<pre><code>## Call:
## princomp(x = scaled_mtcars_data)
## 
## Standard deviations:
## Comp.1 Comp.2 Comp.3 Comp.4 Comp.5 Comp.6 
##  2.014  1.055  0.568  0.387  0.348  0.224 
## 
##  6  variables and  32 observations.</code></pre>
<div class="sourceCode" id="cb575"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb575-1" data-line-number="1"><span class="kw">summary</span>(prcs)</a></code></pre></div>
<pre><code>## Importance of components:
##                        Comp.1 Comp.2 Comp.3 Comp.4 Comp.5  Comp.6
## Standard deviation      2.014  1.055 0.5683 0.3867 0.3477 0.22440
## Proportion of Variance  0.698  0.191 0.0556 0.0257 0.0208 0.00866
## Cumulative Proportion   0.698  0.889 0.9448 0.9705 0.9913 1.00000</code></pre>
</div>
<div id="check-the-biplot" class="section level3">
<h3><span class="header-section-number">11.5.4</span> Check The BiPlot</h3>
<p>What we get from this summary is that PC1 accounts for roughly 70% of the variation in the data set. By the time we get to PC3, about 95% of the variation is accounted. We can also look at something called a biplot that allows us to see what variables in the first two components are influential. This information is also available just by viewing the default return information from the object itself but the biplot makes it easier to see.</p>
<div class="sourceCode" id="cb577"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb577-1" data-line-number="1"><span class="kw">biplot</span>(prcs)</a></code></pre></div>
<p><img src="biosml_files/figure-html/pcabiplot-1.png" width="672" /></p>
<p>Back to the summary information, we cal use something called a <strong>screeplot</strong> which will help us see how many of the components to use. We don’t actually need the plot although it can help. Look at the plot and find the “elbow” which is the point at which the rate of change stabilizes. In the plot below it looks like the elbow is at PC3. In looking at the summary info, if we select three components then we are accounting for about 95% of the variation in the data. IF we selected two components then we would have about 89% of the variation accounted for.</p>
<div class="sourceCode" id="cb578"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb578-1" data-line-number="1"><span class="kw">summary</span>(prcs)</a></code></pre></div>
<pre><code>## Importance of components:
##                        Comp.1 Comp.2 Comp.3 Comp.4 Comp.5  Comp.6
## Standard deviation      2.014  1.055 0.5683 0.3867 0.3477 0.22440
## Proportion of Variance  0.698  0.191 0.0556 0.0257 0.0208 0.00866
## Cumulative Proportion   0.698  0.889 0.9448 0.9705 0.9913 1.00000</code></pre>
</div>
<div id="check-the-screeplot" class="section level3">
<h3><span class="header-section-number">11.5.5</span> Check The ScreePlot</h3>
<div class="sourceCode" id="cb580"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb580-1" data-line-number="1"><span class="kw">screeplot</span>(prcs,<span class="dt">type=</span><span class="st">&quot;line&quot;</span>)</a></code></pre></div>
<p><img src="biosml_files/figure-html/pcascree1-1.png" width="672" /></p>
<p>Let’s pick two components. We’ll multiply our data set (using (matrix multiplication) by the two “loadings” / components that we picked. This will give us our original data in terms of the two principal components.</p>
<div class="sourceCode" id="cb581"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb581-1" data-line-number="1">model2 &lt;-<span class="st"> </span>prcs<span class="op">$</span>loadings[,<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]</a>
<a class="sourceLine" id="cb581-2" data-line-number="2">model2_scores &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(scaled_mtcars_data) <span class="op">%*%</span><span class="st"> </span>model2</a></code></pre></div>
</div>
<div id="use-the-transformed-data" class="section level3">
<h3><span class="header-section-number">11.5.6</span> Use The Transformed Data</h3>
<p>So now we’ll use the Naive Bayes method to do build a model using the transformed data.</p>
<div class="sourceCode" id="cb582"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb582-1" data-line-number="1">mod2 &lt;-<span class="st"> </span>e1071<span class="op">::</span><span class="kw">naiveBayes</span>(model2_scores,<span class="kw">factor</span>(mtcars_data<span class="op">$</span>am))</a>
<a class="sourceLine" id="cb582-2" data-line-number="2">(mod2t &lt;-<span class="st"> </span><span class="kw">table</span>(<span class="kw">predict</span>(mod2,model2_scores),mtcars_data<span class="op">$</span>am))</a></code></pre></div>
<pre><code>##    
##      0  1
##   0 18  0
##   1  1 13</code></pre>
<div class="sourceCode" id="cb584"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb584-1" data-line-number="1"><span class="kw">cat</span>(<span class="st">&quot;Accuracy for PCA mod: &quot;</span>,<span class="kw">sum</span>(<span class="kw">diag</span>(mod2t))<span class="op">/</span><span class="kw">sum</span>(mod2t),<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a></code></pre></div>
<pre><code>## Accuracy for PCA mod:  0.969</code></pre>
<p>Compare this to a model built using the untransformed data:</p>
<div class="sourceCode" id="cb586"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb586-1" data-line-number="1">mod1 &lt;-<span class="st"> </span>e1071<span class="op">::</span><span class="kw">naiveBayes</span>(mtcars_data[<span class="op">-</span><span class="dv">7</span>],<span class="kw">factor</span>(mtcars_data<span class="op">$</span>am))</a>
<a class="sourceLine" id="cb586-2" data-line-number="2">(mod1t &lt;-<span class="st"> </span><span class="kw">table</span>(<span class="kw">predict</span>(mod1,mtcars_data),mtcars_data<span class="op">$</span>am))</a></code></pre></div>
<pre><code>##    
##      0  1
##   0 16  2
##   1  3 11</code></pre>
<div class="sourceCode" id="cb588"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb588-1" data-line-number="1"><span class="kw">cat</span>(<span class="st">&quot;Accuracy for PCA mod: &quot;</span>,<span class="kw">sum</span>(<span class="kw">diag</span>(mod1t))<span class="op">/</span><span class="kw">sum</span>(mod1t),<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a></code></pre></div>
<pre><code>## Accuracy for PCA mod:  0.844</code></pre>
</div>
<div id="pls" class="section level3">
<h3><span class="header-section-number">11.5.7</span> PLS</h3>
<p>Partial Least Squares regression is related to PCA although, in classification problems, the latter ignores the variable being predicted. PLS uses information from the variable to be predicted (the class labels) to help maximize the separation of the two classes. Of course, using pls as a method within caret is easy.</p>
<div class="sourceCode" id="cb590"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb590-1" data-line-number="1">control &lt;-<span class="st"> </span><span class="kw">trainControl</span>(<span class="dt">method=</span><span class="st">&quot;cv&quot;</span>,<span class="dt">number =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb590-2" data-line-number="2"></a>
<a class="sourceLine" id="cb590-3" data-line-number="3"><span class="co">#</span></a>
<a class="sourceLine" id="cb590-4" data-line-number="4">caret_pls &lt;-<span class="st"> </span><span class="kw">train</span>(<span class="kw">factor</span>(am)<span class="op">~</span>.,</a>
<a class="sourceLine" id="cb590-5" data-line-number="5">                  mtcars,</a>
<a class="sourceLine" id="cb590-6" data-line-number="6">                  <span class="dt">method=</span><span class="st">&quot;pls&quot;</span>,</a>
<a class="sourceLine" id="cb590-7" data-line-number="7">                  <span class="dt">preProcess=</span><span class="kw">c</span>(<span class="st">&quot;center&quot;</span>,<span class="st">&quot;scale&quot;</span>),</a>
<a class="sourceLine" id="cb590-8" data-line-number="8">                  <span class="dt">trControl =</span> control)</a></code></pre></div>
<p>We already knew that the mtcars data frame would benefit from PCA. Here we see that PLS uses the first three Principal Components to arrive at an accuracy of 0.97 on the data set.</p>
</div>
<div id="summary-1" class="section level3">
<h3><span class="header-section-number">11.5.8</span> Summary</h3>
<p>So the advantages of PCA should be clear in this case. We have effectively replaced the original data by a smaller data set while also dealing with the correlation issues. We used only two components. Now, a disadvantage here is that the model with the transformed data is in terms of the components which means that the model is less transparent. Perhaps a minor price to pay for better accuracy. In terms of the caret package we can do this using the <strong>preProcess</strong> function:</p>
<div class="sourceCode" id="cb591"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb591-1" data-line-number="1">control &lt;-<span class="st"> </span><span class="kw">trainControl</span>(<span class="dt">method=</span><span class="st">&quot;cv&quot;</span>,<span class="dt">number =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb591-2" data-line-number="2"></a>
<a class="sourceLine" id="cb591-3" data-line-number="3"><span class="co">#</span></a>
<a class="sourceLine" id="cb591-4" data-line-number="4">caret_nb &lt;-<span class="st"> </span><span class="kw">train</span>(<span class="kw">factor</span>(am)<span class="op">~</span>.,</a>
<a class="sourceLine" id="cb591-5" data-line-number="5">                  mtcars_data,</a>
<a class="sourceLine" id="cb591-6" data-line-number="6">                  <span class="dt">method=</span><span class="st">&quot;nb&quot;</span>,</a>
<a class="sourceLine" id="cb591-7" data-line-number="7">                  <span class="dt">preProcess=</span><span class="kw">c</span>(<span class="st">&quot;center&quot;</span>,<span class="st">&quot;scale&quot;</span>,<span class="st">&quot;pca&quot;</span>),</a>
<a class="sourceLine" id="cb591-8" data-line-number="8">                  <span class="dt">trControl =</span> control)</a></code></pre></div>
<div class="sourceCode" id="cb592"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb592-1" data-line-number="1"><span class="kw">table</span>(<span class="dt">predicted=</span><span class="kw">predict</span>(caret_nb,mtcars),mtcars<span class="op">$</span>am)</a></code></pre></div>
<pre><code>##          
## predicted  0  1
##         0 18  0
##         1  1 13</code></pre>
</div>
</div>
<div id="order-of-pre-processing" class="section level2">
<h2><span class="header-section-number">11.6</span> Order of Pre-Processing</h2>
<p>In reality, if we wanted to line up the order in which to pre process data it would read something like the following:</p>
<ul>
<li>Remove Near Zero Variance Features</li>
<li>Do Imputation (knn or median)</li>
<li>Center</li>
<li>Scale</li>
</ul>
<div class="sourceCode" id="cb594"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb594-1" data-line-number="1">lowVarLm &lt;-<span class="st"> </span><span class="kw">train</span>(</a>
<a class="sourceLine" id="cb594-2" data-line-number="2">  mtcars[,<span class="op">-</span><span class="dv">1</span>],mtcars<span class="op">$</span>mpg,</a>
<a class="sourceLine" id="cb594-3" data-line-number="3">  <span class="dt">method=</span><span class="st">&quot;lm&quot;</span>,</a>
<a class="sourceLine" id="cb594-4" data-line-number="4">  <span class="dt">preProcess=</span><span class="kw">c</span>(<span class="st">&quot;nzv&quot;</span>,<span class="st">&quot;medianImpute&quot;</span>,<span class="st">&quot;center&quot;</span>,<span class="st">&quot;scale&quot;</span>))</a></code></pre></div>
</div>
<div id="handling-categories" class="section level2">
<h2><span class="header-section-number">11.7</span> Handling Categories</h2>
<p>If you haven’t already, you should first read the section on “Levels Of Measurement” to reacquaint yourself with the differences between Nominal, Ordinal, Interval, and Ratio data.</p>
<p>In this section we’ll deal with categories and factors which represent categories (e.g. “male”,“female”,“smoker”,“non-smoker”). These variables, while useful, need to be recoded in a way to make them useful for machine learning methods. In terms of categories, we have <strong>nominal</strong> and <strong>ordinal</strong> features with the former being names or labels and the latter being the same except with some notion of order (e.g. “low”,“medium”,“high”).</p>
<div id="examples" class="section level3">
<h3><span class="header-section-number">11.7.1</span> Examples</h3>
<p>In R, you can usually create a factor out of a feature and R will handle it correctly when applying a machine learning method. Under the hood, it turns the factors into <strong>dummy variables</strong>. Notice how the model creates variables of the type <code>cyl6</code> and <code>cyl8</code>. Where is <code>cyl4</code> ? Well, absence of <code>cyl4</code> is simply when <code>cyl6</code> and <code>cyl8</code> do not exist for that record.</p>
<div class="sourceCode" id="cb595"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb595-1" data-line-number="1">mtcars_exampl &lt;-<span class="st"> </span>mtcars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">cyl=</span><span class="kw">factor</span>(cyl))</a>
<a class="sourceLine" id="cb595-2" data-line-number="2"><span class="kw">lm</span>(mpg <span class="op">~</span><span class="st"> </span>.,mtcars_exampl)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = mpg ~ ., data = mtcars_exampl)
## 
## Coefficients:
## (Intercept)         cyl6         cyl8         disp           hp         drat  
##     17.8198      -1.6603       1.6374       0.0139      -0.0461       0.0264  
##          wt         qsec           vs           am         gear         carb  
##     -3.8062       0.6470       1.7474       2.6173       0.7640       0.5094</code></pre>
<p>We could have created the dummy variables ourselves but we didn’t need to do that here. In Python, we generally would. But when we do it’s best to have 1 less category than is encoded by the unique feature values under consideration. If there are n=3 unique values then we would want 2 dummy variables.</p>
<div class="sourceCode" id="cb597"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb597-1" data-line-number="1">mtcars_exampl &lt;-<span class="st"> </span>mtcars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">cyl=</span><span class="kw">factor</span>(cyl))</a>
<a class="sourceLine" id="cb597-2" data-line-number="2">dummy &lt;-<span class="st"> </span><span class="kw">dummyVars</span>(<span class="op">~</span>.,mtcars_exampl)</a>
<a class="sourceLine" id="cb597-3" data-line-number="3"></a>
<a class="sourceLine" id="cb597-4" data-line-number="4">dummied_up_mtcars &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">predict</span>(dummy,<span class="dt">newdata=</span>mtcars_exampl))</a>
<a class="sourceLine" id="cb597-5" data-line-number="5"></a>
<a class="sourceLine" id="cb597-6" data-line-number="6"><span class="kw">head</span>(dummied_up_mtcars)</a></code></pre></div>
<pre><code>##    mpg cyl.4 cyl.6 cyl.8 disp  hp drat   wt qsec vs am gear carb
## 1 21.0     0     1     0  160 110 3.90 2.62 16.5  0  1    4    4
## 2 21.0     0     1     0  160 110 3.90 2.88 17.0  0  1    4    4
## 3 22.8     1     0     0  108  93 3.85 2.32 18.6  1  1    4    1
## 4 21.4     0     1     0  258 110 3.08 3.21 19.4  1  0    3    1
## 5 18.7     0     0     1  360 175 3.15 3.44 17.0  0  0    3    2
## 6 18.1     0     1     0  225 105 2.76 3.46 20.2  1  0    3    1</code></pre>
<p>But here we would want to use the <code>fullrank = TRUE</code> in the call to <strong>dummyVars</strong> to accomplish the n-1 encoding. The reason we would do this is to avoid the collinearity although in this case that isn’t a problem here. We could first check the correlations</p>
<div class="sourceCode" id="cb599"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb599-1" data-line-number="1"><span class="kw">plot_correlation</span>(dummied_up_mtcars[,<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>])</a></code></pre></div>
<p><img src="biosml_files/figure-html/mtcorr-1.png" width="672" /></p>
<div class="sourceCode" id="cb600"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb600-1" data-line-number="1">mtcars_exampl &lt;-<span class="st"> </span>mtcars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">cyl=</span><span class="kw">factor</span>(cyl))</a>
<a class="sourceLine" id="cb600-2" data-line-number="2">dummy &lt;-<span class="st"> </span><span class="kw">dummyVars</span>(<span class="op">~</span>.,mtcars_exampl,<span class="dt">fullRank =</span> T)</a>
<a class="sourceLine" id="cb600-3" data-line-number="3"></a>
<a class="sourceLine" id="cb600-4" data-line-number="4">dummied_up_mtcars &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">predict</span>(dummy,</a>
<a class="sourceLine" id="cb600-5" data-line-number="5">                                        <span class="dt">newdata=</span>mtcars_exampl))</a>
<a class="sourceLine" id="cb600-6" data-line-number="6"></a>
<a class="sourceLine" id="cb600-7" data-line-number="7"><span class="kw">head</span>(dummied_up_mtcars)</a></code></pre></div>
<pre><code>##    mpg cyl.6 cyl.8 disp  hp drat   wt qsec vs am gear carb
## 1 21.0     1     0  160 110 3.90 2.62 16.5  0  1    4    4
## 2 21.0     1     0  160 110 3.90 2.88 17.0  0  1    4    4
## 3 22.8     0     0  108  93 3.85 2.32 18.6  1  1    4    1
## 4 21.4     1     0  258 110 3.08 3.21 19.4  1  0    3    1
## 5 18.7     0     1  360 175 3.15 3.44 17.0  0  0    3    2
## 6 18.1     1     0  225 105 2.76 3.46 20.2  1  0    3    1</code></pre>
<p>But again, R will do this for us just by indicating that it is a factor. But let me show you what will happen in another case with respect to the <strong>am</strong> variable if we do not use the n-1 encoding</p>
<div class="sourceCode" id="cb602"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb602-1" data-line-number="1">mtcars_exampl &lt;-<span class="st"> </span>mtcars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">am=</span><span class="kw">factor</span>(am))</a>
<a class="sourceLine" id="cb602-2" data-line-number="2">dummy &lt;-<span class="st"> </span><span class="kw">dummyVars</span>(<span class="op">~</span>.,mtcars_exampl)</a>
<a class="sourceLine" id="cb602-3" data-line-number="3"></a>
<a class="sourceLine" id="cb602-4" data-line-number="4">dummied_up_mtcars &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">predict</span>(dummy,</a>
<a class="sourceLine" id="cb602-5" data-line-number="5">                                        <span class="dt">newdata=</span>mtcars_exampl))</a>
<a class="sourceLine" id="cb602-6" data-line-number="6"></a>
<a class="sourceLine" id="cb602-7" data-line-number="7"><span class="kw">head</span>(dummied_up_mtcars[,<span class="dv">7</span><span class="op">:</span><span class="dv">11</span>])</a></code></pre></div>
<pre><code>##   qsec vs am.0 am.1 gear
## 1 16.5  0    0    1    4
## 2 17.0  0    0    1    4
## 3 18.6  1    0    1    4
## 4 19.4  1    1    0    3
## 5 17.0  0    1    0    3
## 6 20.2  1    1    0    3</code></pre>
<p>Check the correlations between <code>am.0</code> and <code>am.1</code>. They are perfectly correlated which could cause problems in the modeling methods. We could express <code>am.0</code> as a linear function of <code>am.1</code>. This is why using the n-1 approach helps deal with the collinearity problem.</p>
<div class="sourceCode" id="cb604"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb604-1" data-line-number="1"><span class="kw">plot_correlation</span>(dummied_up_mtcars[,<span class="dv">7</span><span class="op">:</span><span class="dv">11</span>])</a></code></pre></div>
<p><img src="biosml_files/figure-html/unnamed-chunk-101-1.png" width="672" /></p>
</div>
<div id="admissions-data" class="section level3">
<h3><span class="header-section-number">11.7.2</span> Admissions Data</h3>
<p>For example, read in the following data which relates to admissions data for students applying to an academic program. This comes from <a href="https://stats.idre.ucla.edu/r/dae/logit-regression/">UCLA Statisitical Consulting</a> site.</p>
<div class="sourceCode" id="cb605"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb605-1" data-line-number="1">admissions &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;https://stats.idre.ucla.edu/stat/data/binary.csv&quot;</span>)</a>
<a class="sourceLine" id="cb605-2" data-line-number="2"><span class="kw">head</span>(admissions)</a></code></pre></div>
<pre><code>##   admit gre  gpa rank
## 1     0 380 3.61    3
## 2     1 660 3.67    3
## 3     1 800 4.00    1
## 4     1 640 3.19    4
## 5     0 520 2.93    4
## 6     1 760 3.00    2</code></pre>
<div class="sourceCode" id="cb607"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb607-1" data-line-number="1"><span class="kw">str</span>(admissions)</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    400 obs. of  4 variables:
##  $ admit: int  0 1 1 1 0 1 1 0 1 0 ...
##  $ gre  : int  380 660 800 640 520 760 560 400 540 700 ...
##  $ gpa  : num  3.61 3.67 4 3.19 2.93 3 2.98 3.08 3.39 3.92 ...
##  $ rank : int  3 3 1 4 4 2 1 2 3 2 ...</code></pre>
<p>Let’s examine this data by determining the number of unique values assumed by each feature. This helps us understand if a variable is a category / factor variable or a continuous quantity. It appears that <code>admit</code> takes on only two distinct values and rank assumes only four which suggests that both might be more of a category than a quantity upon which we could perform lots of calculations.</p>
<p>As it relates to <code>admit</code>, this is a <code>yes / no</code> assessment and there is no inherent order even though it has been encoded as a 0 or a 1. This might be something that we might predict with a model.</p>
<p>We will treat the variables gre and gpa as continuous. The variable rank takes on the values 1 through 4. Institutions with a rank of 1 have the highest prestige, while those with a rank of 4 have the lowest.</p>
<div class="sourceCode" id="cb609"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb609-1" data-line-number="1">admissions <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise_all</span>(n_distinct)</a></code></pre></div>
<pre><code>##   admit gre gpa rank
## 1     2  26 132    4</code></pre>
<p>You can always use the <strong>summary</strong> function to get a quick overview of the data. Notice here that admit is more of a binary entity although since R thinks it is just a number it will compute the percentiles for it. Same with the rest of the variables. We probably don’t want this but let’s hold off on doing anything about it for now since most newcomers to Data Analysis will make this mistake. Let’s see what happens.</p>
<div class="sourceCode" id="cb611"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb611-1" data-line-number="1"><span class="kw">summary</span>(admissions)</a></code></pre></div>
<pre><code>##      admit            gre           gpa            rank     
##  Min.   :0.000   Min.   :220   Min.   :2.26   Min.   :1.00  
##  1st Qu.:0.000   1st Qu.:520   1st Qu.:3.13   1st Qu.:2.00  
##  Median :0.000   Median :580   Median :3.40   Median :2.00  
##  Mean   :0.318   Mean   :588   Mean   :3.39   Mean   :2.48  
##  3rd Qu.:1.000   3rd Qu.:660   3rd Qu.:3.67   3rd Qu.:3.00  
##  Max.   :1.000   Max.   :800   Max.   :4.00   Max.   :4.00</code></pre>
<p>So with this data, an interesting problem might be to predict whether an applicant is admitted to the program based on the other variables in the data set. We could pick Logistic Regression for this activity.</p>
<div class="sourceCode" id="cb613"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb613-1" data-line-number="1">control &lt;-<span class="st"> </span><span class="kw">trainControl</span>(<span class="dt">method=</span><span class="st">&quot;cv&quot;</span>,<span class="dt">number=</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb613-2" data-line-number="2"></a>
<a class="sourceLine" id="cb613-3" data-line-number="3">try_to_classify_admit &lt;-<span class="st"> </span><span class="kw">train</span>(admit <span class="op">~</span><span class="st"> </span>.,</a>
<a class="sourceLine" id="cb613-4" data-line-number="4">                               <span class="dt">data =</span> admissions,</a>
<a class="sourceLine" id="cb613-5" data-line-number="5">                               <span class="dt">method =</span> <span class="st">&quot;glm&quot;</span>,</a>
<a class="sourceLine" id="cb613-6" data-line-number="6">                               <span class="dt">trControl =</span> control)</a></code></pre></div>
<pre><code>## Warning in train.default(x, y, weights = w, ...): You are trying to do regression
## and your outcome only has two possible values Are you trying to do classification?
## If so, use a 2 level factor as your outcome column.</code></pre>
<p>Why does this bomb out ? Well, the GLM method expects us to be predicting a binary outcome which, to the human eye, the admit variable actually is. However, R doesn’t know this as it currently thinks of the <strong>admit</strong> variable as being simply a number so it thinks we are trying to predict a numeric outcome hence the error. To fix this we need to make admit a <strong>factor</strong> which is a term used in statistics to refer to categories. So let’s see the effect of doing this. While we are at it, let’s also resummarize the data to see if R treats the <strong>admit</strong> variable any differently after the conversion to factor has been made.</p>
<div class="sourceCode" id="cb615"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb615-1" data-line-number="1">admissions_factor_<span class="dv">1</span> &lt;-<span class="st"> </span>admissions <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">admit=</span><span class="kw">factor</span>(admit))</a>
<a class="sourceLine" id="cb615-2" data-line-number="2"><span class="kw">str</span>(admissions_factor_<span class="dv">1</span>)</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    400 obs. of  4 variables:
##  $ admit: Factor w/ 2 levels &quot;0&quot;,&quot;1&quot;: 1 2 2 2 1 2 2 1 2 1 ...
##  $ gre  : int  380 660 800 640 520 760 560 400 540 700 ...
##  $ gpa  : num  3.61 3.67 4 3.19 2.93 3 2.98 3.08 3.39 3.92 ...
##  $ rank : int  3 3 1 4 4 2 1 2 3 2 ...</code></pre>
<div class="sourceCode" id="cb617"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb617-1" data-line-number="1"><span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st"> Now look at the summary&quot;</span>,<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a></code></pre></div>
<pre><code>## 
##  Now look at the summary</code></pre>
<div class="sourceCode" id="cb619"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb619-1" data-line-number="1"><span class="kw">summary</span>(admissions_factor_<span class="dv">1</span><span class="op">$</span>admit)</a></code></pre></div>
<pre><code>##   0   1 
## 273 127</code></pre>
<p>So now R understands that <strong>admit</strong> is a category so it chooses to offer a table / count summary of the data as opposed to the summary statistics it would apply for numeric data. So now let’s try again to build a predictive model for <strong>admit</strong>.</p>
<div class="sourceCode" id="cb621"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb621-1" data-line-number="1">classify_admit_factor_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">train</span>(admit <span class="op">~</span><span class="st"> </span>.,</a>
<a class="sourceLine" id="cb621-2" data-line-number="2">                                 <span class="dt">data =</span> admissions_factor_<span class="dv">1</span>,</a>
<a class="sourceLine" id="cb621-3" data-line-number="3">                                 <span class="dt">method =</span> <span class="st">&quot;glm&quot;</span>,</a>
<a class="sourceLine" id="cb621-4" data-line-number="4">                                 <span class="dt">trControl =</span> control)</a>
<a class="sourceLine" id="cb621-5" data-line-number="5"></a>
<a class="sourceLine" id="cb621-6" data-line-number="6">classify_admit_factor_<span class="dv">1</span><span class="op">$</span>results<span class="op">$</span>Accuracy</a></code></pre></div>
<pre><code>## [1] 0.705</code></pre>
<div class="sourceCode" id="cb623"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb623-1" data-line-number="1">classify_admit_factor_<span class="dv">1</span> <span class="op">%&gt;%</span><span class="st"> </span>summary</a></code></pre></div>
<pre><code>## 
## Call:
## NULL
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -1.580  -0.885  -0.638   1.157   2.173  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -3.44955    1.13285   -3.05   0.0023 ** 
## gre          0.00229    0.00109    2.10   0.0356 *  
## gpa          0.77701    0.32748    2.37   0.0177 *  
## rank        -0.56003    0.12714   -4.40  1.1e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 499.98  on 399  degrees of freedom
## Residual deviance: 459.44  on 396  degrees of freedom
## AIC: 467.4
## 
## Number of Fisher Scoring iterations: 4</code></pre>
</div>
<div id="is-rank-a-category" class="section level3">
<h3><span class="header-section-number">11.7.3</span> Is Rank A Category ?</h3>
<p>Okay that was nice and it appears that all of our predictors are significant with <strong>rank</strong> ,in particular, being so. However, when looking at the <strong>rank</strong> variable it looks like it is an ordinal variable as opposed to an interval variable. It’s interesting since rank is on an interval but is a rank of 0 significant ? This variable could be considered as an interval variable but it’s more likely that it is ordinal in which case we would need to turn it into a factor.</p>
<div class="sourceCode" id="cb625"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb625-1" data-line-number="1">admissions_factor_<span class="dv">2</span> &lt;-<span class="st"> </span>admissions_factor_<span class="dv">1</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">rank=</span><span class="kw">factor</span>(rank))</a>
<a class="sourceLine" id="cb625-2" data-line-number="2"><span class="kw">str</span>(admissions_factor_<span class="dv">2</span>)</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    400 obs. of  4 variables:
##  $ admit: Factor w/ 2 levels &quot;0&quot;,&quot;1&quot;: 1 2 2 2 1 2 2 1 2 1 ...
##  $ gre  : int  380 660 800 640 520 760 560 400 540 700 ...
##  $ gpa  : num  3.61 3.67 4 3.19 2.93 3 2.98 3.08 3.39 3.92 ...
##  $ rank : Factor w/ 4 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;: 3 3 1 4 4 2 1 2 3 2 ...</code></pre>
<div class="sourceCode" id="cb627"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb627-1" data-line-number="1">classify_admit_factor_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">train</span>(admit <span class="op">~</span><span class="st"> </span>.,</a>
<a class="sourceLine" id="cb627-2" data-line-number="2">                            <span class="dt">data =</span> admissions_factor_<span class="dv">2</span>,</a>
<a class="sourceLine" id="cb627-3" data-line-number="3">                            <span class="dt">method =</span> <span class="st">&quot;glm&quot;</span>,</a>
<a class="sourceLine" id="cb627-4" data-line-number="4">                            <span class="dt">trControl =</span> control)</a>
<a class="sourceLine" id="cb627-5" data-line-number="5"></a>
<a class="sourceLine" id="cb627-6" data-line-number="6">classify_admit_factor_<span class="dv">2</span><span class="op">$</span>results<span class="op">$</span>Accuracy</a></code></pre></div>
<pre><code>## [1] 0.69</code></pre>
<div class="sourceCode" id="cb629"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb629-1" data-line-number="1">classify_admit_factor_<span class="dv">2</span> <span class="op">%&gt;%</span><span class="st"> </span>summary</a></code></pre></div>
<pre><code>## 
## Call:
## NULL
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -1.627  -0.866  -0.639   1.149   2.079  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -3.98998    1.13995   -3.50  0.00047 ***
## gre          0.00226    0.00109    2.07  0.03847 *  
## gpa          0.80404    0.33182    2.42  0.01539 *  
## rank2       -0.67544    0.31649   -2.13  0.03283 *  
## rank3       -1.34020    0.34531   -3.88  0.00010 ***
## rank4       -1.55146    0.41783   -3.71  0.00020 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 499.98  on 399  degrees of freedom
## Residual deviance: 458.52  on 394  degrees of freedom
## AIC: 470.5
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>This is interesting in that the Accuracy from this model is less than the previous one although we see that the interpretation of Rank is more nuanced here in that ranks of 3 and 4 appear to be more significant than other rank values. We might take this into consideration when thinking about how to transform the features or modify our prediction formula.</p>
</div>
<div id="relationship-to-one-hot-encoding" class="section level3">
<h3><span class="header-section-number">11.7.4</span> Relationship To One Hot Encoding</h3>
<p>Usually when you indicate to R that a variable is a factor then most procedures and functions will know how to handle that when computing various statistics and building models. Other languages might not do this for you in which case you need to employ an approach called <strong>One Hot Encoding</strong>. We can do this also in R but in many (most) cases it is not necessary as long as you explicitly create factors as indicated above. It might be helpful to first see what a one hot encoded version of the admissions data frame might look:</p>
<div class="sourceCode" id="cb631"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb631-1" data-line-number="1">  gre gpa    rank<span class="fl">.1</span> rank<span class="fl">.2</span> rank<span class="fl">.3</span> rank<span class="fl">.4</span></a>
<a class="sourceLine" id="cb631-2" data-line-number="2"><span class="dv">1</span> <span class="dv">380</span> <span class="fl">3.61</span>      <span class="dv">0</span>      <span class="dv">0</span>      <span class="dv">1</span>      <span class="dv">0</span></a>
<a class="sourceLine" id="cb631-3" data-line-number="3"><span class="dv">2</span> <span class="dv">660</span> <span class="fl">3.67</span>      <span class="dv">0</span>      <span class="dv">0</span>      <span class="dv">1</span>      <span class="dv">0</span></a>
<a class="sourceLine" id="cb631-4" data-line-number="4"><span class="dv">3</span> <span class="dv">800</span> <span class="fl">4.00</span>      <span class="dv">1</span>      <span class="dv">0</span>      <span class="dv">0</span>      <span class="dv">0</span></a>
<a class="sourceLine" id="cb631-5" data-line-number="5"><span class="dv">4</span> <span class="dv">640</span> <span class="fl">3.19</span>      <span class="dv">0</span>      <span class="dv">0</span>      <span class="dv">0</span>      <span class="dv">1</span></a>
<a class="sourceLine" id="cb631-6" data-line-number="6"><span class="dv">5</span> <span class="dv">520</span> <span class="fl">2.93</span>      <span class="dv">0</span>      <span class="dv">0</span>      <span class="dv">0</span>      <span class="dv">1</span></a>
<a class="sourceLine" id="cb631-7" data-line-number="7"><span class="dv">6</span> <span class="dv">760</span> <span class="fl">3.00</span>      <span class="dv">0</span>      <span class="dv">1</span>      <span class="dv">0</span>      <span class="dv">0</span></a></code></pre></div>
<p>There are two things to notice here. The first is that the admit variable isn’t present since that is the value we will be predicting. The second thing to notice is that for each “level” of the rank variable there is a corresponding column. Now, there is the concept of a “rank deficient” fit wherein you will generally want one less variable than the number of categories present to avoid perfect collinearity. In this case the above encoding would look like:</p>
<div class="sourceCode" id="cb632"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb632-1" data-line-number="1">  gre  gpa   rank<span class="fl">.2</span> rank<span class="fl">.3</span> rank<span class="fl">.4</span></a>
<a class="sourceLine" id="cb632-2" data-line-number="2"><span class="dv">1</span> <span class="dv">380</span> <span class="fl">3.61</span>      <span class="dv">0</span>      <span class="dv">1</span>      <span class="dv">0</span></a>
<a class="sourceLine" id="cb632-3" data-line-number="3"><span class="dv">2</span> <span class="dv">660</span> <span class="fl">3.67</span>      <span class="dv">0</span>      <span class="dv">1</span>      <span class="dv">0</span></a>
<a class="sourceLine" id="cb632-4" data-line-number="4"><span class="dv">3</span> <span class="dv">800</span> <span class="fl">4.00</span>      <span class="dv">0</span>      <span class="dv">0</span>      <span class="dv">0</span></a>
<a class="sourceLine" id="cb632-5" data-line-number="5"><span class="dv">4</span> <span class="dv">640</span> <span class="fl">3.19</span>      <span class="dv">0</span>      <span class="dv">0</span>      <span class="dv">1</span></a>
<a class="sourceLine" id="cb632-6" data-line-number="6"><span class="dv">5</span> <span class="dv">520</span> <span class="fl">2.93</span>      <span class="dv">0</span>      <span class="dv">0</span>      <span class="dv">1</span></a>
<a class="sourceLine" id="cb632-7" data-line-number="7"><span class="dv">6</span> <span class="dv">760</span> <span class="fl">3.00</span>      <span class="dv">1</span>      <span class="dv">0</span>      <span class="dv">0</span></a></code></pre></div>
<p>So, in cases where all rank features (2,3 and 4) were 0 would correspond to a rank of 1. In any case, here is how we would handle the situation using the One Hot Encoding approach. First, we’ll read in the data again:</p>
<div class="sourceCode" id="cb633"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb633-1" data-line-number="1">admissions &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;https://stats.idre.ucla.edu/stat/data/binary.csv&quot;</span>)</a>
<a class="sourceLine" id="cb633-2" data-line-number="2"><span class="kw">head</span>(admissions)</a></code></pre></div>
<pre><code>##   admit gre  gpa rank
## 1     0 380 3.61    3
## 2     1 660 3.67    3
## 3     1 800 4.00    1
## 4     1 640 3.19    4
## 5     0 520 2.93    4
## 6     1 760 3.00    2</code></pre>
<div class="sourceCode" id="cb635"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb635-1" data-line-number="1"><span class="kw">str</span>(admissions)</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    400 obs. of  4 variables:
##  $ admit: int  0 1 1 1 0 1 1 0 1 0 ...
##  $ gre  : int  380 660 800 640 520 760 560 400 540 700 ...
##  $ gpa  : num  3.61 3.67 4 3.19 2.93 3 2.98 3.08 3.39 3.92 ...
##  $ rank : int  3 3 1 4 4 2 1 2 3 2 ...</code></pre>
<p>Now since we want to predict admissions and we consider rank as a factor we’ll turn those into factors. As mentioned, this is all that is necessary when using R but let’s pretend that it isn’t.</p>
<div class="sourceCode" id="cb637"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb637-1" data-line-number="1">admissions_factors &lt;-<span class="st"> </span>admissions <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">admit=</span><span class="kw">factor</span>(admit),</a>
<a class="sourceLine" id="cb637-2" data-line-number="2">                                             <span class="dt">rank=</span><span class="kw">factor</span>(rank))</a>
<a class="sourceLine" id="cb637-3" data-line-number="3"><span class="kw">str</span>(admissions_factors)</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    400 obs. of  4 variables:
##  $ admit: Factor w/ 2 levels &quot;0&quot;,&quot;1&quot;: 1 2 2 2 1 2 2 1 2 1 ...
##  $ gre  : int  380 660 800 640 520 760 560 400 540 700 ...
##  $ gpa  : num  3.61 3.67 4 3.19 2.93 3 2.98 3.08 3.39 3.92 ...
##  $ rank : Factor w/ 4 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;: 3 3 1 4 4 2 1 2 3 2 ...</code></pre>
<p>So now we’ll use the <strong>dummyVars</strong> function from caret to make dummy vars out using out admissions data frame. Since we are ultimately wanting to predict the <strong>admit</strong> feature, we’ll tell <strong>dummyVars</strong> that we don’t want that to be split across two columns.</p>
<div class="sourceCode" id="cb639"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb639-1" data-line-number="1">(dummy &lt;-<span class="st"> </span><span class="kw">dummyVars</span>(<span class="st">&quot;admit ~ .&quot;</span>,admissions_factors,<span class="dt">fullRank =</span> <span class="ot">TRUE</span>))</a></code></pre></div>
<pre><code>## Dummy Variable Object
## 
## Formula: admit ~ .
## &lt;environment: 0x7ff65cf04550&gt;
## 4 variables, 2 factors
## Variables and levels will be separated by &#39;.&#39;
## A full rank encoding is used</code></pre>
<div class="sourceCode" id="cb641"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb641-1" data-line-number="1">dummied_up_admissions &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">predict</span>(dummy,<span class="dt">newdata=</span>admissions_factors))</a></code></pre></div>
<pre><code>## Warning in model.frame.default(Terms, newdata, na.action = na.action, xlev =
## object$lvls): variable &#39;admit&#39; is not a factor</code></pre>
<div class="sourceCode" id="cb643"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb643-1" data-line-number="1"><span class="kw">str</span>(dummied_up_admissions)</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    400 obs. of  5 variables:
##  $ gre   : num  380 660 800 640 520 760 560 400 540 700 ...
##  $ gpa   : num  3.61 3.67 4 3.19 2.93 3 2.98 3.08 3.39 3.92 ...
##  $ rank.2: num  0 0 0 0 0 1 0 1 0 1 ...
##  $ rank.3: num  1 1 0 0 0 0 0 0 1 0 ...
##  $ rank.4: num  0 0 0 1 1 0 0 0 0 0 ...</code></pre>
<div class="sourceCode" id="cb645"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb645-1" data-line-number="1"><span class="kw">head</span>(dummied_up_admissions)</a></code></pre></div>
<pre><code>##   gre  gpa rank.2 rank.3 rank.4
## 1 380 3.61      0      1      0
## 2 660 3.67      0      1      0
## 3 800 4.00      0      0      0
## 4 640 3.19      0      0      1
## 5 520 2.93      0      0      1
## 6 760 3.00      1      0      0</code></pre>
<p>So we could now use this data frame in our modeling attempts as before to see if it makes any difference. We’ll also need to use an alternative calling sequence to the <strong>train</strong> function which allows us to specify the predicted column (admit) separately from the features we are using to make that prediction.</p>
<div class="sourceCode" id="cb647"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb647-1" data-line-number="1">classify_admit_onehot &lt;-<span class="st"> </span><span class="kw">train</span>(<span class="dt">x =</span> dummied_up_admissions,</a>
<a class="sourceLine" id="cb647-2" data-line-number="2">                               <span class="dt">y =</span> admissions_factors[,<span class="st">&#39;admit&#39;</span>],</a>
<a class="sourceLine" id="cb647-3" data-line-number="3">                               <span class="dt">method =</span> <span class="st">&quot;glm&quot;</span>,</a>
<a class="sourceLine" id="cb647-4" data-line-number="4">                               <span class="dt">trControl =</span> control)</a>
<a class="sourceLine" id="cb647-5" data-line-number="5"></a>
<a class="sourceLine" id="cb647-6" data-line-number="6">classify_admit_onehot<span class="op">$</span>results<span class="op">$</span>Accuracy</a></code></pre></div>
<pre><code>## [1] 0.702</code></pre>
<div class="sourceCode" id="cb649"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb649-1" data-line-number="1">classify_admit_onehot <span class="op">%&gt;%</span><span class="st"> </span>summary</a></code></pre></div>
<pre><code>## 
## Call:
## NULL
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -1.627  -0.866  -0.639   1.149   2.079  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -3.98998    1.13995   -3.50  0.00047 ***
## gre          0.00226    0.00109    2.07  0.03847 *  
## gpa          0.80404    0.33182    2.42  0.01539 *  
## rank.2      -0.67544    0.31649   -2.13  0.03283 *  
## rank.3      -1.34020    0.34531   -3.88  0.00010 ***
## rank.4      -1.55146    0.41783   -3.71  0.00020 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 499.98  on 399  degrees of freedom
## Residual deviance: 458.52  on 394  degrees of freedom
## AIC: 470.5
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>How does this compare to the model we built earlier where we told R that both admit and rank were factors ? It’s pretty much the same.</p>
<div class="sourceCode" id="cb651"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb651-1" data-line-number="1">classify_admit_factor_<span class="dv">2</span><span class="op">$</span>results<span class="op">$</span>Accuracy</a></code></pre></div>
<pre><code>## [1] 0.69</code></pre>
<div class="sourceCode" id="cb653"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb653-1" data-line-number="1">classify_admit_factor_<span class="dv">2</span> <span class="op">%&gt;%</span><span class="st"> </span>summary</a></code></pre></div>
<pre><code>## 
## Call:
## NULL
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -1.627  -0.866  -0.639   1.149   2.079  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -3.98998    1.13995   -3.50  0.00047 ***
## gre          0.00226    0.00109    2.07  0.03847 *  
## gpa          0.80404    0.33182    2.42  0.01539 *  
## rank2       -0.67544    0.31649   -2.13  0.03283 *  
## rank3       -1.34020    0.34531   -3.88  0.00010 ***
## rank4       -1.55146    0.41783   -3.71  0.00020 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 499.98  on 399  degrees of freedom
## Residual deviance: 458.52  on 394  degrees of freedom
## AIC: 470.5
## 
## Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
<div id="binning" class="section level2">
<h2><span class="header-section-number">11.8</span> Binning</h2>
<p>Sometimes we have data that spans a range of values such that it might make more sense to “bin” or collect the values into “buckets” represented by categories. This is akin to what a histogram does. Look at the PimaIndiansDiabetes data set for an example. Specifically, look at the <strong>pregnant</strong> feature in the form of a histogram. Most of those surveyed had less than 5 pregnancies although there are those who had at least that number of pregnancies and more.</p>
<div class="sourceCode" id="cb655"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb655-1" data-line-number="1">pm_new &lt;-<span class="st"> </span>PimaIndiansDiabetes</a>
<a class="sourceLine" id="cb655-2" data-line-number="2"><span class="kw">hist</span>(pm_new<span class="op">$</span>pregnant)</a></code></pre></div>
<p><img src="biosml_files/figure-html/pmbin1-1.png" width="672" /></p>
<p>We could build our models using the number of pregnancies without attempting to transform the feature in any way. But let’s bin this feature. In R, we can use the <strong>cut</strong> function to chop up a numerical range of data into a specified number of bins and according to some function such as the <strong>quantile</strong> function which would give us for bins labelled from 1 to 4. This will produce sample quantiles according to the 0, 25th, 50th, 75%, and 100% percentiles.</p>
<div class="sourceCode" id="cb656"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb656-1" data-line-number="1"><span class="kw">cut</span>(pm_new<span class="op">$</span>pregnant, <span class="dt">breaks=</span><span class="kw">quantile</span>(pm<span class="op">$</span>pregnant),</a>
<a class="sourceLine" id="cb656-2" data-line-number="2">                     <span class="dt">include.lowest =</span> <span class="ot">TRUE</span>,<span class="dt">labels=</span><span class="dv">1</span><span class="op">:</span><span class="dv">4</span>)</a></code></pre></div>
<pre><code>##   [1] 3 1 4 1 1 3 2 4 2 4 3 4 4 1 3 4 1 4 1 1 2 4 4 4 4 4 4 1 4 3 3 2 2 3 4 3 4 4
##  [39] 2 3 2 4 4 4 4 1 1 2 4 4 1 1 3 4 4 1 4 1 1 1 2 4 3 2 4 3 1 2 1 3 2 3 4 3 1 1
##  [77] 4 3 1 2 2 2 4 1 3 2 4 2 4 1 1 3 4 3 2 3 2 1 3 1 1 1 1 1 2 1 1 3 2 1 2 4 1 3
## [115] 4 3 3 3 3 3 1 3 2 3 1 1 2 1 1 1 3 4 2 4 2 2 1 1 1 3 2 3 2 4 3 1 4 2 3 2 1 3
## [153] 4 1 4 4 2 1 2 4 3 4 1 2 1 3 2 3 3 2 3 3 2 1 2 4 3 1 3 3 3 1 1 3 3 4 4 1 4 3
## [191] 2 4 4 4 4 3 1 2 3 3 1 1 1 2 3 3 4 3 1 4 2 1 4 1 4 4 3 3 3 3 1 2 4 4 1 1 1 2
## [229] 3 1 3 3 1 3 2 3 4 1 4 1 1 3 2 3 2 4 4 1 4 1 4 2 2 1 4 1 2 2 1 4 2 2 3 2 3 3
## [267] 1 2 1 2 4 2 2 1 4 2 4 1 3 2 1 4 4 4 2 4 3 1 3 3 1 1 2 1 1 3 2 1 4 4 1 2 3 3
## [305] 2 2 4 1 1 2 3 1 2 2 4 2 2 2 2 3 3 2 1 4 2 1 1 4 2 3 4 2 1 4 1 1 1 3 4 4 1 1
## [343] 1 3 4 4 1 2 2 3 3 3 2 1 2 4 1 4 4 1 3 3 3 3 3 3 3 1 2 1 2 1 1 2 2 4 1 1 3 1
## [381] 1 1 1 1 1 1 3 4 3 2 1 3 1 3 3 2 2 1 2 2 3 3 3 4 3 2 3 1 4 1 3 1 1 1 1 2 1 3
## [419] 1 2 1 2 1 2 4 3 1 1 1 1 2 2 1 2 1 1 4 3 1 3 1 2 3 4 3 1 1 1 1 1 1 2 1 2 2 4
## [457] 1 3 4 4 4 1 4 3 4 1 1 1 4 3 1 1 1 4 3 1 2 4 4 3 2 1 3 1 1 1 1 1 3 4 2 2 3 3
## [495] 2 3 3 2 4 3 2 2 3 4 2 4 1 1 2 4 4 1 4 2 2 2 4 4 4 3 2 2 3 4 2 2 1 2 1 1 2 1
## [533] 1 3 1 3 1 1 1 2 4 2 4 3 1 4 3 3 1 3 1 2 3 1 1 4 1 4 4 4 3 1 1 3 1 2 1 3 3 1
## [571] 2 2 2 2 1 1 3 2 4 2 1 3 4 4 4 1 4 3 2 1 4 2 2 2 3 1 1 1 1 1 1 3 1 4 3 1 1 1
## [609] 1 1 2 2 4 3 4 2 3 2 4 1 2 2 3 1 2 3 1 1 3 3 4 1 2 1 4 4 3 2 4 1 1 3 3 3 2 2
## [647] 1 1 4 1 1 1 3 2 1 2 2 1 4 2 4 1 4 4 3 1 3 4 3 4 3 1 4 2 4 3 4 1 2 2 2 1 1 3
## [685] 3 2 2 1 1 1 4 4 2 4 2 4 2 1 3 3 2 3 1 2 3 3 4 2 4 2 2 3 4 1 2 4 2 4 1 3 3 1
## [723] 1 3 1 3 1 1 2 2 2 4 2 2 2 3 1 4 2 1 4 2 1 4 4 4 1 1 2 3 3 1 2 1 4 1 4 1 1 3
## [761] 2 4 4 4 2 3 1 1
## Levels: 1 2 3 4</code></pre>
<div class="sourceCode" id="cb658"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb658-1" data-line-number="1">pm_new &lt;-<span class="st"> </span>pm_new <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb658-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pregnant=</span><span class="kw">cut</span>(pregnant,<span class="dt">breaks=</span><span class="kw">quantile</span>(pregnant),</a>
<a class="sourceLine" id="cb658-3" data-line-number="3">                      <span class="dt">include.lowest=</span><span class="ot">TRUE</span>,<span class="dt">labels=</span><span class="dv">1</span><span class="op">:</span><span class="dv">4</span>))</a>
<a class="sourceLine" id="cb658-4" data-line-number="4"></a>
<a class="sourceLine" id="cb658-5" data-line-number="5"><span class="kw">str</span>(pm_new<span class="op">$</span>pregnant)</a></code></pre></div>
<pre><code>##  Factor w/ 4 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;: 3 1 4 1 1 3 2 4 2 4 ...</code></pre>
<p>So we could now build a model using this newly binned information. It might not make a big difference although it might give some insight into to what extent the number of pregnancies influence the model. More specifically, which bin of the pregnancy variable would be influential - if it all ? First, let’s create a model using the untransformed data as found in the PimaIndiansDiabetes data frame.</p>
<div class="sourceCode" id="cb660"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb660-1" data-line-number="1">control &lt;-<span class="st"> </span><span class="kw">trainControl</span>(<span class="dt">method=</span><span class="st">&quot;cv&quot;</span>,<span class="dt">number=</span><span class="dv">5</span>)</a>
<a class="sourceLine" id="cb660-2" data-line-number="2"></a>
<a class="sourceLine" id="cb660-3" data-line-number="3">cutmodel1 &lt;-<span class="st"> </span><span class="kw">train</span>(diabetes<span class="op">~</span>.,</a>
<a class="sourceLine" id="cb660-4" data-line-number="4">                   <span class="dt">data=</span>PimaIndiansDiabetes,</a>
<a class="sourceLine" id="cb660-5" data-line-number="5">                   <span class="dt">method=</span><span class="st">&quot;glm&quot;</span>,</a>
<a class="sourceLine" id="cb660-6" data-line-number="6">                   <span class="dt">trControl=</span>control)</a>
<a class="sourceLine" id="cb660-7" data-line-number="7"><span class="kw">summary</span>(cutmodel1<span class="op">$</span>finalModel)</a></code></pre></div>
<pre><code>## 
## Call:
## NULL
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -2.557  -0.727  -0.416   0.727   2.930  
## 
## Coefficients:
##              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -8.404696   0.716636  -11.73  &lt; 2e-16 ***
## pregnant     0.123182   0.032078    3.84  0.00012 ***
## glucose      0.035164   0.003709    9.48  &lt; 2e-16 ***
## pressure    -0.013296   0.005234   -2.54  0.01107 *  
## triceps      0.000619   0.006899    0.09  0.92852    
## insulin     -0.001192   0.000901   -1.32  0.18607    
## mass         0.089701   0.015088    5.95  2.8e-09 ***
## pedigree     0.945180   0.299147    3.16  0.00158 ** 
## age          0.014869   0.009335    1.59  0.11119    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 993.48  on 767  degrees of freedom
## Residual deviance: 723.45  on 759  degrees of freedom
## AIC: 741.4
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<div class="sourceCode" id="cb662"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb662-1" data-line-number="1"><span class="kw">varImp</span>(cutmodel1)</a></code></pre></div>
<pre><code>## glm variable importance
## 
##          Overall
## glucose    100.0
## mass        62.3
## pregnant    39.9
## pedigree    32.7
## pressure    26.1
## age         16.0
## insulin     13.1
## triceps      0.0</code></pre>
<p>We definitely see that pregnancy is an important feature here although, again, we don’t know what sub population might have influence, if any, on the overall model. Let’s rerun this analysis on the transformed version of the data frame.</p>
<div class="sourceCode" id="cb664"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb664-1" data-line-number="1">cutmodel2 &lt;-<span class="st"> </span><span class="kw">train</span>(diabetes<span class="op">~</span>.,</a>
<a class="sourceLine" id="cb664-2" data-line-number="2">                   <span class="dt">data=</span>pm_new,</a>
<a class="sourceLine" id="cb664-3" data-line-number="3">                   <span class="dt">method=</span><span class="st">&quot;glm&quot;</span>,</a>
<a class="sourceLine" id="cb664-4" data-line-number="4">                   <span class="dt">trControl=</span>control)</a>
<a class="sourceLine" id="cb664-5" data-line-number="5"></a>
<a class="sourceLine" id="cb664-6" data-line-number="6"><span class="kw">summary</span>(cutmodel2<span class="op">$</span>finalModel)</a></code></pre></div>
<pre><code>## 
## Call:
## NULL
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -2.505  -0.720  -0.420   0.728   2.963  
## 
## Coefficients:
##              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -8.290092   0.743270  -11.15  &lt; 2e-16 ***
## pregnant2    0.202086   0.267962    0.75  0.45075    
## pregnant3    0.401824   0.272252    1.48  0.13996    
## pregnant4    1.125221   0.290995    3.87  0.00011 ***
## glucose      0.034999   0.003716    9.42  &lt; 2e-16 ***
## pressure    -0.013032   0.005242   -2.49  0.01292 *  
## triceps      0.000901   0.006953    0.13  0.89693    
## insulin     -0.001205   0.000903   -1.34  0.18173    
## mass         0.089065   0.015122    5.89  3.9e-09 ***
## pedigree     0.912665   0.299045    3.05  0.00227 ** 
## age          0.015049   0.009380    1.60  0.10863    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 993.48  on 767  degrees of freedom
## Residual deviance: 722.27  on 757  degrees of freedom
## AIC: 744.3
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<div class="sourceCode" id="cb666"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb666-1" data-line-number="1"><span class="kw">varImp</span>(cutmodel2)</a></code></pre></div>
<pre><code>## glm variable importance
## 
##           Overall
## glucose    100.00
## mass        62.00
## pregnant4   40.23
## pedigree    31.46
## pressure    25.36
## age         15.88
## pregnant3   14.49
## insulin     12.98
## pregnant2    6.72
## triceps      0.00</code></pre>
<p>This is interesting in that perhaps it’s the 4th bin of the pregnancy feature that has the major influence on the model. So if we look at the distribution of positive cases we see that in the positive cases there are more people from the 4th bin:</p>
<div class="sourceCode" id="cb668"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb668-1" data-line-number="1">pm_new <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(diabetes,pregnant) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb668-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb668-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>diabetes,<span class="dt">y=</span>n,<span class="dt">fill=</span>pregnant)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>)</a></code></pre></div>
<p><img src="biosml_files/figure-html/plot4bin-1.png" width="672" /></p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="selecting-the-best-model.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="using-external-ml-frameworks.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
